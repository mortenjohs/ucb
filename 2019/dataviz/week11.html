<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Introduction to data visualization</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="../../css/bootstrap.min.css" rel="stylesheet"> 
  <link href="../../css/custom.css" rel="stylesheet">
</head>

<body class="markdown github">

	<header class="navbar-inverse navbar-fixed-top">
		<div class="container">
			<nav role="navigation">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a href="index.html" class="navbar-brand">Intro Data Viz</a>
				</div> <!-- /.navbar-header -->
				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
					<ul class="nav navbar-nav">
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">Class notes<b class="caret"></b></a>
							<ul class="dropdown-menu">
								<li><a href="week1.html">What is data?</a></li>
								<li><a href="week2.html">Data visualization: basic principles</a></li>
								<li><a href="week3.html">Interviewing data: exploratory graphical analysis</a></li>
								<li><a href="week4.html">Using GitHub</a></li>
								<li><a href="week5.html">Acquiring, cleaning, and processing data</a></li>
								<li><a href="week6.html">Let's apply what we've learned so far</a></li>
								<li><a href="week7.html">Processing data with R</a></li>
								<li><a href="week8.html">Making static graphics with R</a></li>
								<li><a href="week9.html">Principles of mapping</a></li>
								<li><a href="week10.html">Making static maps</a></li>
								<li><a href="week11.html">Making interactive maps</a></li>
								<li><a href="week13.html">From R to interactive charts and maps</a></li>				
								<li><a href="week14.html">Animation: making GIFs and videos</a></li>	
							</ul>
						</li>
						<li><a href="software.html">Software</a></li>
						<li><a href="datasets.html">Data</a></li>
						<li><a href="mailto:p.aldhous@gmail.com">Email instructor</a></li>					
					</ul>
				</div><!-- /.navbar-collapse -->
			</nav>
		</div> <!-- /.navbar-header -->
	</header>

	<div class="container all">
		
<h1 id="making-interactive-maps"><a name="making-interactive-maps" href="#making-interactive-maps"></a>Making interactive maps</h1><h3 id="introducing-mapbox-studio"><a name="introducing-mapbox-studio" href="#introducing-mapbox-studio"></a>Introducing Mapbox Studio</h3><p><a href="https://www.mapbox.com/mapbox-studio/"><strong>Mapbox Studio</strong></a> is a web-based mapping application that makes it easy to produce elegantly styled, interactive, online maps.</p><h3 id="the-data-we-will-use-today"><a name="the-data-we-will-use-today" href="#the-data-we-will-use-today"></a>The data we will use today</h3><p>Download the data from this session from <a href="data/week11.zip">here</a>, unzip the folder and place it on your desktop. It contains the following files:</p><ul>
<li><code>seismic.zip</code> Zipped shapefile with data on the risk of a damaging earthquake in 2018 for the continental United States, from the <a href="https://earthquake.usgs.gov/hazards/induced/">U.S. Geological Survey</a>.</li><li><code>quakes.csv</code> This file isn’t in the folder. As for week 10, we will use the U.S. Geological Survey’s <a href="https://earthquake.usgs.gov/earthquakes/search/">Earthquakes Archives</a> API where we will search for all earthquakes since 1960 with a <a href="http://www.geo.mtu.edu/UPSeis/magnitude.html">magnitude</a> of 6 or greater that occured witin 6,000 kilometers of the geographic center of the contiguous United States. Type this url into the address bar of your browser:<pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>https://earthquake.usgs.gov/fdsnws/event/1/query?starttime=1960-01-01T00:00:00&amp;amp;latitude=39.828175&amp;amp;longitude=-98.5795&amp;amp;maxradiuskm=6000&amp;amp;minmagnitude=6&amp;amp;format=csv&amp;amp;orderby=time
</code></pre>">https:<span class="hljs-comment">//earthquake.usgs.gov/fdsnws/event/1/query?starttime=1960-01-01T00:00:00&amp;latitude=39.828175&amp;longitude=-98.5795&amp;maxradiuskm=6000&amp;minmagnitude=6&amp;format=csv&amp;orderby=time</span>
</code></pre>
A file called <code>query.csv</code> should download. Rename it <code>quakes.csv</code> and add to the <code>week11</code> folder.</li><li><code>world.zip</code> Zipped shapefile including the variable <code>gdp_percap</code>, giving World Bank data from 2017 on <a href="https://data.worldbank.org/indicator/NY.GDP.PCAP.PP.CD">Gross Domestic Product (GDP) per capita</a> for the world’s nations, in current international dollars, corrected for purchasing power in different territories.</li><li><code>template.html</code> A web page with a basic template for displaying a map made with Mapbox Studio using the <a href="https://docs.mapbox.com/mapbox-gl-js/api/">Mapbox GL</a> JavaScript library.</li></ul><h3 id="map-seismic-risk-and-earthquakes-for-the-continental-united-states"><a name="map-seismic-risk-and-earthquakes-for-the-continental-united-states" href="#map-seismic-risk-and-earthquakes-for-the-continental-united-states"></a>Map seismic risk and earthquakes for the continental United States</h3><h4 id="select-a-basemap"><a name="select-a-basemap" href="#select-a-basemap"></a>Select a basemap</h4><p><a href="https://www.mapbox.com/signin/">Sign in</a> to your Mapbox account, then click on navigate to Mapbox Studio:</p><p><img src="img/class11_1.jpg" alt=""></p><p>You should now see the following screen:</p><p><img src="img/class11_2.jpg" alt=""></p><p>Each new map in Mapbox is a <code>Style</code>. Click on <code>New style</code>, and then select a basemap. The suggested <code>Basic</code> template is rather busy for a map with data layers, so scroll down, select the <code>Light</code> template and click <code>Customize Light</code>.</p><p><img src="img/class11_3.jpg" alt=""></p><p>You should now see a screen like this (You can close the <code>Welcome to Studio</code> and subsequent pop-ups):</p><p><img src="img/class11_4.jpg" alt=""></p><p>Edit the name of the <code>Style</code> from <code>Light</code> to <code>Seismic</code> at top left, and zoom the map out to the continental United States:</p><p><img src="img/class11_5.jpg" alt=""></p><p>You can, if you wish, edit the colors, fonts, etc used for features and labels on your basemap by clicking on them in the  panel at left.</p><h4 id="add-and-style-the-seismic-risk-layer"><a name="add-and-style-the-seismic-risk-layer" href="#add-and-style-the-seismic-risk-layer"></a>Add and style the seismic risk layer</h4><p>Click <code>+</code> at top left and then <code>+ Upload</code> in the <code>New layer</code> panel:</p><p><img src="img/class11_6.jpg" alt=""></p><p>This pop-up shoudl appear:</p><p><img src="img/class11_7.jpg" alt=""></p><p>Drag and drop the <code>seismic.zip</code> zipped shapefile, or click <code>Select a file</code> and navigate to it, then click <code>Confirm</code>.</p><p>Once the file uploads, select it as the new layer by clicking on its polygon icon (highlighted in gray here) from your <code>Unused sources</code>:</p><p><img src="img/class11_8.jpg" alt=""></p><p>(If the uploaded layer doesn’t appear after processing, refresh the web page, and click <code>+</code> at top left again.)</p><p>Your screen should now look like this:</p><p><img src="img/class11_9.jpg" alt=""></p><p>Click on the <code>Style</code> link at top. You can also get to the <code>Style</code> panel for any layer by clicking on it in the panel at left.</p><p><img src="img/class11_10.jpg" alt=""></p><p>Click on <code>Style with data conditions</code> under <code>Fill color</code>. Select the <code>ValueRange</code> variable as the <code>Data field</code>, set the condition as <code>is equal to</code> <code>&lt;1</code>, and set the HEX color value to <code>#fee5d9</code> from the <a href="http://colorbrewer2.org/#type=sequential&amp;scheme=Reds&amp;n=5">ColorBrewer Reds palette</a> with five data classes.</p><p><img src="img/class11_11.jpg" alt=""></p><p>Click <code>✔ Done</code>, then <code>+ Add another condition</code> and repeat the process for the other bins in the data, filling with the apppropriate color from the palette, until the map looks like this:</p><p><img src="img/class11_12.jpg" alt=""></p><p>Set the <code>Opacity&gt;Fill opacity</code> to <code>0.8</code>:</p><p><img src="img/class11_13.jpg" alt=""></p><p>Finally, drag the <code>seismic</code> layer beneath the layers marked <code>label</code> so that they appear above the data layer. Close the <code>Style</code> panel and the map should now look like this:</p><p><img src="img/class11_14.jpg" alt=""></p><h4 id="add-and-style-the-earthquakes-layer"><a name="add-and-style-the-earthquakes-layer" href="#add-and-style-the-earthquakes-layer"></a>Add and style the earthquakes layer</h4><p>Add the quakes layer, following the same process as before for the files <code>quakes.csv</code>. Click on the new layer in the panel at left and the map should look like this:</p><p><img src="img/class11_15.jpg" alt=""></p><p>Remember from week 10 that we need to use a formula to convert the <code>mag</code> values for earthquake magnitude into the amount of shaking each caused. So with <code>Radius</code> highighted, click <code>Use a formula</code> and fill in as follows:</p><p><img src="img/class11_16.jpg" alt=""></p><p><code>10^mag</code> is the same formula as we used last week, but when designing a web map, we can’t set the area of circles, only their radius. So we also need to take the <code>sqrt</code> or square root of these values, so that the circles size by <strong>area</strong> correctly with the data. (Look back to the notes from Week 2 if you can’t remember why.) The division by 300 is just a scaling factor for all of the circles, set by trial-and-error for optimal display on the map.</p><p>Now set the <code>Color</code> to white (HEX value <code>#ffffff</code>), the <code>Opacity</code> to <code>0.5</code>, and the <code>Stroke Width</code> to <code>0.1 px</code>.</p><p>Close the <code>Style</code> panel and the finished map should look like this:</p><p><img src="img/class11_17.jpg" alt=""></p><h4 id="publish-map-and-make-a-web-page-to-display-it"><a name="publish-map-and-make-a-web-page-to-display-it" href="#publish-map-and-make-a-web-page-to-display-it"></a>Publish map and make a web page to display it</h4><p>Click on the blue <code>Publish</code> button at top right, and click <code>Publish</code> again at the next window:</p><p><img src="img/class11_18.jpg" alt=""></p><p>Click <code>Share</code> at top right, and copy <code>Your style URL</code> and <code>Your access token</code></p><p><img src="img/class11_16.jpg" alt=""></p><p>Make a copy of <code>template.html</code> and rename it as <code>seismic.html</code>.</p><p>With the file <code>seismic.html</code> open in Sublime Text or Brackets, edit the <code>&lt;title&gt;&lt;/title&gt;</code>, and the <code>center</code> position for the map as follows, and add your access token and style URL in place of the placeholders:</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
  &amp;lt;meta charset='utf-8' /&amp;gt;
  &amp;lt;title&amp;gt;Seismic risk and quakes&amp;lt;/title&amp;gt;
  &amp;lt;meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' /&amp;gt;
  &amp;lt;script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.js'&amp;gt;&amp;lt;/script&amp;gt;
  &amp;lt;link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.css' rel='stylesheet' /&amp;gt;
  &amp;lt;style&amp;gt;
    body { margin:0; padding:0; }
    #map { position:absolute; top:0; bottom:0; width:100%; }
  &amp;lt;/style&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;

&amp;lt;div id='map'&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;script&amp;gt;
mapboxgl.accessToken = 'pk.eyJ1IjoiYWxkaG91c3AiLCJhIjoiY2pueHpmeGNxMGhxNjNxbXhpMzViNGUyZSJ9.FQiJVij9bPb65b2jTDtBGA';
const map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/aldhousp/ck2jacdpz1zn91cpazrebios6',
  center: [-97, 40],
  zoom: 3.0
});
&amp;lt;/script&amp;gt;

&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
</code></pre>">&lt;!DOCTYPE html&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">'utf-8'</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>Seismic risk and quakes<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">'viewport'</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">'initial-scale=1,maximum-scale=1,user-scalable=no'</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">'https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.js'</span>&gt;</span><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">'https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.css'</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">'stylesheet'</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">style</span>&gt;</span><span class="css">
    <span class="hljs-tag">body</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"><span class="hljs-number">0</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"><span class="hljs-number">0</span></span></span>; <span class="hljs-rule">}</span></span>
    <span class="hljs-id">#map</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">position</span>:<span class="hljs-value">absolute</span></span>; <span class="hljs-rule"><span class="hljs-attribute">top</span>:<span class="hljs-value"><span class="hljs-number">0</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">bottom</span>:<span class="hljs-value"><span class="hljs-number">0</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"><span class="hljs-number">100%</span></span></span>; <span class="hljs-rule">}</span></span>
  </span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">'map'</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
mapboxgl.accessToken = <span class="hljs-string">'pk.eyJ1IjoiYWxkaG91c3AiLCJhIjoiY2pueHpmeGNxMGhxNjNxbXhpMzViNGUyZSJ9.FQiJVij9bPb65b2jTDtBGA'</span>;
<span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> mapboxgl.Map({
  container: <span class="hljs-string">'map'</span>,
  style: <span class="hljs-string">'mapbox://styles/aldhousp/ck2jacdpz1zn91cpazrebios6'</span>,
  center: [-<span class="hljs-number">97</span>, <span class="hljs-number">40</span>],
  zoom: <span class="hljs-number">3.0</span>
});
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</span></code></pre><p>Now, above the closing  tag, add the following code:</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>// Add zoom and rotation controls to the map.
map.addControl(new mapboxgl.NavigationControl());

// Disable scroll zooming
map.scrollZoom.disable();
</code></pre>"><span class="hljs-comment">// Add zoom and rotation controls to the map.</span>
map.addControl(<span class="hljs-keyword">new</span> mapboxgl.NavigationControl());

<span class="hljs-comment">// Disable scroll zooming</span>
map.scrollZoom.disable();
</code></pre><p>To add a legend, immediately beneath add the following:</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>// Create legend
map.on('load', function() {

  var layers = ['&amp;lt;1%', '1-2%', '2-5%', '5-10%', '10-14%'];
  var colors = ['#fee5d9','#fcae91','#fb6a4a','#de2d26','#a50f15'];

  for (i = 0; i &amp;lt; layers.length; i++) {
    var layer = layers[i];
    var color = colors[i];
    var item = document.createElement('div');
    var key = document.createElement('span');
    key.className = 'legend-key';
    key.style.backgroundColor = color;

    var value = document.createElement('span');
    value.innerHTML = layer;
    item.appendChild(key);
    item.appendChild(value);
    legend.appendChild(item);
 }
});
</code></pre>"><span class="hljs-comment">// Create legend</span>
map.on(<span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{

  <span class="hljs-keyword">var</span> layers = [<span class="hljs-string">'&lt;1%'</span>, <span class="hljs-string">'1-2%'</span>, <span class="hljs-string">'2-5%'</span>, <span class="hljs-string">'5-10%'</span>, <span class="hljs-string">'10-14%'</span>];
  <span class="hljs-keyword">var</span> colors = [<span class="hljs-string">'#fee5d9'</span>,<span class="hljs-string">'#fcae91'</span>,<span class="hljs-string">'#fb6a4a'</span>,<span class="hljs-string">'#de2d26'</span>,<span class="hljs-string">'#a50f15'</span>];

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; layers.length; i++) {
    <span class="hljs-keyword">var</span> layer = layers[i];
    <span class="hljs-keyword">var</span> color = colors[i];
    <span class="hljs-keyword">var</span> item = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
    <span class="hljs-keyword">var</span> key = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'span'</span>);
    key.className = <span class="hljs-string">'legend-key'</span>;
    key.style.backgroundColor = color;

    <span class="hljs-keyword">var</span> value = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'span'</span>);
    value.innerHTML = layer;
    item.appendChild(key);
    item.appendChild(value);
    legend.appendChild(item);
 }
});
</code></pre><p>Then add this HTML immediately beneath <code>&lt;div id='map'&gt;&lt;/div&gt;</code>:</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>&amp;lt;div class='map-overlay' id='legend'&amp;gt;&amp;lt;/div&amp;gt;
</code></pre>">&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">'map-overlay'</span> id=<span class="hljs-string">'legend'</span>&gt;<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</span></code></pre><p>To style the legend, add the following CSS code above the closing <code>&lt;/style&gt;</code> tag:</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>    .map-overlay {
      position: absolute;
      bottom: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.8);
      margin-right: 20px;
      font-family: Arial, sans-serif;
      overflow: auto;
      border-radius: 3px;
    }

    #legend {
    padding: 10px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    line-height: 18px;
    margin-bottom: 40px;
    }

    .legend-key {
      display: inline-block;
      border-radius: 20%;
      width: 10px;
      height: 10px;
      margin-right: 5px;
    }
</code></pre>">    .map-overlay {
      position: absolute;
      bottom: <span class="hljs-number">0</span>;
      right: <span class="hljs-number">0</span>;
      background: rgba(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.8</span>);
      margin-right: <span class="hljs-number">20</span>px;
      font-family: Arial, sans-serif;
      overflow: auto;
      border-radius: <span class="hljs-number">3</span>px;
    }

    #legend {
    padding: <span class="hljs-number">10</span>px;
    box-shadow: <span class="hljs-number">0</span> <span class="hljs-number">1</span>px <span class="hljs-number">2</span>px rgba(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
    line-height: <span class="hljs-number">18</span>px;
    margin-bottom: <span class="hljs-number">40</span>px;
    }

    .legend-key {
      display: inline-block;
      border-radius: <span class="hljs-number">20</span>%;
      width: <span class="hljs-number">10</span>px;
      height: <span class="hljs-number">10</span>px;
      margin-right: <span class="hljs-number">5</span>px;
    }
</code></pre><p>Finally, to add a pop-up to get information on each quake when clicked or tapped, add this above the closing <code>&lt;/script&gt;</code> tag. You will need to use the name of your quakes layer from Mapbox Studio:</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>// Add popup
map.on('click', function(e) {
  var features = map.queryRenderedFeatures(e.point, {
    layers: ['quakes-36p62q'] // name of the quakes layer from your map
  });

  if (!features.length) {
    return;
  }

  var feature = features[0];

  var popup = new mapboxgl.Popup({ offset: [0, -15] })
    .setLngLat(feature.geometry.coordinates)
    .setHTML('&amp;lt;b&amp;gt;Magitude: &amp;lt;/b&amp;gt;' + feature.properties.mag + '&amp;lt;br&amp;gt;&amp;lt;b&amp;gt;Time: &amp;lt;/b&amp;gt;' + feature.properties.time + '&amp;lt;br&amp;gt;&amp;lt;b&amp;gt;Depth: &amp;lt;/b&amp;gt;' + feature.properties.depth + ' km')
    .setLngLat(feature.geometry.coordinates)
    .addTo(map);
});
</code></pre>"><span class="hljs-comment">// Add popup</span>
map.on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
  <span class="hljs-keyword">var</span> features = map.queryRenderedFeatures(e.point, {
    layers: [<span class="hljs-string">'quakes-36p62q'</span>] <span class="hljs-comment">// name of the quakes layer from your map</span>
  });

  <span class="hljs-keyword">if</span> (!features.length) {
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">var</span> feature = features[<span class="hljs-number">0</span>];

  <span class="hljs-keyword">var</span> popup = <span class="hljs-keyword">new</span> mapboxgl.Popup({ offset: [<span class="hljs-number">0</span>, -<span class="hljs-number">15</span>] })
    .setLngLat(feature.geometry.coordinates)
    .setHTML(<span class="hljs-string">'&lt;b&gt;Magitude: &lt;/b&gt;'</span> + feature.properties.mag + <span class="hljs-string">'&lt;br&gt;&lt;b&gt;Time: &lt;/b&gt;'</span> + feature.properties.time + <span class="hljs-string">'&lt;br&gt;&lt;b&gt;Depth: &lt;/b&gt;'</span> + feature.properties.depth + <span class="hljs-string">' km'</span>)
    .setLngLat(feature.geometry.coordinates)
    .addTo(map);
});
</code></pre><p>The code in the <code>setHTML</code> function writes the HTML to appear in the pop-up. It pulls data for each quake using the format: <code>feature.properties.variablename</code>.</p><p>The finished map should look like this:</p>
<iframe src="seismic.html" width="100%" height="500" frameborder="0" marginheight="0" marginwidth="0"></iframe>
<p>This web page can now be embedded in any other web page, as I have done here, with a simple iframe of the following form:</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>&amp;lt;iframe src=&quot;seismic.html&quot;&amp;gt; width=&quot;100%&quot; height=&quot;500&quot; frameborder=&quot;0&quot; marginheight=&quot;0&quot; marginwidth=&quot;0&quot;&amp;gt;&amp;lt;/iframe&amp;gt;
</code></pre>">&lt;iframe src=<span class="hljs-string">"seismic.html"</span>&gt; width=<span class="hljs-string">"100%"</span> height=<span class="hljs-string">"500"</span> frameborder=<span class="hljs-string">"0"</span> marginheight=<span class="hljs-string">"0"</span> marginwidth=<span class="hljs-string">"0"</span>&gt;<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">iframe</span>&gt;</span>
</span></code></pre><h3 id="exercise:-map-gdp-per-capita-in-2017-for-the-world's-nations"><a name="exercise:-map-gdp-per-capita-in-2017-for-the-world's-nations" href="#exercise:-map-gdp-per-capita-in-2017-for-the-world's-nations"></a>Exercise: Map GDP per capita in 2017 for the world’s nations</h3><p>Return to the main <a href="https://www.mapbox.com/studio/">Mapbox Studio</a> page and select a <code>Light</code> basemap as before. Rename the <code>Style</code> as <code>GDPpercap</code>, and upload and add the <code>world.zip</code> zipped shapefile as a new layer.</p><p>Style it to mimic the approach used in the map below, from Week 1:</p><p><img src="img/class1_18.jpg" alt=""></p><p>You will have to use <code>Style with data conditions</code>. Because the variable <code>gdp_percap</code> has decimal numbers, you will need to include a decimal point in the numbers you select for the breaks for the bins.</p><p>Make a web page to display the map.</p><h3 id="assignment"><a name="assignment" href="#assignment"></a>Assignment</h3><ul>
<li><p>File a full project update via your GitHub account, so that I can see your visualizations, data etc. Make sure that your GitHub repo is up to date with data, charts etc, so that I can sync with my version of your project and review your progress.</p>
</li><li><p>This should include a summary in Markdown. Explain:</p>
<ul>
<li>What you have done.</li><li>What you intend to do.</li><li>Any problems, obstacles, you are experiencing. Pay particular attention to this, so that we can work on solutions when we meet next week.</li></ul>
</li></ul><p>Share this with me by <strong>6pm</strong> on <strong>Wed Nov 13</strong>.</p><h3 id="further-reading/resources"><a name="further-reading/resources" href="#further-reading/resources"></a>Further reading/resources</h3><p><a href="https://www.mapbox.com/help/tutorials/">Mapbox tutorials</a></p><p><a href="https://www.mapbox.com/studio-manual/overview/">Mapbox Studio manual</a></p><p><a href="https://www.mapbox.com/mapbox-gl-js/api/">Mapbox GL documentation</a></p>

	</div> <!-- /.container all -->
	<script src="https://code.jquery.com/jquery.min.js"></script>
	<script src="../../js/bootstrap.min.js"></script>
</body>
</html>
