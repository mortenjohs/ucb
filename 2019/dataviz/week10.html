<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Introduction to data visualization</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="../../css/bootstrap.min.css" rel="stylesheet"> 
  <link href="../../css/custom.css" rel="stylesheet">
</head>

<body class="markdown github">

	<header class="navbar-inverse navbar-fixed-top">
		<div class="container">
			<nav role="navigation">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a href="index.html" class="navbar-brand">Intro Data Viz</a>
				</div> <!-- /.navbar-header -->
				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
					<ul class="nav navbar-nav">
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">Class notes<b class="caret"></b></a>
							<ul class="dropdown-menu">
								<li><a href="week1.html">What is data?</a></li>
								<li><a href="week2.html">Data visualization: basic principles</a></li>
								<li><a href="week3.html">Interviewing data: exploratory graphical analysis</a></li>
								<li><a href="week4.html">Using GitHub</a></li>
								<li><a href="week5.html">Acquiring, cleaning, and processing data</a></li>
								<li><a href="week6.html">Let's apply what we've learned so far</a></li>
								<li><a href="week7.html">Processing data with R</a></li>
								<li><a href="week8.html">Making static graphics with R</a></li>
								<li><a href="week9.html">Principles of mapping</a></li>
								<li><a href="week10.html">Making static maps</a></li>
								<li><a href="week11.html">Making interactive maps</a></li>
								<li><a href="week13.html">From R to interactive charts and maps</a></li>				
								<li><a href="week14.html">Animation: making GIFs and videos</a></li>	
							</ul>
						</li>
						<li><a href="software.html">Software</a></li>
						<li><a href="datasets.html">Data</a></li>
						<li><a href="mailto:p.aldhous@gmail.com">Email instructor</a></li>					
					</ul>
				</div><!-- /.navbar-collapse -->
			</nav>
		</div> <!-- /.navbar-header -->
	</header>

	<div class="container all">
		
<h1 id="making-static-maps-and-processing-geodata-with-gis"><a name="making-static-maps-and-processing-geodata-with-gis" href="#making-static-maps-and-processing-geodata-with-gis"></a>Making static maps and processing geodata with GIS</h1><h3 id="introducing-qgis"><a name="introducing-qgis" href="#introducing-qgis"></a>Introducing QGIS</h3><p><a href="https://qgis.org/en/site/"><strong>GQIS</strong></a> is the leading free, open source Geographic Information Systems (GIS) application. It is capable of sophisticated geodata processing and analysis, and also can be used to design publication-quality data-driven maps.</p><p>Launch QGIS, and you should see a screen like this:</p><p><img src="img/class10_1.jpg" alt=""></p><p>If your screen looks different, select <code>View&gt;Panels</code> from the top menu and check the options as follows:</p><p><img src="img/class10_2.jpg" alt=""></p><p>Then select <code>View&gt;Toolbars</code> and check the options as follows:</p><p><img src="img/class10_3.jpg" alt=""></p><h3 id="the-data-we-will-use-today"><a name="the-data-we-will-use-today" href="#the-data-we-will-use-today"></a>The data we will use today</h3><p>Download the data from this session from <a href="data/week10.zip">here</a>, unzip the folder and place it on your desktop. It contains the following folders and files:</p><ul>
<li><code>seismic</code> Shapefile with data on the risk of a damaging earthquake in 2018 for the continental United States, from the <a href="https://earthquake.usgs.gov/hazards/induced/">U.S. Geological Survey</a>.</li><li><code>seismic_raw</code> As above, but not clipped to the coast and borders of the United States.</li><li><code>gdp_pc</code><ul>
<li><code>gpd_pc.csv</code> <code>gdp_pc.csvt</code> CSV file with <a href="http://data.worldbank.org/indicator/NY.GDP.PCAP.PP.CD">World Bank data</a> on GDP per capita for the world’s nations in 2016, plus ancillary file for QGIS to understand the data types for each field.</li></ul>
</li><li><code>ne_50m_admin_0_countries_lakes</code> <a href="http://www.naturalearthdata.com/downloads/50m-cultural-vectors/50m-admin-0-countries-2/">Natural Earth shapefile</a> with boundary data for the world’s nations.</li><li><code>sf_test_addresses</code> Shapefile derived from the addresses we geocoded in week 9.</li><li><code>quakes.csv</code> This file isn’t in the folder. Instead, we will<br>use the U.S. Geological Survey’s <a href="https://earthquake.usgs.gov/earthquakes/search/">Earthquakes Archives</a> API where we will search for all earthquakes since 1960 with a <a href="http://www.geo.mtu.edu/UPSeis/magnitude.html">magnitude</a> of 6 or greater that occured witin 6,000 kilometers of the geographic center of the contiguous United States, which <a href="https://tools.wmflabs.org/geohack/geohack.php?pagename=Geographic_center_of_the_contiguous_United_States&amp;params=39.828175_N_98.579500_W_region:US_type:landmark">this site</a> tells us lies at a latitude of <code>39.828175</code> degrees and a longitude of <code>-98.5795</code> degrees. Type this url into the address bar of your browser:<pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>https://earthquake.usgs.gov/fdsnws/event/1/query?starttime=1960-01-01T00:00:00&amp;amp;latitude=39.828175&amp;amp;longitude=-98.5795&amp;amp;maxradiuskm=6000&amp;amp;minmagnitude=6&amp;amp;format=csv&amp;amp;orderby=time
</code></pre>">https:<span class="hljs-comment">//earthquake.usgs.gov/fdsnws/event/1/query?starttime=1960-01-01T00:00:00&amp;latitude=39.828175&amp;longitude=-98.5795&amp;maxradiuskm=6000&amp;minmagnitude=6&amp;format=csv&amp;orderby=time</span>
</code></pre>
</li><li><code>ridgecrest_quakes.csv</code> Earthquakes larger than magnitude 2.5 in a bounding box including Ridgecrest, California, from June 20 to July 6, 2019.</li><li><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>https://earthquake.usgs.gov/fdsnws/event/1/query.csv?starttime=2019-06-2T20:00:00&amp;amp;endtime=2019-07-06T23:59:59&amp;amp;maxlatitude=50&amp;amp;minlatitude=24.6&amp;amp;maxlongitude=-65&amp;amp;minlongitude=-125&amp;amp;minmagnitude=2.5&amp;amp;orderby=time
</code></pre>">https:<span class="hljs-comment">//earthquake.usgs.gov/fdsnws/event/1/query.csv?starttime=2019-06-2T20:00:00&amp;endtime=2019-07-06T23:59:59&amp;maxlatitude=50&amp;minlatitude=24.6&amp;maxlongitude=-65&amp;minlongitude=-125&amp;minmagnitude=2.5&amp;orderby=time</span>
</code></pre>
In both cases, a file called <code>query.csv</code> should download. Rename them and add to the <code>week10</code> folder. Type this url into the address bar of your browser:</li></ul><h3 id="map-seismic-risk-and-earthquakes"><a name="map-seismic-risk-and-earthquakes" href="#map-seismic-risk-and-earthquakes"></a>Map seismic risk and earthquakes</h3><h4 id="make-a-choropleth-map-showing-seismic-risk-for-the-continental-united-states"><a name="make-a-choropleth-map-showing-seismic-risk-for-the-continental-united-states" href="#make-a-choropleth-map-showing-seismic-risk-for-the-continental-united-states"></a>Make a choropleth map showing seismic risk for the continental United States</h4><p>As we discussed in week 9, choropleth maps fill areas with color, according to values in the data.</p><p>We will first import the shapefile in the <code>seismic</code> folder.</p><p>Select <code>Layer&gt;Add Layer&gt;Add Vector Layer...</code> or click on this icon:</p><p><img src="img/class10_4.jpg" alt=""></p><p>At the dialog box, click the button with the three dots under <code>Source</code> and navigate to the file <code>seismic</code>. It is important that you select the file with the <code>.shp</code> extension. Then click <code>Add</code> and <code>Close</code> and the following map should appear, filled with a random color:</p><p><img src="img/class10_5.jpg" alt=""></p><p>The <code>Layers</code> panel on the left should now show the <code>seismic</code> layer. You can turn off the visibility of any layer by unchecking its box in the <code>Layers</code> panel. This can be useful to see the status of layers that would otherwise be obscured.</p><p>These controls allow you to pan and zoom the display:</p><p><img src="img/class10_6.jpg" alt=""></p><p>You can focus the display on the full extent of any layer by right-clicking it in the <code>Layers</code> panel and selecting <code>Zoom to layer</code>.</p><p>Notice <code>EPSG:4326</code> at the bottom right. This defines the map projection and datum for the layer.</p><p>Right-click on <code>seismic</code> in the <code>Layers</code> panel at left and select <code>Properties&gt;Source</code>. You should see the following under <code>Geometry and Coordinate Reference System</code>:</p><p><img src="img/class10_7.jpg" alt=""></p><p><code>EPSG:4326</code> and <code>WGS84</code> mean that this shapefile is in an <a href="http://en.wikipedia.org/wiki/Equirectangular_projection">equirectangular projection</a>, and the <a href="https://en.wikipedia.org/wiki/World_Geodetic_System">WGS84</a> datum. This is also the default for QGIS if no projection is specified.</p><p>We will select another projection for our map later. Click <code>Cancel</code> or <code>OK</code> to close <code>Properties</code> for this layer.</p><p>Now we need to color the areas for the <code>sesimic</code> layer by values in the data. Right-click on the layer in the <code>Layers</code> panel and select <code>Open Attribute Table</code>, which corresponds to the <code>.dbf</code> of the shapefile:</p><p><img src="img/class10_8.jpg" alt=""></p><p>There is one variable, <code>ValueRange</code>, which gives ranges for the percentage chance of experiencing a damaging quake in 2018.</p><p>Close the attribute table and open <code>Properties&gt;Symbology</code> for the <code>seismic</code> layer. Select <code>Categorized</code> from the dropdown menu at top, which is the option to color data according to values of a categorical variable, and then select <code>ValueRange</code> under <code>Column</code>.</p><p>(Note, although these values are percentages, they have already been binned into categories in this data. If we were coloring by a continuous variable that had not already been binned, we would select <code>Graduated</code> and select values for the bins. See <a href="https://paldhous.github.io/ucb/2016/dataviz/week10.html">this previous class</a> for an example.)</p><p>Click the <code>Classify</code> button and the values in the data will be assigned random colors:</p><p><img src="img/class10_9.jpg" alt=""></p><p>Notice that the range <code>10 - 14</code> is out of order, and we also have a blank range at the bottom. First select this blank and click the red minus symbol to remove it. Now click and drag the range <code>10 - 14</code> to the correct position.</p><p><img src="img/class10_10.jpg" alt=""></p><p>Now click on the <code>Color ramp</code> dropdown menu, select <code>Create New Color Ramp</code>, and at the next dialog box select <code>Catalog: ColorBrewer</code>:</p><p><img src="img/class10_11.jpg" alt=""></p><p>Select the ColorBrewer <code>Reds</code> palette, click <code>OK</code>, and the map should look like this:</p><p><img src="img/class10_12.jpg" alt=""></p><p>Next we’ll remove the black outlines around the polygons. Open <code>Properties&gt;Symbology</code> again, and click on the colored square under <code>Symbol</code>. Select <code>Simple fill</code> in the dialog box, and change <code>Stroke style</code> to <code>No Pen</code>:</p><p><img src="img/class10_13.jpg" alt=""></p><p>Click on <code>OK</code> at each of the dialog boxes and the map should now look like this:</p><p><img src="img/class10_14.jpg" alt=""></p><p>It is also possible to edit the colors for each value individually.</p><p>If you are likely to want to style data with the same column headings in the same way in future, click the <code>Style</code> button in <code>Properties&gt;Symbology</code> and select <code>Save Style&gt;QGIS Layer Style File...</code>. This saves the style in <code>QML</code>, which is a variant of <a href="https://www.w3.org/XML/">XML</a>. When loaded using the <code>Style&gt;Load Style</code>, it will automatically apply the saved styling to future maps.</p><p>Now is a good time to give the map a projection: We will use a variant of the <a href="http://en.wikipedia.org/wiki/Albers_projection">Albers Equal Area Conic projection</a>, optimized for maps of North America.</p><p>Select <code>Project&gt;Properties&gt;CRS</code> (for Coordinate Reference System) from the top menu, type <code>Albers</code>into the <code>Filter</code> box and select <code>North_America_Albers_Equal_Area_Conic</code>, which has the code <code>EPSG:102008</code>:</p><p><img src="img/class10_15.jpg" alt=""></p><p>Click <code>OK</code> and the map should reproject. Notice how <code>EPSG:102008</code> now appears at bottom right. Right-click on the layer and <code>Zoom to Layer</code> so that the view is optimized for this projection:</p><p><img src="img/class10_16.jpg" alt=""></p><p>Save the project, by selecting <code>Project&gt;Save</code> from the top menu.</p><h4 id="add-a-base-layer-showing-land-and-countries"><a name="add-a-base-layer-showing-land-and-countries" href="#add-a-base-layer-showing-land-and-countries"></a>Add a base layer showing land and countries</h4><p>Add the <code>ne_50m_admin_0_countries_lakes</code> layer, as before. It will appear above our choropleth map:</p><p><img src="img/class10_17.jpg" alt=""></p><p>So click and drag the <code>ne_50m_admin_0_countries_lakes</code> layer below the <code>seismic</code> layer in the <code>Layers Panel</code>.</p><p><img src="img/class10_18.jpg" alt=""></p><p>Now open up <code>Properties&gt;Symbology</code> for the <code>ne_50m_admin_0_countries_lakes</code> layer, select <code>Simple fill</code>, and click on the <code>Fill</code> color to change it to <code>#cccccc</code> for a light gray. Also change the <code>Outline</code> to <code>#ffffff</code> for white:</p><p><img src="img/class10_19.jpg" alt=""></p><p>Click <code>OK</code> and the map should look like this:</p><p><img src="img/class10_20.jpg" alt=""></p><p>Now select <code>Project&gt;Project Properties...&gt;General</code>, click on the <code>Background color</code> and set it to <code>#f5f5f5</code> for a lighter gray:</p><p><img src="img/class10_21.jpg" alt=""></p><p>The map should now look like this:</p><p><img src="img/class10_22.jpg" alt=""></p><h4 id="add-the-earthquakes-layer"><a name="add-the-earthquakes-layer" href="#add-the-earthquakes-layer"></a>Add the earthquakes layer</h4><p>To import a CSV or other delimited text file with points described by latitude and longitude coordinates, select <code>Layer&gt;AddLayer&gt;Add Delimited Text Layer</code> from the top menu or click this icon:</p><p><img src="img/class10_23.jpg" alt=""></p><p>Navigate to the file <code>quakes.csv</code>, and ensure that the dialog box is filled in like this:</p><p><img src="img/class10_24.jpg" alt=""></p><p>If your text file is not a CSV you may have to select the correct delimiter, and if your latitude and longitude fields have other names, you may have to select the <code>X field</code> (longitude) and <code>Y field</code> (latitude) manually.</p><p><mark><strong>Important:</strong></mark> Do not change the CRS, or projection to the same Albers projection we have set for the project. QGIS will handle the conversion to that projection. Because the data in the CSV file is not yet projected, stick with the default equirectangular projection <code>WGS 84 EPSG:4326</code> at this dialog box.</p><p>Click <code>Add</code> and a large number of points will be added to the map:</p><p><img src="img/class10_25.jpg" alt=""></p><p>Now we will style these points, giving them a single color but sizing them according to the amount of shaking that quake each caused. Open the attribute table for the quakes layer and notice that it contains a variable called <code>mag</code>, for earthquake magnitude. This is a logarithmic scale, so that a magnitude difference of 1 corresponds to a 10-fold difference in earth movement, as recorded on a seismograph, as <a href="https://earthquake.usgs.gov/learn/topics/calculator.php">this calculator</a> shows:</p><p><img src="img/class10_26.jpg" alt=""></p><p>This means that the equation to convert magnitude into the amplitude of the shaking, as recorded on a seismograph, is <code>amplitude = 10^magnitude</code>, or ten raised to the power of magnitude.</p><p>So if we want to scale the points according to the actual size of the quake, we need to create a new field in the data for amplitude. To do this, click on the abacus symbol in the top toolbar:</p><p><img src="img/class10_27.jpg" alt=""></p><p>Fill in the dialog box as follows:</p><p><img src="img/class10_28.jpg" alt=""></p><p>The formula  is: <code>amplitude = 10^mag/100000</code>. The final division by 100,000 helps keep the values in a range that is easy to read and understand, which will help when we set the size of the points. The <code>Output preview</code> at the bottom shows the resulting value for the first row in the attribute table. Click <code>OK</code> to create the new <code>amplitude</code> variable.</p><p>Select <code>Properties&gt;Symbology</code> for the <code>quakes</code> layer, set the <code>Color</code> to <code>#ffffff</code> for white and the <code>Opacity</code> to <code>50%</code>:</p><p><img src="img/class10_29.jpg" alt=""></p><p>Now click on this icon for <code>Size</code>, and select <code>Assistant...</code>:</p><p><img src="img/class10_30.jpg" alt=""></p><p>Fill in the dialog box as follows:</p><p><img src="img/class10_31.jpg" alt=""></p><p>Using the <code>Scale method</code> of <code>Surface</code> will scale the circles by area, according to values in the data; <code>Flannery</code> is a <a href="https://makingmaps.net/2007/08/28/perceptual-scaling-of-map-symbols/">method of scaling</a> that is designed to compensate for the errors people make when estimating the area of circles. You may wish to experiment with this, but I would strongly advise against using <code>Radius</code>, for the reasons we discussed in week 2.</p><p>By default, QGIS will select the range of values in the data, when you hit the refresh icon:</p><p><img src="img/class10_32.jpg" alt=""></p><p>Make sure to set both <code>Size from</code> and <code>Values from</code> to zero to ensure that the area of the points scales accurately according to values in the data.</p><p>Click <code>OK</code> until you return to the map, which should now look like this:</p><p><img src="img/class10_33.jpg" alt=""></p><h4 id="export-the-finished-map-in-raster-image-or-vector-graphic-formats"><a name="export-the-finished-map-in-raster-image-or-vector-graphic-formats" href="#export-the-finished-map-in-raster-image-or-vector-graphic-formats"></a>Export the finished map in raster image or vector graphic formats</h4><p>To export the map as a JPG, PNG, or other raster image format, select <code>Project&gt;Import/Export&gt;Exoert Map To Image...</code> from the top menu.</p><p>Exporting using <code>Project&gt;Import/Export&gt;Expert Map To PDF...</code> will give a vector graphic that can be further edited in <a href="http://www.adobe.com/products/illustrator.html">Adobe Illustrator</a> or another vector graphic editing program.</p><p>To export as a vector graphic with other features, select <code>Project&gt;New Print Layout</code>, give the composer an appropriate name and click <code>OK</code>. Set <code>Page size</code> as required, then click the <code>Add new map</code> icon:</p><p><img src="img/class10_34.jpg" alt=""></p><p>Draw a rectangle over the page area, and the map should appear. At this point, you may need to alter the zoom level and position of your map in the main QGIS display to get a pleasing display in the print layout.</p><p>Your print layout should now look something like this:</p><p><img src="img/class10_35.jpg" alt=""></p><p>The print layout also allows you to add and edit a legend, by clicking this icon:</p><p><img src="img/class10_36.jpg" alt=""></p><p>You can also add text and other items. In practice, however, you may find it easier to add legends and labels in Adbobe Illustrator.</p><p>The map can be exported in SVG and PDF vector formats by clicking these export icons:</p><p><img src="img/class10_37.jpg" alt=""></p><p>Finally, save the QGIS project.</p><h3 id="make-a-map-with-tiled-basemap"><a name="make-a-map-with-tiled-basemap" href="#make-a-map-with-tiled-basemap"></a>Make a map with tiled basemap</h3><p>Open a new project by selecting <code>Project&gt;New</code> from the top menu.</p><p>We will now make a map showing the earthquakes that rocked Ridgecrest, California, in July 2019 superimposed on a tiled basemap.</p><p>To pull in the baemap, we will use a QGIS plugin called <code>QuickMapServices</code>. Select <code>Plugins&gt;Manage and Install Plugins...</code> from the top menu and search for     <code>QuickMapServices</code>:</p><p><img src="img/class10_38.jpg" alt=""></p><p>Click <code>Install Plugin</code>, and close the dialog box.</p><p>This icon should now appear somewhere in your toolbar:</p><p><img src="img/class10_39.jpg" alt=""></p><p>This plugin allows you to search for layers with basemaps and place labels. We will explore some of the options available in class. Search for <code>ESRI Terrain</code>, click <code>Add</code> when the layer appears and then close the <code>Search QMS</code> panel at right:</p><p><img src="img/class10_40.jpg" alt=""></p><p>Add the <code>ridgecrest_quakes.csv</code> data as a delimited text layer, as we did for the quakes on the previous map.</p><p>Zoom in until you find the swarm of quakes around Ridgecrest:</p><p><img src="img/class10_41.jpg" alt=""></p><p>We can now style the quakes as before:</p><p><img src="img/class10_42.jpg" alt=""></p><h3 id="join-external-data-to-a-shapefile"><a name="join-external-data-to-a-shapefile" href="#join-external-data-to-a-shapefile"></a>Join external data to a shapefile</h3><p>Open a new project by selecting <code>Project&gt;New</code> from the top menu.</p><p>In this new project, import the <code>ne_50m_admin_0_countries_lakes</code> shapefile. Right-click on it in the <code>Layers</code> panel and select <code>Export&gt;Save Features As ...</code> an save as <code>ESRI shapefile</code>, keeping the default <code>WGS 84</code> CRS. <code>Browse</code> to the <code>gdp_pc</code> folder, call the new file <code>gdp_pc</code> and check the option to <code>Add saved file to map</code>.</p><p>Now remove the original shapefile, by right-clicking on that layer and selecting <code>Remove Layer</code>.</p><p>Open the attribute table of the new shapefile and notice that it contains a field called <code>iso_a3</code>, which is a <a href="https://unstats.un.org/unsd/tradekb/Knowledgebase/Country-Code">three-letter code</a> for each country, assigned by the <a href="https://www.iso.org/iso/home/store/catalogue_tc/catalogue_detail.htm?csnumber=63545">International Organization for Standardization</a>.</p><p>Now use <code>Add Vector Layer</code> to import the file <code>gdp_pc.csv</code>. (Note that when joining external data in a CSV file to a shapefile, you do <em>not</em> import the file as a delimited text file, as we did previously to display data on a map.)</p><p>After import, this file will appear as an isolated table in the <code>Layers</code> panel.</p><p><img src="img/class10_43.jpg" alt=""></p><p>Select it and open the attribute table to view the data, which contains country names, the three-letter country codes, and data on GDP per capita in 2017:</p><p><img src="img/class10_44.jpg" alt=""></p><p>Notice that some cells contain the value <code>-99</code>, which is here being used to designate <code>null</code> values, where there is no data.</p><p>The same subfolder with the file also contains the file <code>gdp_pc.csvt</code>. This contains information about the type of data in each field of the CSV file, in this case:</p><pre class="r hljs"><code class="r" data-origin="<pre><code class=&quot;r&quot;>&quot;String&quot;,&quot;String&quot;,&quot;Real&quot;
</code></pre>"><span class="hljs-string">"String"</span>,<span class="hljs-string">"String"</span>,<span class="hljs-string">"Real"</span>
</code></pre><p>When we make the join, this will tell QGIS what sort of data is in each field of the CSV file. <code>String</code> indicates a string of text, <code>Real</code> indicates numbers that can include decimals, while <code>Integer</code> indicates whole numbers. Without this information, QGIS will treat all of the fields in the file as text.</p><p>Close the attribute table once more, right-click on the <code>gdp_pc</code> shapefile and select <code>Properties&gt;Joins</code>. Click the green plus sign and fill in the dialog box as follows to join the CSV file to the shapefile by the <code>iso_a3</code> three-letter country codes:</p><p><img src="img/class10_45.jpg" alt=""></p><p>Click <code>OK</code> at each dialog box to complete the join, then open shapefile’s attribute table once more to confirm that the data from the CSV file has appeared.</p><h4 id="save-the-joined-data-in-another-geodata-format"><a name="save-the-joined-data-in-another-geodata-format" href="#save-the-joined-data-in-another-geodata-format"></a>Save the joined data in another geodata format</h4><p>Right-click on the joined shapefile, select <code>Export&gt;Save Features As ...</code> and save this file in the <code>gpd_pc</code> folder as GeoJSON with an appropriate name, keeping the default <code>WGS 84</code> CRS.</p><h4 id="use-qgis's-vector-geoprocessing-tools"><a name="use-qgis's-vector-geoprocessing-tools" href="#use-qgis's-vector-geoprocessing-tools"></a>Use QGIS’s vector geoprocessing tools</h4><p>Start a new project, and import both the <code>ne_50m_admin_0_countries_lakes</code> shapefile, and the <code>seismic_raw</code> shapefile. Note that it extends beyond the coastline of the U.S.:</p><p><img src="img/class10_46.jpg" alt=""></p><p>Turn off the visibility of the  <code>seismic_raw</code> layer, turn on the visibility of the <code>ne_50m_admin_0_countries_lake</code> layer, select it in the <code>Layers Panel</code>, and click the <code>Select feature(s)</code> button:</p><p><img src="img/class10_47.jpg" alt=""></p><p>Now click anywhere within the borders of the United States to select the nation, which should now appear yellow:</p><p><img src="img/class10_48.jpg" alt=""></p><p>Select <code>Vector&gt;Geoprocessing Tools&gt;Intersection</code> from the top menu and fill in the dialog box as follows:</p><p><img src="img/class10_49.jpg" alt=""></p><p>Click <code>Run</code> and a new layer will be created, clipped to coastline of the United States:</p><p><img src="img/class10_50.jpg" alt=""></p><p>Its attribute table will contain data from both layers used for the intersection.</p><p>You can now right-click on the new <code>Intersection</code> layer and <code>Save As ...</code> as a shapefile, GeoJSON, or another geodata format.</p><p>Look at the other options in the <code>Vector&gt;Geoprocessing Tools</code> menu. Their icons give a good idea of what they do. (<code>Clip</code> is similar to <code>Intersection</code>, except that it does not include data from both layers in the new attribute table.)</p><p>Now open a new project, and import the shapefile <code>sf_test_addresses</code>. I made this shapefile from the addresses we geocoded in week 9. I saved it in a <code>Web Mercator</code> projection, also known as <code>EPSG:3857</code>, commonly used for online maps.</p><p>This is important, because we are going to create a “buffer” defining areas within 1,000 feet of the nearest point. For this we need a projection with units defined in distance, rather than degrees, which is the unit for the <code>WGS 84</code> datum.</p><p>To confirm the units for the <code>Web Mercator</code> projection, click on the button showing the CRS at bottom-right:</p><p><img src="img/class10_51.jpg" alt=""></p><p>You should see that the CRS/projection information that appears near the bottom of the dialog box contains <code>+units=m</code>, which tells us that distances in this projection are measured in meters:</p><p><img src="img/class10_52.jpg" alt=""></p><p>Creating a buffer shapefile is a task you might perform if, for example, working out which areas are off-limits for sex offenders under <a href="http://www.atsa.com/pdfs/Policy/2014SOResidenceRestrictions.pdf">residency restrictions</a>.</p><p>Select <code>Vector&gt;Geoprocessing Tools&gt;Fixed distance buffer</code> and fill in the dialog box as follows:</p><p><img src="img/class10_53.jpg" alt=""></p><p>Selecting <code>99</code> under <code>Segments to approximate</code> ensures that the resulting shapes are as smooth circles. Checking <code>Dissolve result</code> merges overlapping buffers into the same polygon.</p><p>Click <code>Run</code>, and this should be the result:</p><p><img src="img/class10_54.jpg" alt=""></p><p>Again, you can now right-click on the new <code>Buffer</code> layer and <code>Save As ...</code> as a shapefile, GeoJSON, or another geodata format.</p><h3 id="assignment"><a name="assignment" href="#assignment"></a>Assignment</h3><p>File an update on progress with your final project. Pay particular attention to identifying problems/obstacles.</p><p>You can file the update as a markdown file in GitHub. Make sure that your GitHub repo is up to date with data, charts etc, so that I can sync with my version of your project and review your progress. The update should be sufficiently detailed that I can look at your repo and understand what you are doing.</p><p>If you are having trouble with GitHub, get in contact for a refresher.</p><h3 id="further-reading"><a name="further-reading" href="#further-reading"></a>Further reading</h3><p><a href="https://docs.qgis.org/testing/en/docs/training_manual/index.html">QGIS Training Manual</a></p><p><a href="https://docs.qgis.org/testing/en/docs/">QGIS User Guide</a></p><p><a href="https://docs.qgis.org/testing/en/docs/gentle_gis_introduction/index.html">A Gentle Introduction to GIS</a></p>

	</div> <!-- /.container all -->
	<script src="https://code.jquery.com/jquery.min.js"></script>
	<script src="../../js/bootstrap.min.js"></script>
</body>
</html>
