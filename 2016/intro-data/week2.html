<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Acquiring, cleaning, and formatting data</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="../../css/bootstrap.min.css" rel="stylesheet"> 
  <link href="../../css/custom.css" rel="stylesheet">
</head>

<body class="markdown github">

	<header class="navbar-inverse navbar-fixed-top">
		<div class="container">
			<nav role="navigation">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a href="index.html" class="navbar-brand">Intro Data Journalism
					</a>
				</div> <!-- /.navbar-header -->
				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
					<ul class="nav navbar-nav">
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">Class notes<b class="caret"></b></a>
							<ul class="dropdown-menu">
								<li><a href="week1.html">What is data? And what can it do for me?</a></li>
								<li><a href="week2.html">Acquiring, cleaning, and formatting data</a></li>
								<li><a href="week3.html">Journalism with spreadsheets</a></li>
								<li><a href="week4.html">Making charts and maps</a></li>	
							</ul>
						</li>
						<li><a href="software.html">Software</a></li>
						<li><a href="datasets.html">Data</a></li>
						<li><a href="mailto:peter@peteraldhous.com">Email instructor</a></li>					
					</ul>
				</div><!-- /.navbar-collapse -->
			</nav>
		</div> <!-- /.navbar-header -->
	</header>

	<div class="container all">

<h1 id="acquiring,-cleaning,-and-formatting-data"><a name="acquiring,-cleaning,-and-formatting-data" href="#acquiring,-cleaning,-and-formatting-data"></a>Acquiring, cleaning, and formatting data</h1><p>Not so many years ago, data was hard to obtain. Often journalists would have to painstakingly compile their own datasets from paper records.</p><p>The Internet has changed the game. While those methods may still be needed on occasions, many government databases can now be queried online, and the results of those searches downloaded. Other public datasets can be downloaded in their entirety.</p><p>The main problem today is usually not finding relevant data, but in working out whether it can be trusted, spotting and correcting errors and inconsistencies, and getting it in the right format for analysis and visualization.</p><p>Today, we will cover some tips and tricks for finding the data you need online, getting it onto your computer, and how to recognize and clean “dirty” data.</p><h3 id="the-data-we-will-use-today"><a name="the-data-we-will-use-today" href="#the-data-we-will-use-today"></a>The data we will use today</h3><p>Download the data for this session from <a href="data/week2.zip">here</a>, unzip the folder and place it on your desktop. It contains the following files:</p><ul>
<li><p><code>techexports.xls</code> <a href="http://data.worldbank.org/indicator/TX.VAL.TECH.CD">High-technology exports</a> from 1990 to 2015, in current U.S dollars, from the UN Comtrade database, supplied via the World Bank. High-technology exports include products in aerospace, computers, pharmaceuticals, scientific instruments, and electrical machinery.</p>
</li><li><p><code>richmond_collisions.csv</code> Data on injury and fatal traffic accidents in Richmond, California, from 2005 to 2013, from the <a href="http://tims.berkeley.edu/page.php?page=about">Transportation Injury Mapping System</a>. The data comes from the California Highway Patrol’s <a href="http://iswitrs.chp.ca.gov/Reports/jsp/userLogin.jsp">Statewide Integrated Traffic Records System</a> and was then geocoded for mapping by UC Berkeley’s Safe Transportation Research &amp; Education Center.</p>
</li></ul><h3 id="data-portals"><a name="data-portals" href="#data-portals"></a>Data portals</h3><p>Life is much easier if you can find everything you need in one place. The main effort to centralize access to data by the U.S. federal government is <a href="http://www.data.gov/">Data.gov</a>. You can search for data from the home page, or follow the <a href="http://catalog.data.gov/dataset">Data</a> and Topics links from the top menu.</p><p>Be warned, however, that Data.gov is a work in progress, and does not contain all of the U.S. government’s data. Some of the most useful datasets are still only available on the websites of individual federal agencies. <a href="http://fedstats.sites.usa.gov/">FedStats</a> has <a href="https://fedstats.sites.usa.gov/agencies/">links to agencies</a> with with data collections.</p><p>As a journalist, it is worth familiarizing yourself with the main federal government agencies that have responsibility for the beats you are interested in, and the datasets they maintain. Here are some examples of agencies with useful data:</p><ul>
<li><p><strong><a href="http://www.census.gov/">U.S. Census Bureau</a></strong>: population, demographic, economic and other data, including trade and manufacturing statistics. The <a href="http://factfinder2.census.gov/faces/nav/jsf/pages/index.xhtml">American FactFinder</a> is especially useful for summary data about specific geographical areas. As well as running the decadal national census, the bureau operates other surveys, which provide more detailed information from representative samples of the U.S. population, including the <a href="http://www.census.gov/programs-surveys/cps.html">Current Population Survey</a> (run jointly with the Bureau of Labor Statistics, see below) and the <a href="http://www.census.gov/programs-surveys/acs/">American Community Survey</a>.</p>
</li><li><p><strong><a href="http://www.bls.gov/">Bureau of Labor Statistics</a></strong>: employment and unemployment, workplace injuries, time use, pay and consumer spending, including the <a href="http://www.bls.gov/cpi/">Consumer Price Index</a>, a key measure of inflation. Browse its datasets <a href="http://www.bls.gov/data/">here</a>.</p>
</li><li><p><a href="http://www.bjs.gov/"><strong>Bureau of Justice Statistics</strong></a>: crime and law enforcement. <a href="http://www.bjs.gov/index.cfm?ty=dca">Here</a> is its full list of data collections. The <a href="http://www.bjs.gov/index.cfm?ty=dcdetail&amp;iid=245">National Crime Victimization Survey</a> is an especially useful resource, which together with the Federal Bureau of Investigation’s <a href="https://ucr.fbi.gov/">Uniform Crime Reporting</a> program provides the best national data on crime.</p>
</li><li><p><strong><a href="http://www.cdc.gov/">Centers for Disease Control and Prevention</a></strong>: The <a href="http://wonder.cdc.gov/">WONDER</a> online databases provide a wealth of information, including on causes of death. Other health datasets are available through the CDC’s <a href="http://www.cdc.gov/nchs/">National Center for Health Statistics</a>.</p>
</li><li><p><strong><a href="http://www.noaa.gov/">National Oceanic and Atmospheric Administration</a></strong>: <a href="http://www.climate.gov/maps-data">climate</a> and <a href="http://www.weather.gov/">weather</a>, including <a href="http://www.nws.noaa.gov/ndfd/">forecasts</a>, and historical records of <a href="http://www.spc.noaa.gov/gis/svrgis/">severe weather</a> events.</p>
</li></ul><h4 id="local-data"><a name="local-data" href="#local-data"></a>Local data</h4><p>Many large cities, including Oakland, maintain their own data portals. At <a href="https://data.oaklandnet.com/">OakData</a>, you can search for data using the box at top right, or navigate using the green topic area buttons at the bottom.</p><p><img src="img/class2_1.jpg" alt=""></p><p>(Source: <a href="https://data.oaklandnet.com/">OakData</a>)</p><p>Click on the <code>Public Safety</code> button, and then the <code>CrimeWatch Maps Past 90-days</code> link to see the format of a typical dataset. Oakland uses a system called <a href="https://socrata.com/">Socrata</a> to store its data, which is used by many state and local government agencies. Clicking on the blue <code>Export</code> button will bring up a series of options, including downloading as a CSV file:</p><p><img src="img/class2_2.jpg" alt=""></p><p>(Source: <a href="https://data.oaklandnet.com/">OakData</a>)</p><p>Oakland also has an active volunteer open data community, which has obtained a variety of public datasets, and <a href="http://data.openoakland.org/">made them available</a> for easy download. Again there are simple search and navigation options:</p><p><img src="img/class2_3.jpg" alt=""></p><p>(Source: <a href="http://data.openoakland.org/">OpenOakland</a>)</p><h4 id="using-the-american-factfinder-to-obtain-local-data"><a name="using-the-american-factfinder-to-obtain-local-data" href="#using-the-american-factfinder-to-obtain-local-data"></a>Using the American Factfinder to obtain local data</h4><p>Smaller cities, including Richmond, usually don’t have dedicated data portals. However, the Census Bureau’s American FactFinder is a key resource to obtain basic statistics about any geographic area in the United States, large or small.</p><p>Navigate to the <a href="http://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml">FactFinder</a>. You can find basic demographic and other information on Richmond by typing <code>Richmond, California</code> into the search box and accepting the suggestion of <code>Richmond city, California</code>:</p><p><img src="img/class2_4.jpg" alt=""></p><p>(Source: <a href="http://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml">American FactFinder</a>)</p><p>Each of the topic area tabs at the left opens up links to specific data tables. Notice that if you click through to any of the data tables, you have the option to download as a CSV file or Excel spreadsheet.</p><p>Navigate back to the FactFinder home page, and we’ll now use the <code>Guided Search</code> to ask a specific question: </p><ul>
<li>How many households in Richmond receive food stamps or other public income assistance?</li></ul><p>Select <code>Guided Search&gt;GET ME STARTED</code> and then the default option to look for information about<code>People</code>. Under <code>Topics</code>, open the menu for <code>Poverty</code> and select <code>Food Stamps/SNAP</code>. Notice that this now moves into <code>Your Selections</code>:</p><p><img src="img/class2_5.jpg" alt=""></p><p>(Source: <a href="http://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml">American FactFinder</a>)</p><p>Under <code>Geographies</code>, start typing <code>Richmond, California</code> and select the <code>Richmond city, California</code> option, so Richmond is added to <code>Your Selections</code>:</p><p><img src="img/class2_6.jpg" alt=""></p><p>(Source: <a href="http://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml">American FactFinder</a></p><p>We’ll skip <code>Race/Ethnic Groups</code>, so select <code>Search Results</code> to show the tables that contain relevant data:</p><p><img src="img/class2_7.jpg" alt=""></p><p>(Source: <a href="http://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml">American FactFinder</a>)</p><p>This is where the FactFinder can get a little bewildering. Which table contains the data I need? Notice that all of the top search returns are from either the <code>2014 ACS 5-year estimates</code> or the <code>2014 ACS 1-year estimates</code>. ACS is the <a href="">American Community Survey</a>, which samples about 1 in 40 American households each year. The 1-year estimates are based on a single-year’s survey, while the 5-year estimates are for the five years ending in that year, here 2010-2014. Because they are based on a larger sample, the 5-year estimates are more precise, but they gain that precision at the cost of losing information on changes over time. Which one you <a href="http://www.census.gov/programs-surveys/acs/guidance/estimates.html">choose to use</a> will be a trade-off.</p><p>If you follow the first few links, you’ll see that the two tables with the ID <code>B19058</code> contain the numbers we want.</p><p><strong>Here are the 5-year estimates:</strong></p><p><img src="img/class2_8.jpg" alt=""></p><p><strong>And here are the 1-year estimates:</strong></p><p><img src="img/class2_9.jpg" alt=""></p><p>(Source: <a href="http://factfinder.census.gov/faces/nav/jsf/pages/index.xhtml">American FactFinder</a>)</p><p>Notice that you can look at earlier years’ installments of the same data, and that each number has a margin of error. (These are just like the margins of errors for election and opinion polls, except that they are given as raw numbers, rather than percentage points, and the Census Bureau uses a 90% confidence interval, rather than the 95% typically used in polling.)</p><p>Given the large fluctuations from year to year in the 1-year estimates, and their large margins of error, I would use the 5-year estimates in this case and say that over the five years from 2010 to 2014, about 4,500 of the roughly 35,000 households in Richmond received food stamps or other public income assistance in each year.</p><h4 id="international-data"><a name="international-data" href="#international-data"></a>International data</h4><p>If you need to make comparisons between nations, the <a href="http://www.worldbank.org/"><strong>World Bank</strong></a> probably has what you need. Its <a href="http://data.worldbank.org/indicator/?tab=all">World Development Indicators catalog</a> containing data for more than 7,000 different measures, compiled by the bank and other UN agencies.</p><p>You can navigate the site using the <code>Find an indicator</code> search box or the <a href="http://data.worldbank.org/topic">By Topic</a> link. When you click on a particular indicator, you are sent to a page that gives options to download the dataset from a link near the top right of the page. The data in some cases goes back as far as 1960, and is listed both by individual country and summarized by regions and World Bank income groups.</p><p>Other useful sources of data for international comparisons are <a href="http://www.gapminder.org/data/"><strong>Gapminder</strong></a> and the <strong><a href="http://unstats.un.org/unsd/default.htm">UN Statistical Division</a></strong>. For health data in particular, try the <strong><a href="http://www.oecd.org/els/health-systems/health-data.htm">Organisation for Economic Co-operation and Development</a></strong> and the <strong><a href="http://who.int/research/en/">World Health Organization</a></strong>.</p><h3 id="search-for-data-on-the-web"><a name="search-for-data-on-the-web" href="#search-for-data-on-the-web"></a>Search for data on the web</h3><p>Often, however, your starting point in searching for data will be Google. Often simply combining a few keywords in a Google search with “data” or “database” is enough to find what you need, but it can be worth focusing your queries using Google’s <a href="http://www.google.com/advanced_search">advanced search</a>:</p><p><img src="img/class2_10.jpg" alt=""></p><p>(Source: <a href="http://www.google.com/advanced_search">Google</a>)</p><p>The options to search by <code>site or domain</code> and <code>file type</code>can be very useful when looking for data. You can make the domains as narrow or broad as you like: <code>.gov</code>, for instance, would search a wide range of U.S. government sites, while <code>.edu</code> would search the sites of all academic institutions using that top-level domain; <code>journalism.berkeley.edu</code> would search the web pages of the Berkeley J-School only.</p><p>The <code>file type</code> search offers a drop-down menu, with the options including Excel spreadsheets, and Google Earth <code>KML</code> and <code>KMZ</code> files. These are common data formats, but you are not limited to those on the menu. In a regular Google search, type a space after your search terms followed by <code>filetype:xxx</code>, where <code>xxx</code> is the suffix for the file type in question. For example, <code>dbf</code> will look for database tables in this format. Combining file type and domain searches can be a good way to find data an agency has posted online — some of which may not otherwise be readily accessible.</p><h3 id="search-online-databases"><a name="search-online-databases" href="#search-online-databases"></a>Search online databases</h3><p>Many important public databases can be searched online, and some offer options to download the results of your queries. Most of these databases give a simple search box, but it’s always worth looking for the advanced search page, which will offer more options to customize your search. Here, for example, is the <a href="http://clinicaltrials.gov/ct2/search/advanced">advanced search</a> page for <a href="http://clinicaltrials.gov/">ClinicalTrials.gov</a>, a database of tests of experimental drugs and other medical treatments taking place in the United States and beyond:</p><p><img src="img/class2_11.jpg" alt=""></p><p>(Source: <a href="http://clinicaltrials.gov/ct2/search/advanced">ClinicalTrials.gov</a>)</p><p>When you start working with a new online database, take some time to familiarize yourself with how its searches work: Read the Help or FAQs, and then run test searches to see what results you obtain. <a href="http://clinicaltrials.gov/ct2/help/how-find/index">Here</a>, for example, is the “How To” section of ClinicalTrials.gov.</p><p>Many online databases can be searched using <strong>Boolean logic</strong>, using the operators <code>AND</code>, <code>OR</code> and <code>NOT</code> to link search terms together. <code>AND</code> will return only data including both search terms; <code>OR</code> will return data containing either term; <code>NOT</code> will return data containing the first term but not the second.</p><p>So find out how a particular database uses Boolean logic — and the default settings that it will use if you list search terms without any Boolean operators.</p><p>Putting search terms in quote marks often searches for a specific phrase. For example, searching for “heart attack” on ClinicalTrials.gov will give only give results in which those two words appear together; leaving out the quote marks will include any trial in which both words appear.</p><p>Also find out whether the database allows “wildcards,” symbols such as <code>*</code> or <code>%</code> that can be dropped into your search to obtain results with variations on a word or phrase.</p><h3 id="look-for-download-options----and-know-when-you-are-hitting-the-wall"><a name="look-for-download-options----and-know-when-you-are-hitting-the-wall" href="#look-for-download-options----and-know-when-you-are-hitting-the-wall"></a>Look for download options — and know when you are hitting the wall</h3><p>Having run a search on an online database, you will usually want to download the results, so look for the download links or buttons.</p><p>A common problem with online databases, however, is that they may impose limits on the number of results that are returned on each search. And even when a search returns everything, there may be a limit on how many of those results can be downloaded to your own computer.</p><p>If broad searches on a database keep returning the same number of results, that is a sign that you are probably running up against a search limit, and any download will not contain the complete set of data that you are interested in. However, you may be able to work out ways of searching to obtain all of the data in chunks.</p><h3 id="download-the-entire-database"><a name="download-the-entire-database" href="#download-the-entire-database"></a>Download the entire database</h3><p>Downloading an entire database, where this is allowed, frees you from the often-limited options given on an online advanced search form: You can then analyze it in any way that you want.</p><p>So always look for ways to grab all of the data. One trick is to run a search on just the database’s wildcard character, or with the query boxes left blank. If you do the latter at ClinicalTrials.gov, for instance, your search will return all of the trials in the database, which can then be downloaded using the options at the bottom of the results page.</p><p>Other databases have an online search form, but also have a separate link from where data to be downloaded in its entirety, usually as a text file or series of text files.</p><p>Note that large text files are again often stored in compressed folders, so may be invisible to a Google search by file type.</p><h3 id="ask-for-what-you-don't-find"><a name="ask-for-what-you-don't-find" href="#ask-for-what-you-don't-find"></a>Ask for what you don’t find</h3><p>If you don’t find what you’re looking for, speak to government officials, academic experts, and other sources who should know about what data exists, and ask whether they can provide it for you. If necessary, you can use the federal <a href="https://www.foia.gov/">Freedom of Information Act</a> or state equivalents (for example the <a href="http://www.thefirstamendment.org/publicrecordsact.pdf">California Public Records Act</a>), to obtain entire datasets from public bodies. Open records laws are not restricted to documents: Datasets maintained by official bodies are often considered public records, so you are entitled to ask for them. As we discussed in the Week 1, ask for data to be provided as CSV or other delimited text files.</p><h3 id="automate-downloads-of-multiple-data-files"><a name="automate-downloads-of-multiple-data-files" href="#automate-downloads-of-multiple-data-files"></a>Automate downloads of multiple data files</h3><p>Often data doesn’t reside in a single searchable database, but instead exists online as a series of separate files. In such cases, clicking on each link is tedious and time-consuming. But you can automate the process using the <a href="https://addons.mozilla.org/en-US/firefox/addon/downthemall/">DownThemAll!</a> Firefox add-on.</p><p>To illustrate, go to <a href="http://www.gapminder.org/data/">Gapminder’s data catalog</a>, and select <code>All</code> indicators. The webpage now includes links to more than 500 downloadable spreadsheets.</p><p>At the dialog box, you can choose where to save the files, and to filter the links to select just the files you want. In this case, unchecking all the boxes and <code>Fast Filtering</code> using the letters <code>xls</code>, which appear in each of the download links, will correctly identify the spreadsheet downloads:</p><p><img src="img/class2_12.jpg" alt=""></p><h3 id="extract-data-from-tables-on-the-web"><a name="extract-data-from-tables-on-the-web" href="#extract-data-from-tables-on-the-web"></a>Extract data from tables on the web</h3><p>On other occasions, data may exist in tables on the web. Copying and pasting data from web tables can be tricky, but the <a href="https://addons.mozilla.org/en-US/firefox/addon/dafizilla-table2clipboard/">Table2Clipboard</a> Firefox add-on can simplify the process.</p><p>Before using the add-on, select <code>Tools&gt;Table2Clipboard</code> and choose the following options under the <code>CSV</code> tab:</p><p><img src="img/class2_13.jpg" alt=""></p><p>This will ensure that each row in the extracted data is put on a <code>new line</code>, and each column is separated by a <code>tab</code>.</p><p>To illustrate what Table2Clipboard does, go to <a href="http://www.realclearpolitics.com/epolls/2016/president/us/general_election_trump_vs_clinton-5491.html">this page</a> at RealClearPolitics with recent presidential polling data, right-click anywhere in the table and select <code>Table2Clipboard&gt;Copy whole table</code>:</p><p><img src="img/class2_14.jpg" alt=""></p><p>You can now paste the data into an empty text file, or into a spreadsheet.</p><h3 id="pdfs:-the-bane-of-data-journalism"><a name="pdfs:-the-bane-of-data-journalism" href="#pdfs:-the-bane-of-data-journalism"></a>PDFs: the bane of data journalism</h3><p>Some organizations persist in making data available as PDFs, rather than text files, spreadsheets or databases. This makes the data hard to extract. While you should always ask for data in a more friendly format — ideally a CSV or other simple text file — as a data journalist you are at some point likely to find yourself needing to pull data out of a PDF.</p><p>For digital PDFs, <strong><a href="http://tabula.technology/">Tabula</a></strong> is a useful data extraction tool — however it will not work with PDFs created by scanning the original document, which have to be interpreted using Optical Character Recognition (OCR) software.</p><p>Also useful is the online service <strong><a href="http://www.cometdocs.com/">Cometdocs</a></strong>. While it is a commercial tool, members of Investigative Reporters and Editors can <a href="http://ire.org/blog/ire-news/2013/05/22/ire-announces-partnership-cometdocs/">obtain a free account</a>. Cometdocs can read scanned PDFs, however its accuracy will vary depending on how well the OCR works on the document in question.</p><h3 id="can-i-trust-this-data?"><a name="can-i-trust-this-data?" href="#can-i-trust-this-data?"></a>Can I trust this data?</h3><p>Having identified a possible source of data for your project, you need to ask: Is it reliable, accurate and useful? If you rush into analysis without considering this question, your hard work may be undermined by the maxim: “Garbage In, Garbage Out.”</p><p>The best rule of thumb in determining the reliability of a dataset is find out whether it has been used for analysis before, and if so by whom. If a dataset was put together for an academic study, or is actively curated so it can be made available for experts to analyze, you can be reasonably confident that it is as complete and accurate as it can be.</p><p>While in general you might be more trusting of data downloaded from a <code>.gov</code> or <code>.edu</code> domain than something found elsewhere on the web, don’t simply assume that it is reliable and accurate.</p><p>Government agencies may be required by law to maintain a database, but that doesn’t mean that the information contained in them is wholly reliable. First, forms may not always be submitted, making the data incomplete. Second, information may be entered by hand from the forms into the database — and not surprisingly, mistakes are made.</p><p>So before using any dataset, do some background research to find out how it was put together, and whether it has been rigorously checked for errors. If possible, try to speak to the people responsible for managing the database, and any academics or other analysts who have used the data. They will be your best guide to a dataset’s strengths and weaknesses.</p><p>Even for well-curated data, make a point of speaking with experts who compile it or use it, and ask them about the data’s quirks and limitations.</p><p>Always ask probing questions of a dataset before putting your trust in it. Is this data complete? Is it up-to-date? If it comes from a survey, was it based on a representative sample of people who are relevant to your story? Remember that the first dataset you find online may not be the most relevant or reliable.</p><h3 id="recognize-dirty-data"><a name="recognize-dirty-data" href="#recognize-dirty-data"></a>Recognize dirty data</h3><p>In an ideal world, every dataset we find would have been lovingly curated, allowing us to start analyzing without worrying about its accuracy.</p><p>In practice, however, often the best available data has some flaws, which may need to be corrected as far as is possible. So before starting to work with a new dataset, load it into a spreadsheet and take a look for common errors.</p><p>In text fields, look for obvious mispellings or non-text characters and symbols. For people’s names, look for variations in spelling, format, initials and accents, which may cause the same person to appear in multiple guises. Similar glitches may affect addresses, and any other information entered as text.</p><p>Look for glitches in the alignment of columns, which may cause data to appear in the wrong place.</p><p>Some data offers some obvious checks: If you see a zip code with less than 5 digits, for instance, you know it must be wrong.</p><p>Dates can also be entered incorrectly, so it’s worth scanning for those that fall outside the timeframe that should be covered by the data.</p><p>Also scan numbers in fields that represent continuous variables for any obvious outliers. These values are worth checking out. Are they correct, or did someone misplace a decimal point or enter a number in the wrong units?</p><p>Other common problems are white spaces before and after some entries, or multiple spaces where there should only be a single space. These may need to be stripped out.</p><p>At all stages of your work, pay attention to zeros. Is each one actually supposed to represent zero, or should the cell in fact be empty, or <strong>null</strong>? Take particular care when exporting data from one software tool and importing to another, and check how nulls have been handled.</p><h3 id="clean-and-process-data-with-open-refine"><a name="clean-and-process-data-with-open-refine" href="#clean-and-process-data-with-open-refine"></a>Clean and process data with Open Refine</h3><p>Checking and cleaning “dirty” data, and processing data into the format you need, can be the most labor intensive part of many data journalism projects. However, <strong><a href="http://openrefine.org/">Open Refine</a></strong> (formerly Google Refine) can streamline the task — and also create a reproducible script to quickly repeat the process on data that must be cleaned and processed in the same way.</p><p>When you launch Open Refine, it opens in your web browser. If it does not not launch automatically, open your browser and paste this numeric url into the address bar: </p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>http://127.0.0.1:3333/
</code></pre>">http://127.0.0.1:3333/
</code></pre><p>This refers to a location on your own computer. Any data you load into the program will remain on your computer — it does not get posted online.</p><p>The opening screen should look like this:</p><p><img src="img/class2_15.jpg" alt=""></p><h4 id="reshape-data-from-wide-to-long-format"><a name="reshape-data-from-wide-to-long-format" href="#reshape-data-from-wide-to-long-format"></a>Reshape data from wide to long format</h4><p>Click the <code>Browse</code> button and navigate to the file <code>techexports.xls</code>. Click <code>Next&gt;&gt;</code>, and check that data looks correct:</p><p><img src="img/class2_16.jpg" alt=""></p><p>Open Refine displays numbers and dates in green, and entries treated as text in black.</p><p>It should recognize that the data is in a Excel file, but if not you can use the panel at bottom to specify the correct file type and format for the data.</p><p>Change the project name to <code>techexports_long</code>, so that will be the name of the file we export once we’ve reshaped the data. When you are satisfied that the data has been read correctly, click the <code>Create Project &gt;&gt;</code> button at top right. The screen should now look like this:</p><p><img src="img/class2_17.jpg" alt=""></p><p>As you can see, the data is in wide format, with values for high technology exports by country and group of countries organized in columns, one for each year. To convert this to long format, click on the small downward-pointing triangle for the first of these year columns, and select <code>Transpose&gt;Transpose cells across columns into rows</code>.</p><p>Fill in the dialog box as below, making sure that <code>From Column</code> and <code>To Column</code> are highlighted correctly, that the <code>Key column</code> and <code>Value column</code> have been given appropriate names (<code>Year</code> and <code>Tech exports</code>), and that <code>Fill down in other columns</code> is checked.</p><p>(Failing to check this box will mean that the country names and codes each will only appear once in the reshaped data, rather than being copied down to appear next to the corresponding data for year and the dollar value of high-technology exports.)</p><p><img src="img/class2_18.jpg" alt=""></p><p>Click <code>Transpose</code> and then the <code>50</code> rows link, to see the first 50 rows of the reshaped data:</p><p><img src="img/class2_19.jpg" alt=""></p><p>Click the <code>Export</code> button at top right and export as an <code>Excel</code> spreadsheet.</p><h4 id="save-those-steps,-so-you-can-repeat-them-with-a-future-dataset-at-the-click-of-a-button"><a name="save-those-steps,-so-you-can-repeat-them-with-a-future-dataset-at-the-click-of-a-button" href="#save-those-steps,-so-you-can-repeat-them-with-a-future-dataset-at-the-click-of-a-button"></a>Save those steps, so you can repeat them with a future dataset at the click of a button</h4><p>One huge advantage of Open Refine is that we can extract a “pipeline” for processing data to use when we obtain data in the same format in future.</p><p>Select <code>Undo / Redo</code> at top left, which opens a panel documenting what we did to the data:</p><p><img src="img/class2_20.jpg" alt=""></p><p>Notice that clicking on <code>Create project</code> transforms the data back to its original form, while clicking on the <code>Transpose cells ...</code> step returns to the reshaped data. This ability to jump to any step can be very useful in complex data cleaning, because it means you can return to any step in the process and pick up from there, if you make a mistake.</p><p>Now click the <code>Extract</code> button. This will generate instructions, in a format called JavaScript Object Notation, or JSON, in the right hand panel that can be copied into a blank text file and saved.</p><p><img src="img/class2_21.jpg" alt=""></p><p>To process similar data in future. Click the <code>Apply</code> button on the <code>Undo / Redo</code> tab, paste in the text from this file, and click <code>Perform Operations</code>. The data will then be processed automatically.</p><p>For this simple operation, not much time is saved, but if you have a long and complex data processing pipeline that needs to be repeated, it will save you time, and guard against errors when you try to repeat your steps.</p><h4 id="clean-and-process-dirty-data"><a name="clean-and-process-dirty-data" href="#clean-and-process-dirty-data"></a>Clean and process dirty data</h4><p>Click the Open Refine logo at top left to return to the opening screen.</p><p>Create a new project from the file <code>richmond_collisions.csv</code>. Open Refine should recognize that the file is in CSV format. However, you may need to check <code>Parse cell text into numbers, dates ...</code>:</p><p><img src="img/class2_22.jpg" alt=""></p><p>Edit the project name to <code>richmond_collisons</code> and click <code>Create Project &gt;&gt;</code>.</p><p>Again, each field/column has a button with a downward-pointing triangle. Click on these buttons and you get the option to create <code>Facets</code> for the column, which provide a powerful way to edit and clean data.</p><p>Click on the button for the field <code>PRIMARYRD</code>, and select <code>Facet&gt;Text facet</code>. A summary of the various entries now appears in the panel to the left:</p><p><img src="img/class2_23.jpg" alt=""></p><p>The numbers next to each entry show how many records there are for each value. Notice that there are 155 entries for <code>BARRETT AV</code>, and 5 for <code>BARRETT</code>. We can edit entries individually: Select <code>BARRETT</code>, click on the <code>Edit</code> link, change it to <code>BARRETT AV</code>, and click the <code>Apply</code> button. Now there should be 160 entries for <code>BARRETT AV</code>.</p><p>You can continue editing entires manually, but Open Refine also has a clustering function to help clean text fields. Click the <code>Cluster</code> button to see the following dialog box:</p><p><img src="img/class2_24.jpg" alt=""></p><p>Open Refine allows you to experiment with different clustering algorithms, which match text entries based on their similarity. Which ones perform best will depend on the data, but here I suggest trying the <code>key collision</code> method with the <code>metaphone3</code> keying function.</p><p>This will match some entires that don’t want to be clustered together, like the numbered streets:</p><p><img src="img/class2_25.jpg" alt=""></p><p>But as you scroll down, you will find entries that the algorithm has corrently grouped together. You can edit the text in the boxes at the right to choose the text that will be substituted, when you merge the clusters:</p><p><img src="img/class2_26.jpg" alt=""></p><p>Only those clusters you that check will be merged. Once you are satisfied with your choices, click <code>Merge Selected &amp; Re-Cluster</code> or <code>Merge Selected &amp; Close</code> and the edits will be made.</p><p>Cleaning the <code>PRIMARYRD</code> and <code>SECONDARYRD</code> variables will take some time — but it will be much quicker in Open Refine than if you tried to do this in a spreadsheet.</p><p>Once you are finished with a facet, you can close it by clicking the small <code>x</code> at top left.</p><p>Notice that the variable <code>CASEID</code>, which is a unique ID code for each collision, is being treated as a number. It would be better to treat this as a string of text, so call up its dropdown menu and select <code>Edit cells&gt;Common transforms&gt;To text</code>. Notice that the entires change from green to black and justify to the left.</p><p>Now scroll across to <code>DATE_</code> and notice that it is being treated as text. Call up its dropdown menu and select <code>Edit cells&gt;Common transforms&gt;To date</code> to convert the values into a date and timestamp in international standard format: </p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>YYYY-MM-DDTHH:MM:SSZ
</code></pre>">YYYY-MM-DDTHH:MM:SSZ
</code></pre><p>Here <code>Y</code> refers to year values, <code>M</code> to months, <code>D</code> to days; <code>T</code> marks the transition from date to time, after which <code>H</code> refers to hours, <code>M</code> to minutes and <code>S</code> to seconds, which can include decimal fractions; <code>Z</code> marks the end of the date and timestamp.</p><p>Converting dates and times routinely into this format should ensure that they can be correctly read by any data analysis or visualization software.</p><p>Notice that the <code>Common transforms</code> include <code>Trim leading and trailing whitespace</code> and <code>Collapse consecutive whitespace</code>. Superfluous whitespace is a common with data entered as text, so it is often worth running these transforms as a precaution on all of your variables where it might cause a problem.</p><p>In our last class, we will visualize this data, so let’s now give more intuitive names to the columns we will use:</p><p>Call up the dropdown menu for <code>POINT_X</code>, select <code>Edit column&gt;Rename this column</code> and call it <code>LONGITUDE</code>. Rename other columns as follows:</p><ul>
<li><code>POINT_Y</code> becomes <code>LATITUDE</code></li><li><code>YEAR_</code> becomes <code>YEAR</code></li><li><code>DATE_</code> becomes <code>DATE</code></li><li><code>ETOH</code> becomes <code>ALCOHOL INVOLVED</code></li></ul><p>Finally, create a text facet for the <code>ALCOHOL INVOLVED</code> column and edit the blanks to <code>N</code>.</p><p>Again, we can <code>Extract</code> the steps for future use on similar data. In this case, it would be best to uncheck the steps for editing the text of the primary and secondary roads, as the exact editing and clustering steps would be different if we obtained an update of the data.</p><p>Click the <code>Export</code> button at top right and export as a Excel file.</p><p>Open Refine is a very powerful tool that will reward efforts to explore its wide range of its functions for manipulating data — in this class we have barely scratched the surface of what it can do. See the <strong>Further reading</strong>, below, for more.</p><h3 id="correct-for-inflation-(and-cost-of-living)"><a name="correct-for-inflation-(and-cost-of-living)" href="#correct-for-inflation-(and-cost-of-living)"></a>Correct for inflation (and cost of living)</h3><p>A common task in data journalism and visualization is to compare currency values over time. When doing so, it usually makes sense to show the values after correcting for inflation — for example in constant 2014 dollars for a time series ending in 2014. Some data sources, such as the World Bank, provide some data both in raw form or in a given year’s constant dollars.</p><p>So pay attention to whether currency values have already been corrected for inflation, or whether you will need to do so yourself. When correcting for inflation in the United States, the most widely-used method is the <a href="http://www.bls.gov/cpi/"><strong>Consumer Price Index</strong></a>, or CPI, which is based on prices paid by urban consumers for a representative basket of goods and services. Use this <a href="http://www.bls.gov/data/inflation_calculator.htm">online calculator</a> to obtain conversions.</p><p>If, for example, you need to convert a column of data in a spreadsheet from 2010 dollars into today’s values, fill in the calculator like this:</p><p><img src="img/class2_27.jpg" alt=""></p><p>A dollar today is worth the same as 0.9 dollars in 2010.</p><p>So to convert today’s values into 2010 dollars, use the following formula:</p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>2016 value * 0.9
</code></pre>">2016 value * 0.9
</code></pre><p>And to convert the 2010 values to today’s values, divide rather than multiply:</p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>2010 value / 0.9
</code></pre>">2010 value / 0.9
</code></pre><p>Alternatively, fill in the calculator the other way round, and multiply as before.</p><p><img src="img/class2_28.jpg" alt=""></p><p>Convert 2010 to today’s values:</p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>2010 value * 1.11
</code></pre>">2010 value * 1.11
</code></pre><p>In a spreadsheet, you would need to insert <code>=</code> at the start of each formula.</p><p>For comparing currency values across nations, regions or cities, you may also need to correct for the cost of living — or differences in what a dollar can buy in different places. For World Bank indicators, look for the phrase “purchasing power parity,” or PPP, for data that includes this correction. PPP conversion factors for nations over time are given <a href="http://data.worldbank.org/indicator/PA.NUS.PPPC.RF">here</a>.</p><h3 id="assignment"><a name="assignment" href="#assignment"></a>Assignment</h3><h3 id="further-reading"><a name="further-reading" href="#further-reading"></a>Further reading</h3><p><a href="https://github.com/OpenRefine/OpenRefine/wiki">Open Refine Wiki</a></p><p><a href="https://github.com/OpenRefine/OpenRefine/wiki/Documentation-For-Users">Open Refine Documentation</a></p><p><a href="https://github.com/OpenRefine/OpenRefine/wiki/Recipes">Open Refine Recipes</a></p>

	</div> <!-- /.container all -->
	<script src="http://code.jquery.com/jquery.min.js"></script>
	<script src="../../js/bootstrap.min.js"></script>
</body>
</html>
