<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>class4.html</title>
  <meta name="generator" content="Haroopad 0.13.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF);background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:5px -27px no-repeat #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:#FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:#EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:#75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:1px solid #1A3C6C;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin:0;max-width:none;min-height:0;outline:#112644 0;overflow-x:visible;overflow-y:visible;padding:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}.mermaid .label{color:#333}.node circle,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.edgePath .path{stroke:green;stroke-width:1.5px}.cluster rect{fill:#cdffb2;rx:40;stroke:#6eaa49;stroke-width:1px}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{stroke-width:1.5;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#333}.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:'trebuchet ms',verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:lightgrey;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:lightgrey;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}text{font-family:'trebuchet ms',verdana,arial;font-size:14px}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x;border:0;height:3px;padding:0}hr.underscore{border-top-style:dashed!important}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:url(../img/ajax.gif) center center no-repeat #fff}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}input.task-list-item{margin-left:-1.62em}.markdown{font-family:"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-wrap:break-word}.markdown pre{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;overflow:auto;padding:.5em}.markdown pre code{border:0;display:block}.markdown pre>code{font-family:Consolas,Inconsolata,Courier,monospace;font-weight:700;white-space:pre;margin:0}.markdown code{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown mark{color:#000;background-color:#fcf8e3}.markdown table{padding:0;border-collapse:collapse;border-spacing:0;margin-bottom:16px}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}.github{padding:20px;font-family:"Helvetica Neue",Helvetica,"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Segoe UI",AppleSDGothicNeo-Medium,'Malgun Gothic',Arial,freesans,sans-serif;font-size:15px;background:#fff;line-height:1.6;-webkit-font-smoothing:antialiased}.github a{color:#3269a0}.github a:hover{color:#4183c4}.github h2{border-bottom:1px solid #e6e6e6;line-height:1.6}.github h6{color:#777}.github hr{border:1px solid #e6e6e6}.github pre>code{font-size:.9em;font-family:Consolas,Inconsolata,Courier,monospace}.github blockquote>code,.github h1>code,.github h2>code,.github h3>code,.github h4>code,.github h5>code,.github h6>code,.github li>code,.github p>code,.github td>code{background-color:rgba(0,0,0,.07);font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:85%;padding:.2em .5em;border:0}.github blockquote{border-left:4px solid #e6e6e6;padding:0 15px;font-style:italic}.github table{background-color:#fafafa}.github table tr td,.github table tr th{border:1px solid #e6e6e6}.github table tr:nth-child(2n){background-color:#f2f2f2}.hljs{display:block;overflow-x:auto;padding:.5em;background:#f0f0f0;-webkit-text-size-adjust:none}.hljs,.hljs-subst,.hljs-tag .hljs-title,.nginx .hljs-title{color:#000}.apache .hljs-cbracket,.apache .hljs-tag,.asciidoc .hljs-header,.bash .hljs-variable,.coffeescript .hljs-attribute,.django .hljs-variable,.erlang_repl .hljs-function_or_atom,.haml .hljs-symbol,.hljs-addition,.hljs-constant,.hljs-flow,.hljs-parent,.hljs-pragma,.hljs-preprocessor,.hljs-rules .hljs-value,.hljs-stream,.hljs-string,.hljs-tag .hljs-value,.hljs-template_tag,.hljs-title,.markdown .hljs-header,.ruby .hljs-symbol,.ruby .hljs-symbol .hljs-string,.smalltalk .hljs-class,.tex .hljs-command,.tex .hljs-special{color:#800}.asciidoc .hljs-blockquote,.diff .hljs-header,.hljs-annotation,.hljs-chunk,.hljs-comment,.markdown .hljs-blockquote,.smartquote{color:#888}.asciidoc .hljs-bullet,.asciidoc .hljs-link_url,.go .hljs-constant,.hljs-change,.hljs-date,.hljs-hexcolor,.hljs-literal,.hljs-number,.hljs-regexp,.lasso .hljs-variable,.makefile .hljs-variable,.markdown .hljs-bullet,.markdown .hljs-link_url,.smalltalk .hljs-char,.smalltalk .hljs-symbol{color:#080}.apache .hljs-sqbracket,.asciidoc .hljs-attribute,.asciidoc .hljs-link_label,.clojure .hljs-attribute,.coffeescript .hljs-property,.erlang_repl .hljs-reserved,.haml .hljs-bullet,.hljs-array,.hljs-attr_selector,.hljs-decorator,.hljs-deletion,.hljs-doctype,.hljs-envvar,.hljs-filter .hljs-argument,.hljs-important,.hljs-javadoc,.hljs-label,.hljs-localvars,.hljs-phony,.hljs-pi,.hljs-prompt,.hljs-pseudo,.hljs-shebang,.lasso .hljs-attribute,.markdown .hljs-link_label,.nginx .hljs-built_in,.ruby .hljs-string,.tex .hljs-formula,.vhdl .hljs-attribute{color:#88f}.apache .hljs-tag,.asciidoc .hljs-strong,.bash .hljs-variable,.css .hljs-tag,.hljs-built_in,.hljs-dartdoc,.hljs-id,.hljs-javadoctag,.hljs-keyword,.hljs-phpdoc,.hljs-request,.hljs-status,.hljs-title,.hljs-type,.hljs-typename,.hljs-winutils,.hljs-yardoctag,.markdown .hljs-strong,.smalltalk .hljs-class,.tex .hljs-command{font-weight:700}.asciidoc .hljs-emphasis,.markdown .hljs-emphasis{font-style:italic}.nginx .hljs-built_in{font-weight:400}.coffeescript .javascript,.javascript .xml,.lasso .markup,.tex .hljs-formula,.xml .css,.xml .hljs-cdata,.xml .javascript,.xml .vbscript{opacity:.5}.MathJax_Hover_Frame{border-radius:.25em;-webkit-border-radius:.25em;-moz-border-radius:.25em;-khtml-border-radius:.25em;box-shadow:0 0 15px #83A;-webkit-box-shadow:0 0 15px #83A;-moz-box-shadow:0 0 15px #83A;-khtml-box-shadow:0 0 15px #83A;border:1px solid #A6D!important;display:inline-block;position:absolute}.MathJax_Hover_Arrow{position:absolute;width:15px;height:11px;cursor:pointer}#MathJax_About{position:fixed;left:50%;width:auto;text-align:center;border:3px outset;padding:1em 2em;background-color:#DDD;color:#000;cursor:default;font-family:message-box;font-size:120%;font-style:normal;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;-khtml-border-radius:15px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_Menu{position:absolute;background-color:#fff;color:#000;width:auto;padding:5px 0;border:1px solid #CCC;margin:0;cursor:default;font:menu;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;-khtml-border-radius:5px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_MenuItem{padding:1px 2em;background:0 0}.MathJax_MenuArrow{position:absolute;right:.5em;color:#666}.MathJax_MenuActive .MathJax_MenuArrow{color:#fff}.MathJax_MenuArrow.RTL{left:.5em;right:auto}.MathJax_MenuCheck{position:absolute;left:.7em}.MathJax_MenuCheck.RTL{right:.7em;left:auto}.MathJax_MenuRadioCheck{position:absolute;left:.7em}.MathJax_MenuRadioCheck.RTL{right:.7em;left:auto}.MathJax_MenuLabel{padding:1px 2em 3px 1.33em;font-style:italic}.MathJax_MenuRule{border-top:1px solid #DDD;margin:4px 3px}.MathJax_MenuDisabled{color:GrayText}.MathJax_MenuActive{background-color:#606872;color:#fff}.MathJax_Menu_Close{position:absolute;width:31px;height:31px;top:-15px;left:-15px}#MathJax_Zoom{position:absolute;background-color:#F0F0F0;overflow:auto;display:block;z-index:301;padding:.5em;border:1px solid #000;margin:0;font-weight:400;font-style:normal;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;box-shadow:5px 5px 15px #AAA;-webkit-box-shadow:5px 5px 15px #AAA;-moz-box-shadow:5px 5px 15px #AAA;-khtml-box-shadow:5px 5px 15px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_ZoomOverlay{position:absolute;left:0;top:0;z-index:300;display:inline-block;width:100%;height:100%;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_ZoomFrame{position:relative;display:inline-block;height:0;width:0}#MathJax_ZoomEventTrap{position:absolute;left:0;top:0;z-index:302;display:inline-block;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}.MathJax_Preview{color:#888}#MathJax_Message{position:fixed;left:1px;bottom:2px;background-color:#E6E6E6;border:1px solid #959595;margin:0;padding:2px 8px;z-index:102;color:#000;font-size:80%;width:auto;white-space:nowrap}#MathJax_MSIE_Frame{position:absolute;top:0;left:0;width:0;z-index:101;border:0;margin:0;padding:0}.MathJax_Error{color:#C00;font-style:italic}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown github">
<h1 id="interviewing-data:-making-charts-and-maps"><a name="interviewing-data:-making-charts-and-maps" href="#interviewing-data:-making-charts-and-maps"></a>Interviewing data: Making charts and maps</h1><p>In this week’s class we will make a series of charts and maps, to answer specific questions about two datasets, to help shape future reporting. While the main goal here is exploratory data analysis — i.e. interviewing our data — we will also learn how to embed the graphics we make into an online story package.</p><h3 id="the-data-we-will-use-today"><a name="the-data-we-will-use-today" href="#the-data-we-will-use-today"></a>The data we will use today</h3><p>Download the data for this session from <a href="data/week4.zip">here</a>, unzip the folder and place it on your desktop. It contains the following files:</p><ul>
<li><p><code>richmond_collisions.xls</code> Data on injury and fatal traffic accidents in Richmond, California, from 2005 to 2013, from the <a href="http://tims.berkeley.edu/page.php?page=about">Transportation Injury Mapping System</a>. The data comes from the California Highway Patrol’s <a href="http://iswitrs.chp.ca.gov/Reports/jsp/userLogin.jsp">Statewide Integrated Traffic Records System</a> and was then geocoded for mapping by UC Berkeley’s Safe Transportation Research &amp; Education Center. This is the data we cleaned in Open Refine in Week 2.</p>
</li><li><p><code>urban_displacement.xlsx</code> Data on gentrification in the Bay Area, from the <a href="http://www.urbandisplacement.org/">Urban Displacement Project</a>, an initiative of UC Berkeley, in collaboration with researchers at UCLA. The project has compiled socioeconomic data for each <a href="https://www.census.gov/geo/reference/gtc/gtc_ct.html">census tract</a> in the Bay Area, and used this to rate the degree of exclusion or displacement experienced by low-income households in each. See <a href="http://www.urbandisplacement.org/sites/default/files/images/urban_displacement_project_-_executive_summary.pdf">here</a> for an executive summery of the project’s findings. The variables measured are documented in the first sheet of this spreadsheet, the full data is in the second.</p>
</li></ul><h3 id="introducing-tableau-public-and-google-fusion-tables"><a name="introducing-tableau-public-and-google-fusion-tables" href="#introducing-tableau-public-and-google-fusion-tables"></a>Introducing Tableau Public and Google Fusion Tables</h3><p>In this week’s class we will work with <a href="http://www.tableausoftware.com/public/"><strong>Tableau Public</strong></a>, which allows you to create a wide variety of interactive charts, maps and tables and organize them into <strong>dashboards</strong> that can be saved to the cloud and embedded on the web.</p><p>Tableau was developed for exploratory graphical data analysis, so it is a good tool for exploring a new dataset — <strong>filtering</strong>, <strong>sorting</strong> and <strong>aggregating</strong> the data in different ways while experimenting with various chart types.</p><p>Although Tableau was not designed as a publication tool, the ability to embed finished dashboards and stories has also allowed newsrooms that lack JavaScript coding expertise to create interactive online graphics.</p><p>We will also use <strong><a href="https://support.google.com/fusiontables/answer/2571232?hl=en">Fusion Tables</a></strong>, described by Google as “an experimental data visualization web application to gather, visualize, and share data tables.” It can function as a simple online database, allowing you to <strong>filter</strong> data tables, and to <strong>join</strong> tables together by common fields. Most usefully, it provides a simple way to make customized interactive online maps.</p><h3 id="visualize-data-on-fatal-and-injury-traffic-accidents-in-richmond"><a name="visualize-data-on-fatal-and-injury-traffic-accidents-in-richmond" href="#visualize-data-on-fatal-and-injury-traffic-accidents-in-richmond"></a>Visualize data on fatal and injury traffic accidents in Richmond</h3><p>Open Tableau Public, and you should see a screen like this:</p><p><img src="img/class4_1.jpg" alt=""></p><h4 id="questions-to-ask-of-this-data"><a name="questions-to-ask-of-this-data" href="#questions-to-ask-of-this-data"></a>Questions to ask of this data</h4><p>Here are the questions that we will seek to answer with this graphical analysis:</p><ul>
<li><p>Where did each collision that caused death or injury occur, and how many people were killed and injured in each one?</p>
</li><li><p>For each collision, was alcohol involved?</p>
</li><li><p>How many deaths and injuries occured in each year, and for how many of these was alcohol involved?</p>
</li></ul><h4 id="connect-to-the-data"><a name="connect-to-the-data" href="#connect-to-the-data"></a>Connect to the data</h4><p>The Richmond traffic accident data is in an Excel file. So from the left panel select <code>Connect&gt;Excel</code>. Navigate to the file <code>richmond_collisions.xls</code> and <code>Open</code>. At this point, you can view the data, which will be labeled as follows:</p><ul>
<li><strong>Text:</strong> <code>Abc</code></li><li><strong>Numbers:</strong> <code>#</code></li><li><strong>Dates:</strong> calendar symbol</li><li><strong>Geography:</strong> globe symbol</li></ul><p><img src="img/class4_2.jpg" alt=""></p><p>Tableau doesn’t always recognize entries correctly, but if necessary you can edit fields to give them the correct data type:</p><p><img src="img/class4_3.jpg" alt=""></p><p>After our cleaning in Open Refine, however, the data we are going to use should be formatted correctly.</p><p>Once the data has loaded, click <code>Sheet 1</code> at bottom left and you should see a screen like this:</p><p><img src="img/class4_4.jpg" alt=""></p><h4 id="dimensions-and-measures"><a name="dimensions-and-measures" href="#dimensions-and-measures"></a>Dimensions and measures</h4><p>Notice that Tableau has divided the variables into <code>Dimensions</code> and <code>Measures</code>. If the variables are all classified correctly, these broadly correspond to categorical and continuous variables. <code>Dimensions</code> are variables containing text or dates, while <code>Measures</code> contain numbers.</p><h4 id="shelves-and-show-me"><a name="shelves-and-show-me" href="#shelves-and-show-me"></a>Shelves and Show Me</h4><p>You make charts and maps in Tableau by dragging variables from the <code>Data</code> panel at left onto the “shelves” in the main charts area. These are marked <code>Columns</code>, <code>Rows</code>, <code>Pages</code>, <code>Filters</code>, and so on.</p><p>The <code>Show Me</code> panel at top right shows the charts that you can make, from the data currently beinf used, and also tells you the combinations of <code>Dimensions</code> and <code>Measures</code> needed for each chart type. You can hide or show this panel at any time by clicking on its header bar.</p><h4 id="columns-and-rows:-x-and-y-axes"><a name="columns-and-rows:-x-and-y-axes" href="#columns-and-rows:-x-and-y-axes"></a>Columns and rows: X and Y axes</h4><p>The starting point for creating any chart or map in Tableau is to place fields into the <code>Columns</code> and <code>Rows</code> shelves, which for most charts correspond to the X (horizontal) and Y (vertical) axes, respectively. When making maps, longitude is the X axis and latitude the Y. If you display the data as a table, then these labels are self-explanatory.</p><h4 id="calculate-the-number-of-people-killed-and-injured-in-each-collision"><a name="calculate-the-number-of-people-killed-and-injured-in-each-collision" href="#calculate-the-number-of-people-killed-and-injured-in-each-collision"></a>Calculate the number of people killed and injured in each collision</h4><p>Again, as for our spreadsheet exercise with this data, we need to make a new variable giving the number of people killed and injured in each collision.</p><p>Select <code>Analysis&gt;Create calculated field...</code> from the top menu and fill in the dialog box as follows:</p><p><img src="img/class4_5.jpg" alt=""></p><p>When you start to type in the name of a variable into the dialog box, you should get the opportunity to select it. Do so, and the variable will appear in square brackets in the formula.</p><p>When calculating new variables, you can use <strong>functions</strong>, as in Google Sheets. You can review all of the avilable functions in Tableau by clicking the little right-facing triangle at the right of the dialog box:</p><p><img src="img/class4_6.jpg" alt=""></p><p>Notice that the new calculated variable appears in the <code>Data</code> panel, prefixed by an <code>=</code> symbol</p><h4 id="map-the-location-of-each-collision"><a name="map-the-location-of-each-collision" href="#map-the-location-of-each-collision"></a>Map the location of each collision</h4><p>We will now place all the collisions as points on a map. Drag <code>Longitude</code> to <code>Columns</code> and <code>Latitude</code> to <code>Rows</code>.</p><p>The screen should now look like this:</p><p><img src="img/class4_7.jpg" alt=""></p><p>Why is there a single point, somewhere in Arizona? Look at <code>Columns</code> and <code>Rows</code>, and notice that, by default, Tableau has <strong>aggregated</strong> all the longitudes and latitudes, calculating an average (<code>AVG</code>). This <strong>aggregation</strong> is central to how Tableau works, and can be confusing at first.</p><p>You can change the <strong>aggregate</strong> measure used for any chart by clicking on the little downward-pointing triangle that appears when you hover over the variable:</p><p><img src="img/class4_8.jpg" alt=""></p><p>If you don’t want to draw a chart or map that is based on an <strong>aggregation</strong> of <em>all</em> of the data, you need to tell Tableau the level of <code>Detail</code> for your analysis. Here, we want to draw a single point for each collision. To do that, drag <code>Caseid</code>, which is the unique identifying code for each collision, into the <code>Detail</code> shelf. Tableau will still try to calculate average locations, but because we have told it to draw a separate point for each <code>Caseid</code> in the data, that will be an average of a single <code>Latitude</code> and single <code>Longitude</code> value for each record in the data.</p><p>The map should now look like this:</p><p><img src="img/class4_9.jpg" alt=""></p><p>There should now be two clusters of points, one lying just off the coast of West Africa. Hover over these points, and notice that these have latitudes and longitudes of zero. These are collisions that were not geocoded in the data; but rather than being given a null value, they have a zero.</p><p>We will ignore them, and zoom in on Richmond. Hover over the top left of the map, and select the area zoom control:</p><p><img src="img/class4_10.jpg" alt=""></p><p>Use the controls until the map is zoomed in on central Richmond:</p><p><img src="img/class4_11.jpg" alt=""></p><p>Tableau’s default basemap is very stripped down, but we can add more features. Select <code>Map&gt;Map Layers</code> from the top menu, and check <code>Streets and Highways</code>. Close the <code>Map Layers</code> panel by clicking the <code>x</code> symbol.</p><p>The map should now look like this:</p><p><img src="img/class4_12.jpg" alt=""></p><h4 id="color-the-collisions-to-show-whether-or-not-alcohol-was-involved"><a name="color-the-collisions-to-show-whether-or-not-alcohol-was-involved" href="#color-the-collisions-to-show-whether-or-not-alcohol-was-involved"></a>Color the collisions to show whether or not alcohol was involved</h4><p>To do this, drag <code>Alcohol involved</code> from the <code>Data</code> panel onto the <code>Color</code> shelf.</p><p>The map should now look like this, with collisions that involved alcohol shown in orange:</p><p><img src="img/class4_13.jpg" alt=""></p><p>Some of the points lie over the top of one another. Some transparency will make overlapping circles easier to see. Click on the <code>Color</code> shelf and edit the     <code>Transparency</code> to <code>50%</code>. Also select a gray <code>Border</code>:</p><p><img src="img/class4_14.jpg" alt=""></p><p>To display the orange circles over the top of the blue circles we need to <strong>sort</strong> the legend. Click on the downward-pointing triangle that appears when you hover over the <code>Alcohol involved</code> legend, and select <code>Sort...</code>. Then fill the dialog box in as follows, moving <code>Y</code> above <code>N</code>:</p><p><img src="img/class4_15.jpg" alt=""></p><h4 id="scale-the-collisions-by-the-number-of-people-killed-and-injured-in-each"><a name="scale-the-collisions-by-the-number-of-people-killed-and-injured-in-each" href="#scale-the-collisions-by-the-number-of-people-killed-and-injured-in-each"></a>Scale the collisions by the number of people killed and injured in each</h4><p>Drag <code>Killed and injured</code> from the <code>Data</code> panel onto the <code>Size</code> shelf. The map should now look like this, with collisions in which more people were killed and injured represented by larger circles:</p><p><img src="img/class4_16.jpg" alt=""></p><h4 id="edit-the-tooltips"><a name="edit-the-tooltips" href="#edit-the-tooltips"></a>Edit the tooltips</h4><p>Hover over one of the points on the map, and see that the tooltip displays values for each of the variables we have added to the map so far. The most useful <em>additional</em> information to provide in a tooltip, not evident at first glance, is the date of each collision, and a breakdown of the numbers killed and injured, so drag <code>Date</code>, <code>Injured</code> and <code>Killed</code> to the <code>Tooltip</code> shelf. Click on <code>Tooltip</code> and edit at the dialog box to remove the other variables. Also uncheck <code>Include command buttons</code>. This turns off some additional Tableau tooltip functionality, giving a plain tooltip:</p><p><img src="img/class4_17.jpg" alt=""></p><h4 id="set-up-a-filter-to-map-the-collisions-by-year"><a name="set-up-a-filter-to-map-the-collisions-by-year" href="#set-up-a-filter-to-map-the-collisions-by-year"></a>Set up a filter to map the collisions by year</h4><p>Now we a control to <strong>filter</strong> the data by year. Tableau’s default behavior is to redraw the <code>Marks</code> on a map or chart each time it is filtered. In this case, the circles will all rescale to reflect the range of values in the <strong>filtered</strong> data.</p><p>If we do not want that to happen, we need to freeze the size of the circles.</p><p>To freeze the size of the circles, hover over the title bar for the size legend, select <code>Edit sizes...</code> and fill in the dialog box as follows:</p><p><img src="img/class4_19.jpg" alt=""></p><p>Now we can set up a <strong>filter</strong> by year. <code>Year</code> is among the variables in the dataset, but we will instead drag <code>Date</code> onto the <code>Filters</code> shelf to demonstrate Tableau’s flexibility in working with dates and times. At this dialog box, select <code>Years</code> and click <code>Next &gt;</code>:</p><p><img src="img/class4_20.jpg" alt=""></p><p>At the next dialog box, select <code>All</code> and click <code>OK</code>:</p><p><img src="img/class4_21.jpg" alt=""></p><p>The map will not change until we set up a control for the filter. Hover over <code>YEAR(Date)</code> in the <code>Filters</code> shelf, call up its dropdown menu, and select <code>Show filter</code>. A filter control with checkboxes will appear at the right:</p><p><img src="img/class4_22.jpg" alt=""></p><p>To change the filter control type, call up the dropdown menu for the filter and select <code>Single value (slider)</code>:</p><p><img src="img/class4_23.jpg" alt=""></p><p>Now we have a slider control allowing all of the data to be shown at once, or one year’s data at a time:</p><p><img src="img/class4_24.jpg" alt=""></p><h4 id="save-to-the-cloud"><a name="save-to-the-cloud" href="#save-to-the-cloud"></a>Save to the cloud</h4><p>Right-click on <code>Sheet 1</code>, select <code>Rename Sheet</code>, and call it <code>Map</code>.</p><p>Having finished the map, now is a good time to save our work. From the top menu, select <code>File&gt;Save To Tableau</code>. At the log-on dialog box enter your Tableau Public account details, give the Wookbook a suitable name and click <code>Save</code>.</p><p>When the save is complete, a webpage hosting your map will open in your default browser.</p><h4 id="make-a-column-chart-showing-the-number-of-people-killed-and-injured-by-year"><a name="make-a-column-chart-showing-the-number-of-people-killed-and-injured-by-year" href="#make-a-column-chart-showing-the-number-of-people-killed-and-injured-by-year"></a>Make a column chart showing the number of people killed and injured by year</h4><p>From the top menu, select <code>Worksheet&gt;New Worksheet</code>. Drag <code>Date</code> onto <code>Columns</code>. As a default, Tableau should select <code>YEAR(date)</code>, which is what we require here. You can call up the dropdown menu for the variable to see the other available options:</p><p><img src="img/class4_25.jpg" alt=""></p><p>Now drag <code>Killed and injured</code> onto <code>Rows</code>. Notice that the default <strong>aggregation</strong> here is <code>SUM</code>: Tableau is adding up the numbers of people killed and injured in each year, which is what we want. So this time, we do not need to drag anything onto the <code>Detail</code> shelf to change the level of analysis. (Again, if required, we could change the aggregate measure if necessary.)</p><p>By default, Tableau has drawn a line chart. So open <code>Show Me</code> and select the <code>Horizontal Bars</code> option. Now click the <code>Swap</code> axes icon:</p><p><img src="img/class4_26.jpg" alt=""></p><p>This should flip the chart from horizontal bars to vertical columns:</p><p><img src="img/class4_27.jpg" alt=""></p><h4 id="color-the-chart-by-whether-or-not-alcohol-was-involved"><a name="color-the-chart-by-whether-or-not-alcohol-was-involved" href="#color-the-chart-by-whether-or-not-alcohol-was-involved"></a>Color the chart by whether or not alcohol was involved</h4><p>Drag <code>Alcohol involved</code> onto the <code>Color</code> shelf, and then edit the transparency to 50% and add a gray border as before. Right-click on the word <code>Date</code> at the top of the chart and select <code>Hide field names for columns</code> to remove it.</p><p>Rename the worksheet as <code>Column chart - years</code>, and the screen should look like this:</p><p><img src="img/class4_28.jpg" alt=""></p><p>It shows the data from our Week 3 pivot table in graphical form. Now is a good time to save to the cloud once more.</p><h4 id="next-steps"><a name="next-steps" href="#next-steps"></a>Next steps</h4><p>This map and chart provide a springboard for more reporting and analysis.</p><ul>
<li><p>You could browse the map to look for accident hotspots, especially those that involve alcohol, and use that as the starting point for local reporting.</p>
</li><li><p>You could identify the accidents that caused the most deaths and injuries, and use the California Public Records Act to obtain police reports for these.</p>
</li><li><p>As for the pivot table, the chart raises some questions: Why did was the number of deaths and injuries so high in 2005, compared to all the other years? And why were there so few alcohol-related deaths and injuries in 2010?</p>
</li><li><p>Try altering the <strong>aggregation</strong> for <code>Date</code> in the column chart to look at deaths and injuries by month, or by day of the week.</p>
</li><li><p>Try asking different questions of the data. Experiment with different chart types, exploring other variables and <strong>filtering</strong> and <strong>aggregating</strong> the data in different ways, to expose other potential stories in the data.</p>
</li></ul><h4 id="combine-the-worksheets-into-a-dashboard-and-publish-on-the-web"><a name="combine-the-worksheets-into-a-dashboard-and-publish-on-the-web" href="#combine-the-worksheets-into-a-dashboard-and-publish-on-the-web"></a>Combine the worksheets into a dashboard and publish on the web</h4><p>Although our main goal was to explore this data to help direct further reporting, we can also combine the charts into a dashboard to publish on the web.</p><p>From the top menu, select <code>Dashboard&gt;New Dashboard</code>. We can set the size of the dashboard to fit the web page on which we want to embed it, and this can be a <code>Range</code>, giving some basic responsive design. To see how this works, change the <code>Max</code> width (w) to <code>750</code> pixels.</p><p>Drag <code>Map</code> into the dashboard. The default title isn’t very informative, so right-click on that and select <code>Hide Title</code>.</p><p>When adding sheets to the dashboard, You can make them <code>Tiled</code> or <code>Floating</code>, which allows new items to be placed over one another. Here we will stick with the <code>Tiled</code> option. Drag <code>Column chart - years</code> to the lower half of the map. Drop it when you see a gray rectangle in this position.</p><p>Notice that Tableau allows you to drop various other items into a dashboard: horizontal and vertical containers, text boxes, images (which can be good for adding logos), web pages, and blank space.</p><p>From the top menu select <code>Dashboard&gt;Show Title</code>, replace <code>&lt;Sheet Name&gt;</code> with an appropriate title/subtitle and adjust the alignment, fonts, and styles as desired. Rename the dashboard as <code>Richmond traffic accidents</code>.</p><p>Now add a <code>Text</code> box at the bottom of the dashboard, and add the source information:</p><p><img src="img/class4_29.jpg" alt=""></p><p>Finally, call up the dropdown menu for the slider control, select <code>Edit title...</code> and change <code>Year of Date</code> to <code>Year</code>.</p><p>The finished dashboard should look something like this:</p><p><img src="img/class4_30.jpg" alt=""></p><p>Save to the cloud as before. When the dashboard opens in your browser, click <code>Share</code> to get an <code>Embed Code</code>:</p><p><img src="img/class4_31.jpg" alt=""></p><p>Copy this code and paste into into the html of any web page in which you want the dashboard to appear.</p><p>Even when publishing single charts, drop them into a dashboard and get the embed code for that, rather than publishing individual worksheets, otherwise they may not display properly online.</p><h3 id="make-a-map-showing-gentrification,-urban-displacement,-and-exclusion-in-the-bay-area"><a name="make-a-map-showing-gentrification,-urban-displacement,-and-exclusion-in-the-bay-area" href="#make-a-map-showing-gentrification,-urban-displacement,-and-exclusion-in-the-bay-area"></a>Make a map showing gentrification, urban displacement, and exclusion in the Bay Area</h3><p>We are going to make a version of <a href="http://www.urbandisplacement.org/map/sf">this map</a>, showing low-income census tracts at various stages of gentrification, and moderate- to high-income census tracts with various degrees of exclusion for low-income households.</p><p>Tableau can readily make filled maps like this for the geographic boundaries it recognizes, which include countries, states, counties, and zip codes. Tableau doesn’t recognize census tracts, but with Google Fusion Tables you can easily make maps using any geographic boundaries.</p><h4 id="connect-google-drive-to-the-fusion-tables-app"><a name="connect-google-drive-to-the-fusion-tables-app" href="#connect-google-drive-to-the-fusion-tables-app"></a>Connect Google Drive to the Fusion Tables app</h4><p>If you have not used Fusion Tables before, you will need to connect the app to your Google Drive. Login to your Google account, then navigate to <a href="https://drive.google.com/">Google Drive</a>. Click on the red <code>NEW</code> button at top left, and review your options:</p><p><img src="img/class4_32.jpg" alt=""></p><p>If you do not see the option to create a new Fusion Table, select <code>+ Connect more apps</code> and select Google Fusion Tables:</p><p><img src="img/class4_33.jpg" alt=""></p><p>At the next dialog box, click the blue <code>+ Connect</code> button at top right. Click <code>OK</code> to finish and close the open window.</p><h4 id="questions-to-ask-of-this-data"><a name="questions-to-ask-of-this-data" href="#questions-to-ask-of-this-data"></a>Questions to ask of this data</h4><p>Our map will ask these questions:</p><ul>
<li><p>Which low-income census tracts in the Bay Area are experiencing the highest levels of gentrification, and displacement of low-income households, and which are at risk?</p>
</li><li><p>Which moderate- to high- income census tracts in the Bay Area have the highest levels of exclusion for low-income households?</p>
</li></ul><h4 id="prepare-the-data"><a name="prepare-the-data" href="#prepare-the-data"></a>Prepare the data</h4><p>Upload the file <code>urban_displacement.xlsx</code> to Google Sheets. The first sheet contains documentation describing the variables in the data.</p><p>The second contains the data:</p><p><img src="img/class4_34.jpg" alt=""></p><p>Each row in the data represents a separate census tract, which has a unique <code>tract_id</code>.</p><p>To make a map from this data, we need a Fusion Table that contains geographic data defining the boundaries</p><p>Geographic data comes in various formats, two of the most common being <a href="http://en.wikipedia.org/wiki/Shapefile">Shapefiles</a> and <a href="https://developers.google.com/kml/">KML</a>. KML is the data format used by Google Maps and Google Earth, and can be uploaded directly to Fusion Tables.</p><p>Shapefiles are a format used in Geographic Information Systems (GIS) software. They are usually made available for download as zipped folders, and actually consist of a series of files. At a minimum, a shapefile must contain three component files, with the same root name and the following extensions:</p><ul>
<li><code>.shp</code> The main file containing the geometry of the points, lines or polygons mapped in the shapefile.</li><li><code>.dbf</code> A database file in <a href="http://www.dbase.com/">dBASE</a> format containing a table of data relating to the components of the geometry. For example, in a world shapefile giving national boundaries, this table might contain data about the countries including their names, capital cities, population, and so on.</li><li><code>.shx</code> A positional index of the shapefile’s geometry.</li></ul><p>If the boundary data you need is available only in shapefile format, you can upload to Fusion Tables using the <a href="http://www.shpescape.com/ft/">Shape Escape</a> website. For this to work, your shapefile must include a <code>.prj</code> file, defining the <a href="https://en.wikipedia.org/wiki/Map_projection">map projection</a> of the file. Zip the folder and follow the directions at Shape Escape. Unless you want to create a point in the center of each area, or simplify the shape of the boundaries, leave the <code>Advanced Options</code> unchecked.</p><p><img src="img/class4_35.jpg" alt=""></p><p>Uploading a shapefile to Fusion Tables using Shape Escape, which will convert it to KML,  will take some time. This is not something you want to do on a tight deadline!</p><p>In this case, I have already uploaded a shapefile of census tracts in California, obtained from the <a href="http://www.census.gov/geo/maps-data/data/tiger-line.html">U.S. Census Bureau</a>. It is <a href="https://fusiontables.google.com/DataSource?docid=16rmvHbxu0HR6eYX4XtVZFwQOKoJkj_onJ1f3sNb1#rows:id=1">here</a>, and the data looks like this:</p><p><img src="img/class4_36.jpg" alt=""></p><p>The is a variable called <code>GEOID</code>, which contains the same codes as in the <code>tract_id</code> vairable in the urban displacement data, with one important difference: Here they are all proceded by a <code>0</code>.</p><p>We need to <strong>join</strong> the urban displacement data to the census tracts map, but to do that, we need to make the entries for the two variables match properly.</p><p>So return to the urban displacement spreadsheet, select the <code>tract_id</code> column by clicking on the letter <code>A</code>, right-click and select <code>Insert 1 left</code>. Call the new column <code>geoid</code> and then type the following formula into the first cell:</p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>=CONCATENATE(&quot;0&quot;,B2)
</code></pre>">=CONCATENATE("0",B2)
</code></pre><p>The <code>CONCATENATE</code> spreadsheet function appends text entries, separated by commas, to one another. Although it should work without the quote marks, it is good practice to use them for any entries that are not other spreadsheet cells, as this defines the entry as text.</p><p><img src="img/class4_37.jpg" alt=""></p><p>Now fill the formula down the entire column by hovering over the bottom-right corner of the first cell and double-clicking when the <code>+</code> symbol appears.</p><p>Having done this, return to your Google Drive home page and select <code>NEW&gt;More&gt;Google Fusion Tables</code>. The next dialog box allows you to upload a file from your computer, or a import a Google spreadsheet, which is what we want to do:</p><p><img src="img/class4_38.jpg" alt=""></p><p>At the next dialog box, double-click on the urban displacement spreadsheet to select it:</p><p><img src="img/class4_39.jpg" alt=""></p><p>The data may take a little time to load. When it does, select the <code>urban_displacement.xlsx-data</code> tab, to import the data sheet, rather than the documentation. Don’t worry if the data doesn’t display correctly in this preview:</p><p><img src="img/class4_40.jpg" alt=""></p><p>Click <code>Next &gt;&gt;</code>, and repeat at the next screen, then give the table an appropriate name and attribution:</p><p><img src="img/class4_41.jpg" alt=""></p><p>Click <code>Finish</code> and the new Fusion Table should load:</p><p><img src="img/class4_42.jpg" alt=""></p><p>Fusion Tables will highlight in yellow any geographic entities it recognizes, and can add them as points to a map. However, we do not want to use that option in this case.</p><h4 id="join-the-urban-displacement-data-to-the-census-tracts-map"><a name="join-the-urban-displacement-data-to-the-census-tracts-map" href="#join-the-urban-displacement-data-to-the-census-tracts-map"></a>Join the urban displacement data to the census tracts map</h4><p>So far we have repeatedly <strong>sorted</strong>, <strong>filtered</strong>, and <strong>aggregated</strong> data. Now we are going to perform a <strong>join</strong> — the last of the four common operations we discussed in Week 1.</p><p>Fusion Tables calls this a “merge.” Select <code>File&gt;Merge...</code> from the menu in the urban displacement Fusion Table. At the dialog box, paste the <a href="https://fusiontables.google.com/DataSource?docid=16rmvHbxu0HR6eYX4XtVZFwQOKoJkj_onJ1f3sNb1#rows:id=1"><strong>url</strong></a> for my California census tracts Fusion Table into the web address box at the bottom, and click <code>Next</code>:</p><p><img src="img/class4_43.jpg" alt=""></p><p>Fusion Tables should recognize that there are matching variable names in the two tables. If it does not, you can use the dropdown menus to select the correct variables. Then click <code>Next</code>:</p><p><img src="img/class4_44.jpg" alt=""></p><p>The next dialog box allows you to choose which variables to include in the new table. Those from the table you are joining to are shown with a subtle yellow background. You <em>must</em> include <code>geometry</code> if you want to be able to make a map.</p><p><img src="img/class4_45.jpg" alt=""></p><p>We will retain all the variables, so just click <code>Merge</code>, and then <code>View table</code>. You can edit its title by clicking on it:</p><p><img src="img/class4_46.jpg" alt=""></p><h4 id="style-the-map-to-show-the-degree-of-gentrification-or-exclusion-in-each-census-tract"><a name="style-the-map-to-show-the-degree-of-gentrification-or-exclusion-in-each-census-tract" href="#style-the-map-to-show-the-degree-of-gentrification-or-exclusion-in-each-census-tract"></a>Style the map to show the degree of gentrification or exclusion in each census tract</h4><p>We want to make a map highlighting the degree of exclusion or displacement/gentrification. There are text descriptions of these categories in the variable <code>disp_descr</code>, and numerical codes for the categories in the variable <code>disp_type</code>. This is how they correspond:</p><table>
<thead>
<tr>
<th>disp_type</th>
<th>disp_descr</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>LI - Not losing LI households or very early stages of displacement</td>
</tr>
<tr>
<td>2</td>
<td>LI - At risk of gentrification or displacement</td>
</tr>
<tr>
<td>3</td>
<td>LI - Undergoing displacement</td>
</tr>
<tr>
<td>4</td>
<td>LI - Advanced gentrification</td>
</tr>
<tr>
<td>5</td>
<td>MHI - Not losing LI households or very early stages of displacement</td>
</tr>
<tr>
<td>6</td>
<td>MHI - At risk of displacement</td>
</tr>
<tr>
<td>7</td>
<td>MHI - Undergoing displacement</td>
</tr>
<tr>
<td>8</td>
<td>MHI - Advanced exclusion</td>
</tr>
</tbody>
</table><p>To make a filled map in Fusion Tables, we need to use a numeric column, so we will use <code>disp_type</code>.</p><p>Click on the <code>Map of geometry</code> tab and zoom into the Bay Area. You should see a map like this:</p><p><img src="img/class4_47.jpg" alt=""></p><p>To color the map, click <code>Change feature styles...</code>, and at the dialog box select <code>Fill color</code> on the left and the <code>Buckets</code> tab. Divide into <code>8</code> buckets, and select the column <code>disp_type</code>:</p><p><img src="img/class4_48.jpg" alt=""></p><p>Now we need to set the number range and color for each bucket. Choose ranges that will encompass the numbers in the <code>disp_type</code> codes (for example <code>0.5</code> to <code>1.5</code>, <code>1.5</code> to <code>2.5</code>, and so on). Pick pick two distinct color themes for the <code>LI</code> and <code>MHI</code> tracts, and use increasing intensity of those colors to represent the increasing degrees of gentrification or exclusion. Also adjust the opacity of each fill to <code>75%</code>:</p><p><img src="img/class4_49.jpg" alt=""></p><p>Click <code>Save</code> and the map should now look like this:</p><p><img src="img/class4_50.jpg" alt=""></p><h4 id="customize-the-pop-ups"><a name="customize-the-pop-ups" href="#customize-the-pop-ups"></a>Customize the pop-ups</h4><p>Click on one of the census tracts and notice that a information window pops up, showing the data for variables in the table.</p><p><img src="img/class4_51.jpg" alt=""></p><p>Click <code>Change info window ...</code> and select the variables you would like to show:</p><p><img src="img/class4_52.jpg" alt=""></p><p>Now select the <code>Custom</code> tab and edit the labels in the HTML code that appears:</p><p><img src="img/class4_53.jpg" alt=""></p><p>Click <code>Save</code>, and then click on one of the tracts again to view the result:</p><p><img src="img/class4_54.jpg" alt=""></p><h4 id="next-steps"><a name="next-steps" href="#next-steps"></a>Next steps</h4><p>Again, this map provides a starting for more reporting and analysis.</p><ul>
<li>You can now clearly identify low-income census tracts with different levels of gentrification, and moderate- to high-income tracts with different levels of exclusion, to direct local reporting into these issues.</li><li>There are many other variables in the data that you can map, if you are interested in particular aspects of gentrification and exclusion.</li></ul><p>To make a new map, click the <code>+</code> symbol at the right of the tabs at the top and <code>Add map</code>:</p><p><img src="img/class4_55.jpg" alt=""></p><h4 id="embed-this-map-on-any-web-page"><a name="embed-this-map-on-any-web-page" href="#embed-this-map-on-any-web-page"></a>Embed this map on any web page</h4><p>Before you can embed the map on a website, you need to make it visible to the wider world by clicking the <code>Share</code> button at top right. At the dialog box click on the <code>Change...</code> link, select <code>Public on the web</code> and click <code>Save</code> and then <code>Done</code>.</p><p>To embed this map on a web page, select <code>Tools&gt;Publish</code> from the top menu. Here you can select the <code>Width</code> and <code>Height</code> in pixels for your map. You can then extract the iframe code that appears under <code>Paste HTML to embed in a website</code> to embed on any web page.</p><p><img src="img/Class4_56.jpg" alt=""></p><p>If you change the width in the iframe code to <code>100%</code>, rather than giving a value in pixels, it will automatically adjust to the width of the page in which it is placed.</p><p>To put the map onto its own page, paste the code that appears in the box under <code>Get HTML and JavaScript</code> into a blank file in a text editor. Save this file with the extension <code>html</code>.</p><h3 id="assignment"><a name="assignment" href="#assignment"></a>Assignment</h3><ul>
<li>Complete both the Tableau Public and Google Fusion exercises.</li><li><p>Email me the following:</p>
<ul>
<li><p>Having saved your Tableau dashboard of Richmond traffic accidents to the web, click <code>Share</code> and send me the link at <code>Link</code>.</p>
<p><img src="img/class4_57.jpg" alt=""></p>
</li><li><p>For the Fusion Tables map of Bay Area gentrification, select <code>Tools&gt;Publish</code> and send me the link at <code>Send a link in email or IM</code>.<br><img src="img/class4_58.jpg" alt=""></p>
</li></ul>
</li></ul><h3 id="further-reading/viewing"><a name="further-reading/viewing" href="#further-reading/viewing"></a>Further reading/viewing</h3><p><a href="http://www.tableausoftware.com/public/training">Tableau Public training videos</a></p><p><a href="http://www.tableausoftware.com/public/gallery/all">Gallery of Tableau Public visualizations</a>: You can download any of these examples using the links at bottom right and open the files (which will have the extension <code>.twbx</code>) with Tableau Public to see how they were put together.</p><p><a href="http://kb.tableau.com/">Tableau Knowledge Base</a>: Useful resource with the answers to many queries about how to use the software.</p><p><a href="https://support.google.com/fusiontables/answer/2571232?hl=en">Google Fusion Tables documentation</a></p>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>
