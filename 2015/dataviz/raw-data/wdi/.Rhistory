# extract the numbers of primates held for breeding etc, and used in experiments of various types, by year and facility
held_facils <- filter(primates, col_b > 0) %>%
select(fiscal_year, name, city, state, col_b) %>%
arrange(desc(fiscal_year), desc(col_b))
used_facils <- filter(primates, col_f > 0) %>%
select(fiscal_year, name, city, state, col_f) %>%
arrange(desc(fiscal_year), desc(col_f))
distress_allev_facils <- filter(primates, col_d > 0) %>%
select(fiscal_year, name, city, state, col_d) %>%
arrange(desc(fiscal_year), desc(col_d))
distress_not_allev_facils <- filter(primates, col_e > 0) %>%
select(fiscal_year, name, city, state, col_e) %>%
arrange(desc(fiscal_year), desc(col_e))
held_totals <- group_by(primates, fiscal_year) %>%
summarise(total = sum(col_b))
used_totals <- group_by(primates, fiscal_year) %>%
summarise(total = sum(col_f))
distress_allev_totals <- group_by(primates, fiscal_year) %>%
summarise(total = sum(col_d))
distress_not_allev_totals <- group_by(primates, fiscal_year) %>%
summarise(total = sum(col_e))
pharma_not_allev_totals <- filter(distress_not_allev_facils, grepl("PFIZER|MERCK|BOEHRINGER|NOVARTIS|LILLY|GLAXO|SQUIBB", name)) %>%
group_by(fiscal_year) %>%
summarise(total = sum(col_e))
other_not_allev_totals <- filter(distress_not_allev_facils, !grepl("PFIZER|MERCK|BOEHRINGER|NOVARTIS|LILLY|GLAXO|SQUIBB", name)) %>%
group_by(fiscal_year) %>%
summarise(total = sum(col_e))
# draw plots
ggplot(distress_not_allev_totals, aes(x=fiscal_year, y=total)) + geom_bar(stat="identity") + xlab("Year") + ylab("Primates used") + xlim(c(1998,2015)) + scale_y_continuous(labels = comma) + ggtitle ("Pain or distress, not alleviated")
ggplot(distress_allev_totals, aes(x=fiscal_year, y=total)) + geom_bar(stat="identity") + xlab("Year") + ylab("Primates used") + xlim(c(1998,2015)) + scale_y_continuous(labels = comma) + ggtitle ("Pain or distress, alleviated")
ggplot(used_totals, aes(x=fiscal_year, y=total)) + geom_bar(stat="identity") + xlab("Year") + ylab("Primates used") + xlim(c(1998,2015)) + scale_y_continuous(labels = comma) + ggtitle ("Total")
ggplot(pharma_not_allev_totals, aes(x=fiscal_year, y=total)) + geom_bar(stat="identity") + xlab("Year") + ylab("Primates used") + xlim(c(1998,2015)) + scale_y_continuous(labels = comma) + ggtitle ("Pharma, pain or distress, not alleviated")
ggplot(other_not_allev_totals, aes(x=fiscal_year, y=total)) + geom_bar(stat="identity") + xlab("Year") + ylab("Primates used") + xlim(c(1998,2015)) + scale_y_continuous(labels = comma) + ggtitle ("Other labs, pain or distress, not alleviated")
# count annual reports involving primates by year
count_primate_reports <- group_by(primates, fiscal_year) %>%
summarise(count = n())
# make table showing facilities data
devtools::install_github("rstudio/DT")
library(DT)
facil_table <- select(distress_not_allev_facils, fiscal_year, name, city, state, col_e) %>%
rename(Year=fiscal_year, Name=name, City=city, State=state, "Primates Used"=col_e) %>%
group_by(Year)
datatable(facil_table)
distress_not_allev_facils <- filter(primates, col_e > 0) %>%
select(fiscal_year, name, city, cert_num, state, col_e) %>%
arrange(desc(fiscal_year), desc(col_e))
federal_not_allev_totals <- filter(distress_not_allev_facils, grepl("-F-",cert_num))
View(federal_not_allev_totals)
federal_not_allev_totals <- filter(distress_not_allev_facils, grepl("-F-",cert_num)) %>%
group_by(fiscal_year) %>%
summarise(total = sum(col_e))
View(federal_not_allev_totals)
other_not_allev_totals <- filter(distress_not_allev_facils, !grepl("PFIZER|MERCK|BOEHRINGER|NOVARTIS|LILLY|GLAXO|SQUIBB", name)) %>%
filter(!grepl("-F-",cert_num)) %>%
group_by(fiscal_year) %>%
summarise(total = sum(col_e))
View(other_not_allev_totals)
ggplot(federal_not_allev_totals, aes(x=fiscal_year, y=total)) + geom_bar(stat="identity") + xlab("Year") + ylab("Primates used") + xlim(c(1998,2015)) + scale_y_continuous(labels = comma) + ggtitle ("Federal, pain or distress, not alleviated")
other_not_allev_totals <- filter(distress_not_allev_facils, !grepl("PFIZER|MERCK|BOEHRINGER|NOVARTIS|LILLY|GLAXO|SQUIBB", name)) %>%
filter(!grepl("-F-",cert_num)) %>%
group_by(fiscal_year) %>%
summarise(total = sum(col_e))
View(other_not_allev_totals)
View(federal_not_allev_totals)
ggplot(distress_not_allev_totals, aes(x=fiscal_year, y=total)) + geom_bar(stat="identity") + xlab("Year") + ylab("Primates used") + xlim(c(1998,2015)) + scale_y_continuous(labels = comma) + ggtitle ("Pain or distress, not alleviated")
ggplot(other_not_allev_totals, aes(x=fiscal_year, y=total)) + geom_bar(stat="identity") + xlab("Year") + ylab("Primates used") + xlim(c(1998,2015)) + scale_y_continuous(labels = comma) + ggtitle ("Other labs, pain or distress, not alleviated")
View(used_totals)
save.image("~/Dropbox/buzzfeed/stories/primate research/data/acis/acis.RData")
View(pharma_not_allev_totals)
save.image("~/Dropbox/buzzfeed/stories/primate research/data/acis/acis.RData")
# load required packages
library(dplyr)
library(readr)
library(ggplot2)
library(DT)
# import data
pubschls <- read_tsv("~/Dropbox/kindergarten/pubschls.tsv")
k2001_02 <- read_tsv("~/Dropbox/kindergarten/2001-02_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2001-02", start_year=2001)
k2002_03 <- read_tsv("~/Dropbox/kindergarten/2002-03_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2002-03", start_year=2002)
k2003_04 <- read_tsv("~/Dropbox/kindergarten/2003-04_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2003-04", start_year=2003)
k2004_05 <- read_tsv("~/Dropbox/kindergarten/2004-05_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2004-05", start_year=2004)
k2005_06 <- read_tsv("~/Dropbox/kindergarten/2005-06_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2005-06", start_year=2005)
k2006_07 <- read_tsv("~/Dropbox/kindergarten/2006-07_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2006-07", start_year=2006)
k2007_08 <- read_tsv("~/Dropbox/kindergarten/2007-08_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2007-08", start_year=2007)
k2008_09 <- read_tsv("~/Dropbox/kindergarten/2008-09_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2008-09", start_year=2008)
k2009_10 <- read_tsv("~/Dropbox/kindergarten/2009-10_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2009-10", start_year=2009)
k2010_11 <- read_tsv("~/Dropbox/kindergarten/2010-11_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2010-11", start_year=2010)
k2011_12 <- read_tsv("~/Dropbox/kindergarten/2011-12_CA_kindergarten.tsv") %>%
mutate(year="2011-12", start_year=2011)
k2012_13 <- read_tsv("~/Dropbox/kindergarten/2012-13_CA_kindergarten.tsv") %>%
mutate(year="2012-13", start_year=2012)
k2013_14 <- read_tsv("~/Dropbox/kindergarten/2013-14_CA_kindergarten.tsv") %>%
mutate(year="2013-14", start_year=2013)
k2014_15 <- read_tsv("~/Dropbox/kindergarten/2014-15_CA_kindergarten.tsv") %>%
mutate(year="2014-15", start_year=2014)
kindergarten <- rbind(k2001_02,k2002_03,k2003_04,k2004_05,k2005_06,k2006_07,k2007_08,k2008_09,k2009_10,k2010_11,k2011_12,k2012_13,k2013_14,k2014_15)
write.csv(kindergarten, file="~/Dropbox/kindergarten/kindergarten.csv", row.names=FALSE, na="")
kindergarten_cleaned <- read_tsv("~/Dropbox/kindergarten/kindergarten_cleaned.tsv")
datatable(kindergarten_cleaned)
# load required packages
library(dplyr)
library(readr)
library(ggplot2)
library(DT)
# import data
pubschls <- read_tsv("~/Dropbox/kindergarten/pubschls.tsv")
k2001_02 <- read_tsv("~/Dropbox/kindergarten/2001-02_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2001-02", start_year=2001)
k2002_03 <- read_tsv("~/Dropbox/kindergarten/2002-03_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2002-03", start_year=2002)
k2003_04 <- read_tsv("~/Dropbox/kindergarten/2003-04_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2003-04", start_year=2003)
k2004_05 <- read_tsv("~/Dropbox/kindergarten/2004-05_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2004-05", start_year=2004)
k2005_06 <- read_tsv("~/Dropbox/kindergarten/2005-06_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2005-06", start_year=2005)
k2006_07 <- read_tsv("~/Dropbox/kindergarten/2006-07_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2006-07", start_year=2006)
k2007_08 <- read_tsv("~/Dropbox/kindergarten/2007-08_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2007-08", start_year=2007)
k2008_09 <- read_tsv("~/Dropbox/kindergarten/2008-09_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2008-09", start_year=2008)
k2009_10 <- read_tsv("~/Dropbox/kindergarten/2009-10_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2009-10", start_year=2009)
k2010_11 <- read_tsv("~/Dropbox/kindergarten/2010-11_CA_kindergarten.tsv") %>%
left_join(pubschls) %>%
select(-dist_code) %>%
mutate(year="2010-11", start_year=2010)
k2011_12 <- read_tsv("~/Dropbox/kindergarten/2011-12_CA_kindergarten.tsv") %>%
mutate(year="2011-12", start_year=2011)
k2012_13 <- read_tsv("~/Dropbox/kindergarten/2012-13_CA_kindergarten.tsv") %>%
mutate(year="2012-13", start_year=2012)
k2013_14 <- read_tsv("~/Dropbox/kindergarten/2013-14_CA_kindergarten.tsv") %>%
mutate(year="2013-14", start_year=2013)
k2014_15 <- read_tsv("~/Dropbox/kindergarten/2014-15_CA_kindergarten.tsv") %>%
mutate(year="2014-15", start_year=2014)
kindergarten <- rbind(k2001_02,k2002_03,k2003_04,k2004_05,k2005_06,k2006_07,k2007_08,k2008_09,k2009_10,k2010_11,k2011_12,k2012_13,k2013_14,k2014_15)
write.csv(kindergarten, file="~/Dropbox/kindergarten/kindergarten.csv", row.names=FALSE, na="")
kindergarten_cleaned <- read_tsv("~/Dropbox/kindergarten/kindergarten_cleaned.tsv")
datatable(kindergarten_cleaned)
install.packages("devtools")
install.packages(c("chron", "classInt", "cluster", "colorspace", "dplyr", "DT", "FAOSTAT", "formatR", "ggplot2", "ggvis", "highr", "htmlwidgets", "knitr", "lazyeval", "manipulate", "markdown", "MASS", "plyr", "quantmod", "readr", "rmarkdown", "scales", "shiny", "survival", "testthat", "zoo"))
require(devtools)
install_github('rCharts', 'ramnathv')
library(rCharts)
library(readr)
library(dplyr)
library(ggplot)
deadliest <- read_tsv("~/Dropbox/katrina/deadliest.tsv")
count_hurricanes <- read_csv ("~/Dropbox/katrina/count_hurricanes.csv")
count_depresssions <- read_csv ("~/Dropbox/katrina/count_depressions.csv")
surge <- read_csv("~/Dropbox/katrina/surge.csv")
wind_pressure <- read_csv("~/Dropbox/katrina/wind_pressure.csv")
View(deadliest)
View(deadliest)
library(tidyr)
count_years <- inner_join(count_hurricanes, count_depressions)
count_depressions <- read_csv ("~/Dropbox/katrina/count_depressions.csv")
count_years <- inner_join(count_hurricanes, count_depressions)
View(count_years)
count_years <- inner_join(count_hurricanes, count_depressions) %>%
mutate(other = depressions - hurricanes)
View(count_years)
View(count_hurricanes)
count_hurricanes <- read_csv ("~/Dropbox/katrina/count_hurricanes.csv")
count_years <- left_join(count_depressions, count_hurricanes) %>%
mutate(other = depressions - hurricanes)
View(count_years)
library(rCharts)
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, "Other depressions")
count_hurricanes <- read_csv ("~/Dropbox/katrina/count_hurricanes.csv")
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, "Other depressions")
View(count_years)
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes)
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes)
View(count_years)
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes)
View(count_years)
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, 3)
View(count_years)
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, 4)
View(count_years)
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, 4) %>%
gather(~Year)
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, 4) %>%
gather(Hurricanes, "Other depressions")
View(count_years)
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, 4) %>%
gather(Hurricanes, "Other depressions" -Year)
View(count_years)
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, 4) %>%
gather(Hurricanes, "Other depressions" a:b)
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, 4) %>%
gather(Hurricanes, "Other depressions", type:count)
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, 4) %>%
gather(Hurricanes, "Other depressions", 3:4)
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, 4) %>%
gather(type, count, 3:4)
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, 4) %>%
gather(type, count, 2:3)
View(count_years)
count_yearschart <- nPlot(total ~ count, group = "Year", data = count_years, type = "multiBarChart")
count_yearschart <- nPlot(total ~ Year, group = type, data = count_years, type = "multiBarChart")
count_yearschart <- nPlot(total ~ "Year", group = type, data = count_years, type = "multiBarChart")
barchart$yAxis( tickFormat="#! d3.format(',0f') !#" )
count_yearschart <- nPlot(total ~ Year, group = "type", data = count_years, type = "multiBarChart")
count_years_chart <- nPlot(total ~ as,character(Year), group = "type", data = count_years, type = "multiBarChart")
count_years_chart <- nPlot(total ~ as.character(Year), group = "type", data = count_years, type = "multiBarChart")
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes, year = as.character(year)) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, 4) %>%
gather(type, count, 2:3)
View(count_years)
count_years_chart <- nPlot(total ~ Year, group = "type", data = count_years, type = "multiBarChart")
library(rCharts)
count_years_chart <- nPlot(total ~ Year, group = "type", data = count_years, type = "multiBarChart")
str(count_years)
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes, year = as.factor(year)) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, 4) %>%
gather(type, count, 2:3)
count_years_chart <- nPlot(total ~ Year, group = "type", data = count_years, type = "multiBarChart")
barchart <- nPlot(total ~ Year, group = "type", data = count_years, type = "multiBarChart")
barchart <- nPlot(count ~ Year, group = "type", data = count_years, type = "multiBarChart")
barchart$print("chart")
barchart$save("~/Dropbox/katrina/barchart.html", cdn = TRUE)
barchart$save("~/Dropbox/katrina/barchart.html", standalone = TRUE)
library(base64enc)
count_years_chart <- nPlot(count ~ Year, group = "type", data = count_years, type = "multiBarChart")
count_years_chart$print("chart")
chart <- barchart$print("chart")
chart <- count_years_chart$print("chart")
chart <- capture.output(count_years_chart$print("chart"))
write(chart, file="~/Dropbox/katrina/interactive/chart.txt")
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, 4) %>%
gather(type, count, 2:3)
count_years_chart <- nPlot(count ~ Year, group = "type", data = count_years, type = "multiBarChart")
write(chart, file="~/Dropbox/katrina/interactive/chart.txt")
write(count_years_chart$print("chart"), file="~/Dropbox/katrina/interactive/chart.txt")
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, 4) %>%
filter(Year >= 1953)
gather(type, count, 2:3)
View(count_years)
count_years_chart <- nPlot(count ~ Year, group = "type", data = count_years, type = "multiBarChart")
chart <- capture.output(count_years_chart$print("chart"))
write(chart, file="~/Dropbox/katrina/interactive/chart.txt")
count_years_chart <- nPlot(count ~ Year, group = "type", data = count_years, type = "multiBarChart")
count_years_chart <- nPlot(count ~ Year, group = "type", data = count_years, type = "multiBarChart")
count_years <- inner_join(count_depressions, count_hurricanes) %>%
mutate("Other depressions" = depressions - hurricanes) %>%
rename(Year = year, Hurricanes = hurricanes) %>%
select(Year, Hurricanes, 4) %>%
filter(Year >= 1953) %>%
gather(type, count, 2:3)
View(count_years)
count_years_chart <- nPlot(count ~ Year, group = "type", data = count_years, type = "multiBarChart")
chart <- capture.output(count_years_chart$print("chart"))
write(chart, file="~/Dropbox/katrina/interactive/chart.txt")
View(wind_pressure)
storms <- left_join(wind_pressure, surge)
View(storms)
storms <- left_join(wind_pressure, surge) %>%
left_join(deadliest)
str(deadliest)
str(storms)
View(deadliest)
deadliest <- read_tsv("~/Dropbox/katrina/deadliest.tsv")
count_hurricanes <- read_csv ("~/Dropbox/katrina/count_hurricanes.csv")
count_depressions <- read_csv ("~/Dropbox/katrina/count_depressions.csv")
surge <- read_csv("~/Dropbox/katrina/surge.csv")
wind_pressure <- read_csv("~/Dropbox/katrina/wind_pressure.csv")
View(wind_pressure)
storms <- left_join(wind_pressure, surge) %>%
left_join(deadliest, on c(year=year, hurricane=hurricane))
storms <- left_join(wind_pressure, surge) %>%
left_join(deadliest, by c(year=year, hurricane=hurricane))
storms <- left_join(wind_pressure, surge) %>%
left_join(deadliest, by c("year"="year", "hurricane"="hurricane"))
View(storms)
storms <- left_join(wind_pressure, surge) %>%
left_join(deadliest)
View(deadliest)
wind_pressure <- read_csv("~/Dropbox/katrina/wind_pressure.csv")
View(wind_pressure)
storms <- left_join(wind_pressure, surge) %>%
left_join(deadliest)
deadliest <- read_tsv("~/Dropbox/katrina/deadliest.tsv") %>%
View(deadliest)
deadliest <- read_tsv("~/Dropbox/katrina/deadliest.tsv") %>%
)
deadliest <- read_tsv("~/Dropbox/katrina/deadliest.tsv")
storms <- left_join(wind_pressure, surge) %>%
left_join(deadliest)
View(storms)
bubble_chart <- nPlot(max_wind ~ min_pressure,data = count_years, type = "scatterChart")
bubble_chart <- nPlot(max_wind ~ min_pressure, data = storms, type = "scatterChart")
bubble_chart <- nPlot(max_wind ~ min_pressure, data = storms, type = "scatterChart")
bubble <- capture.output(bubble_chart$print("chart"))
write(bubble, file="~/Dropbox/katrina/interactive/bubble.txt")
count_years_chart <- nPlot(count ~ Year, group = "type", data = count_years, type = "multiBarChart") %>%
count_years_chart$yAxis( tickFormat="#! d3.format(',0f') !#" )
chart <- capture.output(count_years_chart$print("chart"))
write(chart, file="~/Dropbox/katrina/interactive/chart.txt")
count_years_chart <- nPlot(count ~ Year, group = "type", data = count_years, type = "multiBarChart")
count_years_chart$yAxis( tickFormat="#! d3.format(',0f') !#" )
chart <- capture.output(count_years_chart$print("chart"))
write(chart, file="~/Dropbox/katrina/interactive/chart.txt")
bubble_chart <- nPlot(max_wind ~ min_pressure, data = storms, size = deaths, type = "scatterChart")
View(storms)
bubble_chart <- nPlot(max_wind ~ min_pressure, size = deaths, data = storms, type = "scatterChart")
bubble_chart <- nPlot(max_wind ~ min_pressure, data = storms, type = "scatterChart")
bubble_chart(size=deaths)
bubble_chart <- nPlot(max_wind ~ min_pressure, data = storms, type = "scatterChart", size="deaths")
bubble <- capture.output(bubble_chart$print("chart"))
write(bubble, file="~/Dropbox/katrina/interactive/bubble.txt")
bubble_chart <- nPlot(max_wind ~ min_pressure, data = storms, type = "scatterChart")
bubble_chart$chart( xDomain = sort(range(storms$min_pressure),decreasing=T)
)
bubble <- capture.output(bubble_chart$print("chart"))
write(bubble, file="~/Dropbox/katrina/interactive/bubble.txt")
bubble_chart( xDomain = sort(range(storms$min_pressure),decreasing=T))
bubble_chart <- nPlot(max_wind ~ min_pressure, data = storms, type = "scatterChart")
bubble_chart$chart(xDomain = c(1050,850))
bubble <- capture.output(bubble_chart$print("chart"))
write(bubble, file="~/Dropbox/katrina/interactive/bubble.txt")
bubble_chart <- nPlot(max_wind ~ min_pressure, data = storms, type = "scatterChart")
bubble_chart$chart(xDomain = c(1050,850), yDomain = c(0,200))
bubble <- capture.output(bubble_chart$print("chart"))
write(bubble, file="~/Dropbox/katrina/interactive/bubble.txt")
bubble_chart <- nPlot(max_wind ~ min_pressure, data = storms, type = "scatterChart")
bubble_chart$chart(xDomain = c(1050,850), yDomain = c(0,200), size=deaths)
bubble_chart <- nPlot(max_wind ~ min_pressure, data = storms, type = "scatterChart")
bubble_chart$chart(xDomain = c(1050,850), yDomain = c(0,200), size=storms$deaths)
bubble <- capture.output(bubble_chart$print("chart"))
write(bubble, file="~/Dropbox/katrina/interactive/bubble.txt")
bubble_chart <- nPlot(max_wind ~ min_pressure, data = storms, type = "scatterChart")
bubble_chart$chart(xDomain = c(1050,850), yDomain = c(0,200), size=storms$max_wind)
bubble <- capture.output(bubble_chart$print("chart"))
write(bubble, file="~/Dropbox/katrina/interactive/bubble.txt")
bubble_chart <- nPlot(max_wind ~ min_pressure, size=deaths, data = storms, type = "scatterChart")
bubble_chart$chart(xDomain = c(1050,850), yDomain = c(0,200))
bubble_chart <- nPlot(max_wind ~ min_pressure, size=storms$deaths, data = storms, type = "scatterChart")
bubble_chart$chart(xDomain = c(1050,850), yDomain = c(0,200))
bubble <- capture.output(bubble_chart$print("chart"))
write(bubble, file="~/Dropbox/katrina/interactive/bubble.txt")
bubble_chart <- nPlot(max_wind ~ min_pressure, size=storms$deaths, data = storms, type = "scatterChart")
bubble_chart$chart(xDomain = c(1050,850), yDomain = c(0,200), size = '#! function(d){return d.deaths} !#')
bubble <- capture.output(bubble_chart$print("chart"))
write(bubble, file="~/Dropbox/katrina/interactive/bubble.txt")
save.image("~/Dropbox/katrina/storms.RData")
library(datamart)
install.packages("datamart")
library(datamart)
gm <- gapminder()
str(gm)
queries(gm)
tmp <- query(gm, "TotalFertilityRate")
View(tmp)
gapminder()
tail(tmp)
library("GrapheR", lib.loc="/Library/Frameworks/R.framework/Versions/3.2/Resources/library")
run.GrapheR()
detach("package:GrapheR", unload=TRUE)
# load required packages
library(dplyr)
library(WDI)
library(ggplot2)
library(scales)
# import World Bank data
# create list of indicators to be imported
indic_list <- c("NY.GDP.PCAP.PP.CD", "SP.DYN.LE00.IN", "SP.POP.TOTL", "SP.DYN.CBRT.IN","SH.DYN.NMRT")
# import indicators into single data frame and rename fields
indicators <- WDI(indicator=indic_list, country="all", start=1990, end=2014) %>%
rename(gdp_percap=NY.GDP.PCAP.PP.CD, life_expect=SP.DYN.LE00.IN, population=SP.POP.TOTL, birth_rate=SP.DYN.CBRT.IN, neonat_mortal=SH.DYN.NMRT, iso_a2=iso2c)
# import nations join table
nations_join <- read.csv("nations_join.csv", stringsAsFactors=FALSE)
# import regions/income group data
groups <- read.csv("groups.csv", stringsAsFactors=FALSE)
# join to income group data and select desired fields
indicators2 <- inner_join(indicators, nations_join) %>%
inner_join(groups) %>%
select(iso_a3, country, year, region, income_group, gdp_percap, life_expect, population, birth_rate, neonat_mortal)
# separate join for Namibia, because R interprets NA country code as null value
namibia <- inner_join(indicators, nations_join, c("country"="iso_country")) %>%
inner_join(groups) %>%
filter(country=="Namibia") %>%
select(iso_a3, country, year, region, income_group, gdp_percap, life_expect, population, birth_rate, neonat_mortal)
# Add Namibia to the data frame
nations <- rbind(indicators2, namibia) %>%
arrange(iso_a3)
#export data for week1
week1 <- select(nations, iso_a3, country, year, region, income_group, gdp_percap, population, birth_rate, neonat_mortal)
write.csv(week1, "nations.csv", row.names = FALSE, na = "")
setwd("~/Dropbox/ucb/2015/dataviz/raw-data/wdi")
View(indicators)
# import nations join table
nations_join <- read.csv("nations_join.csv", stringsAsFactors=FALSE)
# import regions/income group data
groups <- read.csv("groups.csv", stringsAsFactors=FALSE)
# join to income group data and select desired fields
indicators2 <- inner_join(indicators, nations_join) %>%
inner_join(groups) %>%
select(iso_a3, country, year, region, income_group, gdp_percap, life_expect, population, birth_rate, neonat_mortal)
# separate join for Namibia, because R interprets NA country code as null value
namibia <- inner_join(indicators, nations_join, c("country"="iso_country")) %>%
inner_join(groups) %>%
filter(country=="Namibia") %>%
select(iso_a3, country, year, region, income_group, gdp_percap, life_expect, population, birth_rate, neonat_mortal)
# Add Namibia to the data frame
nations <- rbind(indicators2, namibia) %>%
arrange(iso_a3)
#export data for week3
week3 <- select(nations, iso_a3, country, year, region, income_group, gdp_percap, population, birth_rate, neonat_mortal)
write.csv(week3, "nations.csv", row.names = FALSE, na = "")
