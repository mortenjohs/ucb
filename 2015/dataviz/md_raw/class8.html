<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>class8.html</title>
  <meta name="generator" content="Haroopad 0.13.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF);background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:5px -27px no-repeat #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:#FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:#EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:#75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:1px solid #1A3C6C;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin:0;max-width:none;min-height:0;outline:#112644 0;overflow-x:visible;overflow-y:visible;padding:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}.mermaid .label{color:#333}.node circle,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.edgePath .path{stroke:green;stroke-width:1.5px}.cluster rect{fill:#cdffb2;rx:40;stroke:#6eaa49;stroke-width:1px}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{stroke-width:1.5;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#333}.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:'trebuchet ms',verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:lightgrey;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:lightgrey;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}text{font-family:'trebuchet ms',verdana,arial;font-size:14px}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x;border:0;height:3px;padding:0}hr.underscore{border-top-style:dashed!important}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:url(../img/ajax.gif) center center no-repeat #fff}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}input.task-list-item{margin-left:-1.62em}.markdown{font-family:"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-wrap:break-word}.markdown pre{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;overflow:auto;padding:.5em}.markdown pre code{border:0;display:block}.markdown pre>code{font-family:Consolas,Inconsolata,Courier,monospace;font-weight:700;white-space:pre;margin:0}.markdown code{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown mark{color:#000;background-color:#fcf8e3}.markdown table{padding:0;border-collapse:collapse;border-spacing:0;margin-bottom:16px}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}.github{padding:20px;font-family:"Helvetica Neue",Helvetica,"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Segoe UI",AppleSDGothicNeo-Medium,'Malgun Gothic',Arial,freesans,sans-serif;font-size:15px;background:#fff;line-height:1.6;-webkit-font-smoothing:antialiased}.github a{color:#3269a0}.github a:hover{color:#4183c4}.github h2{border-bottom:1px solid #e6e6e6;line-height:1.6}.github h6{color:#777}.github hr{border:1px solid #e6e6e6}.github pre>code{font-size:.9em;font-family:Consolas,Inconsolata,Courier,monospace}.github blockquote>code,.github h1>code,.github h2>code,.github h3>code,.github h4>code,.github h5>code,.github h6>code,.github li>code,.github p>code,.github td>code{background-color:rgba(0,0,0,.07);font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:85%;padding:.2em .5em;border:0}.github blockquote{border-left:4px solid #e6e6e6;padding:0 15px;font-style:italic}.github table{background-color:#fafafa}.github table tr td,.github table tr th{border:1px solid #e6e6e6}.github table tr:nth-child(2n){background-color:#f2f2f2}.hljs{display:block;overflow-x:auto;padding:.5em;background:#f0f0f0;-webkit-text-size-adjust:none}.hljs,.hljs-subst,.hljs-tag .hljs-title,.nginx .hljs-title{color:#000}.apache .hljs-cbracket,.apache .hljs-tag,.asciidoc .hljs-header,.bash .hljs-variable,.coffeescript .hljs-attribute,.django .hljs-variable,.erlang_repl .hljs-function_or_atom,.haml .hljs-symbol,.hljs-addition,.hljs-constant,.hljs-flow,.hljs-parent,.hljs-pragma,.hljs-preprocessor,.hljs-rules .hljs-value,.hljs-stream,.hljs-string,.hljs-tag .hljs-value,.hljs-template_tag,.hljs-title,.markdown .hljs-header,.ruby .hljs-symbol,.ruby .hljs-symbol .hljs-string,.smalltalk .hljs-class,.tex .hljs-command,.tex .hljs-special{color:#800}.asciidoc .hljs-blockquote,.diff .hljs-header,.hljs-annotation,.hljs-chunk,.hljs-comment,.markdown .hljs-blockquote,.smartquote{color:#888}.asciidoc .hljs-bullet,.asciidoc .hljs-link_url,.go .hljs-constant,.hljs-change,.hljs-date,.hljs-hexcolor,.hljs-literal,.hljs-number,.hljs-regexp,.lasso .hljs-variable,.makefile .hljs-variable,.markdown .hljs-bullet,.markdown .hljs-link_url,.smalltalk .hljs-char,.smalltalk .hljs-symbol{color:#080}.apache .hljs-sqbracket,.asciidoc .hljs-attribute,.asciidoc .hljs-link_label,.clojure .hljs-attribute,.coffeescript .hljs-property,.erlang_repl .hljs-reserved,.haml .hljs-bullet,.hljs-array,.hljs-attr_selector,.hljs-decorator,.hljs-deletion,.hljs-doctype,.hljs-envvar,.hljs-filter .hljs-argument,.hljs-important,.hljs-javadoc,.hljs-label,.hljs-localvars,.hljs-phony,.hljs-pi,.hljs-prompt,.hljs-pseudo,.hljs-shebang,.lasso .hljs-attribute,.markdown .hljs-link_label,.nginx .hljs-built_in,.ruby .hljs-string,.tex .hljs-formula,.vhdl .hljs-attribute{color:#88f}.apache .hljs-tag,.asciidoc .hljs-strong,.bash .hljs-variable,.css .hljs-tag,.hljs-built_in,.hljs-dartdoc,.hljs-id,.hljs-javadoctag,.hljs-keyword,.hljs-phpdoc,.hljs-request,.hljs-status,.hljs-title,.hljs-type,.hljs-typename,.hljs-winutils,.hljs-yardoctag,.markdown .hljs-strong,.smalltalk .hljs-class,.tex .hljs-command{font-weight:700}.asciidoc .hljs-emphasis,.markdown .hljs-emphasis{font-style:italic}.nginx .hljs-built_in{font-weight:400}.coffeescript .javascript,.javascript .xml,.lasso .markup,.tex .hljs-formula,.xml .css,.xml .hljs-cdata,.xml .javascript,.xml .vbscript{opacity:.5}.MathJax_Hover_Frame{border-radius:.25em;-webkit-border-radius:.25em;-moz-border-radius:.25em;-khtml-border-radius:.25em;box-shadow:0 0 15px #83A;-webkit-box-shadow:0 0 15px #83A;-moz-box-shadow:0 0 15px #83A;-khtml-box-shadow:0 0 15px #83A;border:1px solid #A6D!important;display:inline-block;position:absolute}.MathJax_Hover_Arrow{position:absolute;width:15px;height:11px;cursor:pointer}#MathJax_About{position:fixed;left:50%;width:auto;text-align:center;border:3px outset;padding:1em 2em;background-color:#DDD;color:#000;cursor:default;font-family:message-box;font-size:120%;font-style:normal;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;-khtml-border-radius:15px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_Menu{position:absolute;background-color:#fff;color:#000;width:auto;padding:5px 0;border:1px solid #CCC;margin:0;cursor:default;font:menu;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;-khtml-border-radius:5px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_MenuItem{padding:1px 2em;background:0 0}.MathJax_MenuArrow{position:absolute;right:.5em;color:#666}.MathJax_MenuActive .MathJax_MenuArrow{color:#fff}.MathJax_MenuArrow.RTL{left:.5em;right:auto}.MathJax_MenuCheck{position:absolute;left:.7em}.MathJax_MenuCheck.RTL{right:.7em;left:auto}.MathJax_MenuRadioCheck{position:absolute;left:.7em}.MathJax_MenuRadioCheck.RTL{right:.7em;left:auto}.MathJax_MenuLabel{padding:1px 2em 3px 1.33em;font-style:italic}.MathJax_MenuRule{border-top:1px solid #DDD;margin:4px 3px}.MathJax_MenuDisabled{color:GrayText}.MathJax_MenuActive{background-color:#606872;color:#fff}.MathJax_Menu_Close{position:absolute;width:31px;height:31px;top:-15px;left:-15px}#MathJax_Zoom{position:absolute;background-color:#F0F0F0;overflow:auto;display:block;z-index:301;padding:.5em;border:1px solid #000;margin:0;font-weight:400;font-style:normal;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;box-shadow:5px 5px 15px #AAA;-webkit-box-shadow:5px 5px 15px #AAA;-moz-box-shadow:5px 5px 15px #AAA;-khtml-box-shadow:5px 5px 15px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_ZoomOverlay{position:absolute;left:0;top:0;z-index:300;display:inline-block;width:100%;height:100%;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_ZoomFrame{position:relative;display:inline-block;height:0;width:0}#MathJax_ZoomEventTrap{position:absolute;left:0;top:0;z-index:302;display:inline-block;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}.MathJax_Preview{color:#888}#MathJax_Message{position:fixed;left:1px;bottom:2px;background-color:#E6E6E6;border:1px solid #959595;margin:0;padding:2px 8px;z-index:102;color:#000;font-size:80%;width:auto;white-space:nowrap}#MathJax_MSIE_Frame{position:absolute;top:0;left:0;width:0;z-index:101;border:0;margin:0;padding:0}.MathJax_Error{color:#C00;font-style:italic}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown github">
<h1 id="making-static-maps-and-processing-geodata-with-gis"><a name="making-static-maps-and-processing-geodata-with-gis" href="#making-static-maps-and-processing-geodata-with-gis"></a>Making static maps and processing geodata with GIS</h1><h3 id="introducing-qgis"><a name="introducing-qgis" href="#introducing-qgis"></a>Introducing QGIS</h3><p><a href="http://qgis.org/en/site/"><strong>GQIS</strong></a> is the leading free, open source Geographic Information Systems (GIS) application. It is capable of sophisticated geodata processing and analysis, and also can be used to design publication-quality data-driven maps.</p><p>The possibilities are almost endless, but you don’t need to be a GIS expert to put it to effective use for both displaying and processing geographic data, whether for online or print maps.</p><p>Launch QGIS, and you should see a screen like this:</p><p><img src="img/class8_1.jpg" alt=""></p><h3 id="the-data-we-will-use-today"><a name="the-data-we-will-use-today" href="#the-data-we-will-use-today"></a>The data we will use today</h3><p>Download the data from this session from <a href="data/week8.zip">here</a>, unzip the folder and place it on your desktop. It contains the following folders and files:</p><ul>
<li><code>ca_healthcare</code><ul>
<li><code>ca_counties_medicare</code> Shapefile with data on Medicare reimbursement per enrollee by California county in 2012, from the <a href="http://www.dartmouthatlas.org">Dartmouth Atlas of Healthcare</a>. </li><li><code>healthcare_facilities.csv</code> Locations and other data for hospitals and other healthcare facilities in California, from the <a href="https://cdph.data.ca.gov/Facilities-and-Services/Healthcare-Facility-Locations/n8ju-ifrh">California Department of Public Health</a>. I have geocoded those facilities that lacked latitude and longitude coordinates in the raw data.</li><li><code>hospitals</code> Shapefile with data on general acute care hospitals and skilled nursing facilities in Califoria, filtered from the data above.</li></ul>
</li><li><code>gdp_pc</code><ul>
<li><code>gpd_pc.csv</code> <code>gdp_pc.csvt</code> CSV file with <a href="http://data.worldbank.org/indicator/NY.GDP.PCAP.PP.CD">World Bank data</a> on GDP per capita for the world’s nations in 2014, plus ancillary file for QGIS to understand the data types for each field.</li></ul>
</li><li><code>ne_50m_admin_0_countries</code> <a href="http://www.naturalearthdata.com/downloads/50m-cultural-vectors/50m-admin-0-countries-2/">Natural Earth shapefile</a> with boundary data for the world’s nations.</li><li><code>seismic_risk</code> <a href="http://earthquake.usgs.gov/hazards/products/conterminous/index.php#2014">U.S. Geological Survey shapefile</a> detailing the risk of experiencing a major earthquake across the continental United States.</li><li><code>sf_test_addresses</code> Shapefile derived from the addresses we geocoded in week 7.</li></ul><h3 id="map-medicare-reimbursements-and-hospital-locations-and-capacities-in-california"><a name="map-medicare-reimbursements-and-hospital-locations-and-capacities-in-california" href="#map-medicare-reimbursements-and-hospital-locations-and-capacities-in-california"></a>Map Medicare reimbursements and hospital locations and capacities in California</h3><h4 id="make-a-choropleth-map-showing-medicare-reimbursements-by-county"><a name="make-a-choropleth-map-showing-medicare-reimbursements-by-county" href="#make-a-choropleth-map-showing-medicare-reimbursements-by-county"></a>Make a choropleth map showing Medicare reimbursements by county</h4><p>As we discussed in week 7, choropleth maps fill areas with color, according to values in the data.</p><p>We will first import the shapefile in the <code>ca_counties_medicare</code> folder.</p><p>Select <code>Layer&gt;Add vector layer</code> or click on this icon:</p><p><img src="img/class8_2.jpg" alt=""></p><p>At the dialog box, click <code>Browse</code> and navigate to the file <code>ca_counties_medicare</code>. It is important that you select the file with the <code>.shp</code> extension. Then click open, and the following map of California should appear, filled with a random color:</p><p><img src="img/class8_3.jpg" alt=""></p><p>You can turn off the visibility of any layer by unchecking its box in the <code>Layers</code> panel. This can be useful to see the status of layers that would otherwise be obscured.</p><p>These controls allow you to pan and zoom the display:</p><p><img src="img/class8_4.jpg" alt=""></p><p>You can focus the display on the full extent of any layer by right-clicking it in the <code>Layers</code> panel and selecting <code>Zoom to layer</code>.</p><p>Notice <code>EPSG:4269</code> at the bottom right. This is defines the map projection and datum for the layer.</p><p>Right-click on <code>ca_counties_medicare</code> in the <code>Layers</code> panel at left and select <code>Properties&gt;General</code>. You should see the following under <code>Coordinate reference system</code>:</p><p><img src="img/class8_5.jpg" alt=""></p><p> <code>EPSG:4269</code> and <code>NAD83</code> mean that this shapefile is in an <a href="http://en.wikipedia.org/wiki/Equirectangular_projection">equirectangular projection</a>, and the <a href="http://en.wikipedia.org/wiki/North_American_Datum">NAD83</a> datum.</p><p>(The default for QGIS if no projection is specified is <code>EPSG:4326</code>, which is an equirectangular projection, and the <a href="https://en.wikipedia.org/wiki/World_Geodetic_System">WGS84</a> datum)</p><p>We will select another projection for our map later. Click <code>Cancel</code> or <code>OK</code> to close <code>Properties</code> for this layer.</p><p>Now we need to color the areas for the <code>ca_counties_medicare</code> layer by values in the data. Right-click on it in the <code>Layers</code> panel and select <code>Open Attribute Table</code>, which corresponds to the <code>.dbf</code> of the shapefile:</p><p><img src="img/class8_6.jpg" alt=""></p><p>Scroll to the right of the table to see the fields detailing various categories of Medicare reimbursement:</p><p><img src="img/class8_7.jpg" alt=""></p><p>We are going to make a choropleth map of reimbursements per enrollee for hospitals and skilled nursing facilities, in the <code>HOSPITAL</code> field.</p><p>To do this, close the attribute table and call up <code>Properties&gt;Style</code> for the <code>ca_counties_medicare</code> layer. Select <code>Graduated</code> from the dropdown menu at top, which is the option to color data according to values of a continuous variable. Select <code>5</code> under <code>Classes</code>, and then <code>New color ramp...</code> under <code>Color ramp</code>. While QGIS has many available color ramps, we will use this opportunity to call in a <a href="http://colorbrewer2.org/">ColorBrewer</a> sequential color scheme. At the dialog box select <code>ColorBrewer</code> and then <code>Reds</code>, and then click <code>OK</code>:</p><p><img src="img/class8_8.jpg" alt=""></p><p>You will need to give the color ramp a name — the default <code>Reds5</code> is fine. Select <code>HOSPITAL</code> under <code>Column</code>, and select <code>Quantile (Equal Count)</code> for <code>Mode</code>. This menu gives various options for automatically setting the boundaries between the five classes or bins. Then click the <code>Classify</code> button to produce the following display:</p><p><img src="img/class8_9.jpg" alt=""></p><p>Now let’s edit the breaks manually to use values guided by the quantiles, but which will be easier for users to process when reading the map legend.</p><p>Double-click on the first symbol and select <code>3250</code> for the <code>Upper value</code> and click <code>OK</code>. Then double-click on the <code>Label</code> for this symbol and edit the text to <code>&lt; $3,250</code>. Carry on editing the values and labels until the display looks like this:</p><p><img src="img/class8_10.jpg" alt=""></p><p>Click <code>OK</code> and the map should look like this:</p><p><img src="img/class8_11.jpg" alt=""></p><p>I often prefer white boundaries on a choropleth map. So open up the <code>Style</code> tab under <code>Properties</code> once more and click on <code>Symbol&gt;Change...</code>. Then select <code>Simple fill</code>, click on the color for <code>Border</code> and in the color wheel tab of the color picker, change the color to white, by moving each of the RGB sliders to <code>255</code>:</p><p><img src="img/class8_12.jpg" alt=""></p><p>Click on <code>Symbol&gt;Change</code> once more, and and set the <code>Transparency</code> to 50%. This will keep the relative distinctions between the colors, but tone them down a little so they don’t dominate the layer we will later plot on top.</p><p>If you are likely to want to style data in the same format in the same way in future, it is a good idea to click the <code>Style</code> button at bottom left and select <code>Save Style&gt;QGIS Layer Style File</code>. This saves the style in <code>QML</code>, which is a variant of <a href="http://www.w3.org/XML/">XML</a>. When loaded using the <code>Style&gt;Load Style</code>, it will automatically apply the saved styling to future maps.</p><p>The map should now look like this:</p><p><img src="img/class8_13.jpg" alt=""></p><p>To add labels to the map, select <code>Properties&gt;Labels</code> and fill in the dialog box. Here I am adding a <code>NAME</code> label to each county, using <code>Arial</code> font, <code>Italic</code> style at a size of <code>8</code> points and with the color set to a HEX value of <code>#4c4c4c</code> for a dark gray:</p><p><img src="img/class8_14.jpg" alt=""></p><p>Click <code>OK</code> and the map should now look like this:</p><p><img src="img/class8_15.jpg" alt=""></p><p>Save the project, by selecting <code>Project&gt;Save</code> from the top menu.</p><p>Now is a good time to give the project a projection: We will use variant of the <a href="http://en.wikipedia.org/wiki/Albers_projection">Albers Equal Area Conic projection</a>, optimized for maps of California.</p><p>Select <code>Project&gt;Project Properties&gt;CRS</code> (for Coordinate Reference System) from the top menu, and check <code>Enable 'on the fly' CRS transformation</code>. This will convert any subsequent layers we import into the Albers projection, also.</p><p>Type <code>Albers</code>into the <code>Filter</code> box and select <code>NAD83(HARN)/ California Albers</code>, which has the code <code>EPSG:3311</code>:</p><p><img src="img/class8_16.jpg" alt=""></p><p>Click <code>OK</code> and the map should reproject. Notice how <code>EPSG:3311</code> now appears at bottom right:</p><p><img src="img/class8_17.jpg" alt=""></p><h4 id="add-a-layer-showing-locations-and-capacities-hospitals/skilled-nursing-facilities"><a name="add-a-layer-showing-locations-and-capacities-hospitals/skilled-nursing-facilities" href="#add-a-layer-showing-locations-and-capacities-hospitals/skilled-nursing-facilities"></a>Add a layer showing locations and capacities hospitals/skilled nursing facilities</h4><p>To import a CSV or other delimited text file with points described by latitude and longitude coordinates, select <code>Layer&gt;Add Delimited Text Layer</code> from the top menu or click this icon:</p><p><img src="img/class8_18.jpg" alt=""></p><p><code>Browse</code> to the file <code>healthcare_facilities.csv</code>, and ensure that the dialog box is filled in like this:</p><p><img src="img/class8_19.jpg" alt=""></p><p>If your text file is not a CSV you will have to select the correct delimiter, and if your latitude and longitude fields have other names, you may have to select the <code>X field</code> (longitude) and <code>Y field</code> (latitude) manually.</p><p>When you click <code>OK</code> you will be asked to select a projection, or CRS, for the data. You may be tempted to select the same Albers projection we have set for the project, but this will cause an error. QGIS will handle the conversion to that projection: Because the data in the CSV file is not yet projected, instead select a datum with a default equirectangular projection, either <code>WGS 84 EPSG:4326</code> or <code>NAD83 EPSG:4269</code>.</p><p>Click <code>OK</code> and a large number of points will be added to the map:</p><p><img src="img/class8_20.jpg" alt=""></p><p>Now we will style these points, using color to distinguish hospitals from skilled nursing facilities, removing other facilities from the map, and scaling the circles according to the capacity of each facility.</p><p>Select <code>Properties&gt;Style</code> for the <code>healthcare_facilities</code> layer, and accept <code>Categorized</code> from the top dropdown menu. Select <code>TYPE</code> under <code>Column</code> and then hit the <code>Classify</code> button. (Keeping <code>Random colors</code> for the <code>Color ramp</code> is fine, as we will edit the colors manually). Select and then <code>Delete</code> facilities other than <code>General Acute Care Hospital</code> and <code>Skilled Nursing Facility</code>, as follows (This will remove them from the map, but not from the underlying data):</p><p><img src="img/class8_21.jpg" alt=""></p><p>You should be left with the following:</p><p><img src="img/class8_22.jpg" alt=""></p><p>Under <code>Symbol</code> click <code>Change</code> and change the default color for the symbols to blue:</p><p><img src="img/class8_23.jpg" alt=""></p><p>Also change the <code>Transparency</code> for the symbols to 50%, and edit the Legend entries so the are not in capitals:</p><p><img src="img/class8_24.jpg" alt=""></p><p>Now double-click the symbols for each of the categories, and change the <code>Color</code> so that the hospitals are the same blue, and the nursing facilities are orange.</p><p>Our next task is to scale the healthcare facilities according to their <code>CAPACITY</code>, in beds. Select both of the categories, right click, and select <code>Change size</code>. At the dialog box, click on this symbol:</p><p><img src="img/class8_25.jpg" alt=""></p><p>Select <code>Size Assistant ...</code> and fill in the dialog box as follows:</p><p><img src="img/class8_26.jpg" alt=""></p><p>Using the <code>Scale method</code> of <code>Surface</code> will scale the circles by area, according to values in the data; <code>Flannery</code> is a <a href="http://makingmaps.net/2007/08/28/perceptual-scaling-of-map-symbols/">method of scaling</a> that is designed to compensate for the errors people make when estimating the area of circles. You may wish to experiment with this, but I would strongly advise against using <code>Radius</code>, for the reasons we discussed in week 2.</p><p>Click <code>OK</code> until you return to the map, which should now look like this:</p><p><img src="img/class8_27.jpg" alt=""></p><h4 id="export-the-finished-map-in-raster-image-or-vector-graphic-formats"><a name="export-the-finished-map-in-raster-image-or-vector-graphic-formats" href="#export-the-finished-map-in-raster-image-or-vector-graphic-formats"></a>Export the finished map in raster image or vector graphic formats</h4><p>We will export our finished map with a legend, so let’s change the name of the fields so they display nicely. Right-click on each layer and rename them <code>Facility type</code> and <code>Medicare reimbursement per enrollee</code> respectively. Under <code>Properties&gt;style</code>, also change the case in the legend for each category of facility, so they don’t appear in capitals:</p><p><img src="img/class8_28.jpg" alt=""></p><p>To export the map, select <code>Project&gt;New Print Composer</code>, give the composer an appropriate name and click <code>OK</code>. In the print composer window, select the following options in the <code>Composition</code> tab (I have chosen a <code>Portrait</code> orientation to best fit the shape of California):</p><p><img src="img/class8_29.jpg" alt=""></p><p>Now click the <code>Add new map</code> icon:</p><p><img src="img/class8_30.jpg" alt=""></p><p>Draw a rectangle over the page area, and the map should appear. At this point, you may need to alter the zoom level and position of your map in the main QGIS display to get a pleasing display in the print composer. (In this case, it is also worth changing the size/shape of the main QGIS window to match the portrait orientation.)</p><p>Your print composer should end up looking something like this:</p><p><img src="img/class8_31.jpg" alt=""></p><p>Once you are statisfied with the appearance of your map in the print composer, click the <code>Add legend</code> icon:</p><p><img src="img/class8_32.jpg" alt=""></p><p>Draw a rectangle on the page where you want the legend to appear:</p><p><img src="img/class8_33.jpg" alt=""></p><p>In the <code>Item properties</code> tab, edit <code>Fonts</code> and other options as desired. Here I have deleted the default <code>Title</code> of <code>Legend</code>, removed the legend item for the scaling of the facilities, which was rather ugly, and edit the text for <code>Facilty type</code> to explain the scaling:</p><p><img src="img/class8_34.jpg" alt=""></p><p>Note: To remove an item from the legend, you must first uncheck <code>Auto update</code>; then select and use the red minus symbol to remove items.</p><p>You can save your maps in raster image formats (JPG, PNG etc) from the Print Composer by clicking the <code>Save Image</code> icon:</p><p><img src="img/class8_35.jpg" alt=""></p><p>The map can be exported in SVG and PDF vector formats by clicking these export icons:</p><p><img src="img/class8_36.jpg" alt=""></p><p>Note that the SVG export may not clip the map to the page exactly. However, this can be fixed in a vector graphics editor such as <a href="http://www.adobe.com/products/illustrator.html">Adobe Illustrator</a> or <a href="https://inkscape.org/en/">Inkscape</a>, and then saved as a PDF. This may provide a better rendering of the map than through a direct PDF export.</p><p>You can also save as an image from the main map display (so without any legend and annotation added in the Print Composer) by selecting <code>Project&gt;Save as Image</code> from the top menu.</p><p>Save the QGIS project, and then select <code>Project&gt;Close</code> to close.</p><h4 id="join-external-data-to-a-shapefile"><a name="join-external-data-to-a-shapefile" href="#join-external-data-to-a-shapefile"></a>Join external data to a shapefile</h4><p>Open a new project by selecting <code>Project&gt;New</code> from the top menu.</p><p>In this new project, import the <code>ne_50m_admin_0_countries</code> shapefile. Right-click on it in the <code>Layers</code> panel and <code>Save As ...</code> an <code>ESRI shapefile</code>, keeping the default <code>WGS 84</code> CRS. <code>Browse</code> to the <code>gdp_pc</code> folder, call the new file <code>gdp_pc</code> and check the option to <code>Add saved file to map</code>.</p><p>Open the attribute table of the new shapefile and notice that it contains a field called <code>iso_a3</code>, which is a <a href="http://unstats.un.org/unsd/tradekb/Knowledgebase/Country-Code">three-letter code</a> for each country, assigned by the <a href="hhttp://www.iso.org/iso/home/store/catalogue_tc/catalogue_detail.htm?csnumber=63545">International Organization for Standardization</a>.</p><p>Now use <code>Add Vector Layer</code> to import the file <code>gdp_pc.csv</code>. (Note that when joining external data in a CSV file to a shapefile, you do <em>not</em> import the file as a delimited text file, as we did previously to display data on a map.)</p><p>After import, this file will appear as an isolated table in the <code>Layers</code> panel. Select it and open the attribute table to view the data, which contains country names, the three-letter country codes, and data on GDP per capita in 2014:</p><p><img src="img/class8_37.jpg" alt=""></p><p>Notice that some cells contain the value <code>-99</code>, which is here being used to designate <code>null</code> values, where there is no data.</p><p>The same subfolder with the file also contains the file <code>gdp_pc.csvt</code>. This contains information about the type of data in each field of the CSV file, in this case:</p><pre><code data-origin="<pre><code>&quot;String&quot;,&quot;String&quot;,&quot;Real&quot;
</code></pre>">"String","String","Real"
</code></pre><p>When we make the join, this will tell QGIS what sort of data is in each field of the CSV file. <code>String</code> indicates a string of text, <code>Real</code> indicates numbers that can include decimals, while <code>Integer</code> indicates whole numbers. Without this information, QGIS will treat all of the fields in the file as text.</p><p>Close the attribute table once more, right-click on the <code>gdp_pc</code> shapefile and select <code>Properties&gt;Joins</code>. Click the green plus sign and fill in the dialog box as follows to join the CSV file to the shapefile by the <code>iso_a3</code> three-letter country codes:</p><p><img src="img/class8_38.jpg" alt=""></p><p>After completing the join, open the shapefile’s attribute table once more to confirm that the data from the CSV file has appeared.</p><h4 id="save-the-joined-data-in-another-geodata-format"><a name="save-the-joined-data-in-another-geodata-format" href="#save-the-joined-data-in-another-geodata-format"></a>Save the joined data in another geodata format</h4><p>Right-click on the joined shapefile, select <code>Save As ...</code> and notice the <code>Format</code> options include ESRI shapefile, GeoJSON and KML. You are also able to choose a projection (CRS) for the new file and restrict its extent by latitude and longitude coordinates.</p><p>Save this file as GeoJSON with an appropriate name, keeping the default <code>WGS 84</code> CRS.</p><h4 id="simplify-the-joined-data,-and-save-again"><a name="simplify-the-joined-data,-and-save-again" href="#simplify-the-joined-data,-and-save-again"></a>Simplify the joined data, and save again</h4><p>When displaying geodata online, it is sometimes necessary to simplify boundary data to give a smaller file size, allowing faster loading in a web browser.</p><p>Select the joined shapefile, then select <code>Vector&gt;Geometry Tools&gt;Simplify geometries</code>, and fill in the dialog box as follows, saving as a shapefile with a new name:</p><p><img src="img/class8_39.jpg" alt=""></p><p>In practice, you will want to experiment with different values for <code>Simplify tolerance</code> to give an acceptable trade-off between file size and appearance at high zoom levels.</p><p>Save the simplified file as GeoJSON, and compare the file size with the previously saved version.</p><p>Alternatively, you can also simplify geodata outside of QGIS using the <a href="http://www.mapshaper.org/"><strong>mapshaper</strong></a> web app. This has the advantage that you can move a slider to control the amount of simplification, and see the effect that this will have before exporting the simplified file.</p><h4 id="use-qgis's-vector-geoprocessing-tools"><a name="use-qgis's-vector-geoprocessing-tools" href="#use-qgis's-vector-geoprocessing-tools"></a>Use QGIS’s vector geoprocessing tools</h4><p>Start a new project, and import both the <code>ne_50m_admin_0_countries</code> shapefile, and the <code>seismic_risk</code> shapefile, which describes the risk of experiencing a damaging earthquake across the continental United States. Note that it extends beyond the boundaries and coastline of the U.S.:</p><p><img src="img/class8_40.jpg" alt=""></p><p>Open the attribute table for the <code>ne_50m_admin_0_countries</code> shapefile, and select the United States:</p><p><img src="img/class8_41.jpg" alt=""></p><p>Close the attribute table once more, and turn off the visibility of the seismic risk layer to confirm that the United States is now highlighted.</p><p><img src="img/class8_42.jpg" alt=""></p><p>Select <code>Vector&gt;Geoprocessing Tools&gt;Clip</code> and fill in the dialog box as follows, making sure that <code>Use only selected features</code> is checked for the <code>Clip layer</code>:</p><p><img src="img/class8_43.jpg" alt=""></p><p>Click <code>OK</code> and a new shapefile will be created, clipped to the borders and coastline of the United States:</p><p><img src="img/class8_44.jpg" alt=""></p><p>Sometimes you may need to draw your own shape to clip to, rather than using existing geodata. When drawing shapes based on city streets, <a href="http://www.birdtheme.org/useful/v3tool.html">this web app</a> can be a useful tool. Select the <code>Polygon</code> and <code>KML</code> options from the dropdown menu and draw your shape over the basemap.</p><p><img src="img/class8_45.jpg" alt=""></p><p>Paste the resulting code into a text file and save with the extension <code>.kml</code>. You can then use this KML file as a clip layer in QGIS.</p><p>Look at the other options in the <code>Vector&gt;Geoprocessing Tools</code> menu. Their icons give a good idea of what they do; see <a href="http://docs.qgis.org/2.2/en/docs/user_manual/plugins/plugins_ftools.html">here</a> for a full explanation. (<code>Intersect</code> is similar to <code>Clip</code>, except that it includes data from both layers in the new attribute table.)</p><p>Now open a new project, and import the shapefile <code>sf_test_addresses</code>. I made this shapefile from the addresses we geocoded in week 7. I saved it in a <code>Google Mercator</code> projection, also known as <code>EPSG:900913</code>, used for Google and other online maps.</p><p>This is important, because we are going to create a “buffer” defining areas within 1,000 feet of the nearest point. For this we need a projection with units defined in distance, rather than degrees, which is the unit for the <code>WGS 84</code> datum.</p><p>To confirm the units for the <code>Google Mercator</code> projection, click on the globe symbol at bottom-right:</p><p><img src="img/class8_46.jpg" alt=""></p><p>You should see that the CRS/projection information that appears near the bottom of the dialog box contains <code>+units=m</code>, which tells us that distances in this projection are measure in meters:</p><p><img src="img/class8_47.jpg" alt=""></p><p>Creating a buffer shapefile is a task you might perform if, for example, working out which areas are off-limits for sex offenders under <a href="http://www.atsa.com/sexual-offender-residence-restrictions">residency restrictions</a>.</p><p>Select <code>Vector&gt;Geoprocessing Tools&gt;Buffer(s)...</code> and fill in the dialog box as follows:</p><p><img src="img/class8_48.jpg" alt=""></p><p>Selecting the maximum value of <code>99</code> under <code>Segments to approximate</code> ensures that the resulting shapes are as smooth as possible. <code>Buffer distance</code> is set to <code>304.8</code> because the projection’s units are meters; this value gives the 1,000 feet we require. Checking <code>Dissolve buffer results</code> merges overlapping buffers into the same polygon.</p><p>Click <code>OK</code>, and this should be the result:</p><p><img src="img/class8_49.jpg" alt=""></p><h4 id="install-qgis-plugins"><a name="install-qgis-plugins" href="#install-qgis-plugins"></a>Install QGIS plugins</h4><p>QGIS has an active community of open-source developers who have developed many plugins that perform specific tasks. If you have a particular geoprocessing task to perform, it is worth searching for plugins that may be able to help.</p><p>We are going to install a plugin that will allow us to perform hexagonal binning of points.</p><p>From the top menu select <code>Plugins&gt;Manage and Install Plugins...</code> and search for <code>MMQGIS</code>. Select the plugin, and click the <code>Install plugin</code> button.</p><p>You should now have an <code>MMQGIS</code> menu at top.</p><h4 id="use-hexagonal-binning-to-summarize-data-on-california-healthcare-facilities"><a name="use-hexagonal-binning-to-summarize-data-on-california-healthcare-facilities" href="#use-hexagonal-binning-to-summarize-data-on-california-healthcare-facilities"></a>Use hexagonal binning to summarize data on California healthcare facilities</h4><p>Open a new project and import the <code>hospitals</code> shapefile from the <code>ca_healthcare</code> subfolder. This is a filtered version of the <code>healthcare_facilities.csv</code> data, containing just hospitals and skilled nursing facilities. Again it is in a <code>Google Mercator</code> projection.</p><p>We will use the <code>MMQGIS</code> plugin to create a hexagonal grid over the map, and then count the number of facilites in each grid cell, and add up their total capacity.</p><p>First use the zoom and pan controls to ensure that there is a little space around the points in the displayed area, giving a view something like this:</p><p><img src="img/class8_50.jpg" alt=""></p><p>Select <code>MMQGIS&gt;Create&gt;Create Grid Lines Layer</code> and fill in the dialog box as follows:</p><p><img src="img/class8_51.jpg" alt=""></p><p><code>Center X</code>and <code>Middle Y</code> will by default be the longitude and latitutude for the center of the displayed area. Make sure to select <code>Hexagon (polygon)</code>, and then set the <code>H Spacing</code>; <code>V Spacing</code> will adjust automatically. Because we are working with a shapefile in <code>Google Mercator</code> projection, the units will be in meters, so here we have set a horizonatal spacing for the hexagons of 20 kilometers.</p><p>Click <code>OK</code> to create the grid layer, giving it the same <code>Google Mercator</code> projection. Drag the new grid layer under the points in the <code>Layers</code> panel and the map should look like this:</p><p><img src="img/class8_52.jpg" alt=""></p><p>Now select <code>Vector&gt;Analysis Tools&gt;Points in Polygon</code> and fill in the dialog box as follows:</p><p><img src="img/class8_53.jpg" alt=""></p><p>This will create a new shapefile with a field <code>PNTCNT</code>, giving the count of the facilities in each cell in the grid. It will also create a second field giving the total capacity of all the facilities in each cell, because we are aggregating the <code>CAPACITY</code> field using the function <code>sum</code>.</p><p>Here is the attribute table from the resulting shapefile:</p><p><img src="img/class8_54.jpg" alt=""></p><p>Again, give this a <code>Google Mercator</code> projection. Save this file in GeoJSON format.</p><h3 id="assignment"><a name="assignment" href="#assignment"></a>Assignment</h3><p>Use your GeoJSON file of 2014 GDP per capita for the world’s nations to replicate this map:</p><p><img src="img/class1_16.jpg" alt=""></p><p>Some hints:</p><ul>
<li><p>You will need to change to a <code>World_Robinson EPSG:54030</code> projection. When you do so, you may find the map transforms to a strange series of geometric shapes. If this happens, right-click on the layer, select <code>Properties&gt;Rendering</code> and uncheck <code>Simplify geometry</code>.</p>
</li><li><p>When styling the map, use a ColorBrewer sequential color scheme with 5 classes. Then use the <code>Add class</code> button to add a class/bin for the countries with no data. Remember that these will have the value <code>-99</code>, so you can then set the values and labels for each bin in the data manually. Use a neutral gray for the countries with no data.</p>
</li></ul><h3 id="further-reading"><a name="further-reading" href="#further-reading"></a>Further reading</h3><p><a href="http://docs.qgis.org/2.2/en/docs/training_manual/">QGIS Training Manual</a></p><p><a href="http://docs.qgis.org/2.2/en/docs/user_manual/">QGIS User Guide</a></p><p><a href="http://docs.qgis.org/2.2/en/docs/gentle_gis_introduction/">A Gentle Introduction to GIS</a></p>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>
