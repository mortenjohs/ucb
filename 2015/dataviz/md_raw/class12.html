<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>class12.html</title>
  <meta name="generator" content="Haroopad 0.13.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF);background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:5px -27px no-repeat #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:#FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:#EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:#75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:1px solid #1A3C6C;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin:0;max-width:none;min-height:0;outline:#112644 0;overflow-x:visible;overflow-y:visible;padding:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}.mermaid .label{color:#333}.node circle,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.edgePath .path{stroke:green;stroke-width:1.5px}.cluster rect{fill:#cdffb2;rx:40;stroke:#6eaa49;stroke-width:1px}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{stroke-width:1.5;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#333}.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:'trebuchet ms',verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:lightgrey;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:lightgrey;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}text{font-family:'trebuchet ms',verdana,arial;font-size:14px}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x;border:0;height:3px;padding:0}hr.underscore{border-top-style:dashed!important}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:url(../img/ajax.gif) center center no-repeat #fff}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}input.task-list-item{margin-left:-1.62em}.markdown{font-family:"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-wrap:break-word}.markdown pre{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;overflow:auto;padding:.5em}.markdown pre code{border:0;display:block}.markdown pre>code{font-family:Consolas,Inconsolata,Courier,monospace;font-weight:700;white-space:pre;margin:0}.markdown code{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown mark{color:#000;background-color:#fcf8e3}.markdown table{padding:0;border-collapse:collapse;border-spacing:0;margin-bottom:16px}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}.github{padding:20px;font-family:"Helvetica Neue",Helvetica,"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Segoe UI",AppleSDGothicNeo-Medium,'Malgun Gothic',Arial,freesans,sans-serif;font-size:15px;background:#fff;line-height:1.6;-webkit-font-smoothing:antialiased}.github a{color:#3269a0}.github a:hover{color:#4183c4}.github h2{border-bottom:1px solid #e6e6e6;line-height:1.6}.github h6{color:#777}.github hr{border:1px solid #e6e6e6}.github pre>code{font-size:.9em;font-family:Consolas,Inconsolata,Courier,monospace}.github blockquote>code,.github h1>code,.github h2>code,.github h3>code,.github h4>code,.github h5>code,.github h6>code,.github li>code,.github p>code,.github td>code{background-color:rgba(0,0,0,.07);font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:85%;padding:.2em .5em;border:0}.github blockquote{border-left:4px solid #e6e6e6;padding:0 15px;font-style:italic}.github table{background-color:#fafafa}.github table tr td,.github table tr th{border:1px solid #e6e6e6}.github table tr:nth-child(2n){background-color:#f2f2f2}.hljs{display:block;overflow-x:auto;padding:.5em;background:#f0f0f0;-webkit-text-size-adjust:none}.hljs,.hljs-subst,.hljs-tag .hljs-title,.nginx .hljs-title{color:#000}.apache .hljs-cbracket,.apache .hljs-tag,.asciidoc .hljs-header,.bash .hljs-variable,.coffeescript .hljs-attribute,.django .hljs-variable,.erlang_repl .hljs-function_or_atom,.haml .hljs-symbol,.hljs-addition,.hljs-constant,.hljs-flow,.hljs-parent,.hljs-pragma,.hljs-preprocessor,.hljs-rules .hljs-value,.hljs-stream,.hljs-string,.hljs-tag .hljs-value,.hljs-template_tag,.hljs-title,.markdown .hljs-header,.ruby .hljs-symbol,.ruby .hljs-symbol .hljs-string,.smalltalk .hljs-class,.tex .hljs-command,.tex .hljs-special{color:#800}.asciidoc .hljs-blockquote,.diff .hljs-header,.hljs-annotation,.hljs-chunk,.hljs-comment,.markdown .hljs-blockquote,.smartquote{color:#888}.asciidoc .hljs-bullet,.asciidoc .hljs-link_url,.go .hljs-constant,.hljs-change,.hljs-date,.hljs-hexcolor,.hljs-literal,.hljs-number,.hljs-regexp,.lasso .hljs-variable,.makefile .hljs-variable,.markdown .hljs-bullet,.markdown .hljs-link_url,.smalltalk .hljs-char,.smalltalk .hljs-symbol{color:#080}.apache .hljs-sqbracket,.asciidoc .hljs-attribute,.asciidoc .hljs-link_label,.clojure .hljs-attribute,.coffeescript .hljs-property,.erlang_repl .hljs-reserved,.haml .hljs-bullet,.hljs-array,.hljs-attr_selector,.hljs-decorator,.hljs-deletion,.hljs-doctype,.hljs-envvar,.hljs-filter .hljs-argument,.hljs-important,.hljs-javadoc,.hljs-label,.hljs-localvars,.hljs-phony,.hljs-pi,.hljs-prompt,.hljs-pseudo,.hljs-shebang,.lasso .hljs-attribute,.markdown .hljs-link_label,.nginx .hljs-built_in,.ruby .hljs-string,.tex .hljs-formula,.vhdl .hljs-attribute{color:#88f}.apache .hljs-tag,.asciidoc .hljs-strong,.bash .hljs-variable,.css .hljs-tag,.hljs-built_in,.hljs-dartdoc,.hljs-id,.hljs-javadoctag,.hljs-keyword,.hljs-phpdoc,.hljs-request,.hljs-status,.hljs-title,.hljs-type,.hljs-typename,.hljs-winutils,.hljs-yardoctag,.markdown .hljs-strong,.smalltalk .hljs-class,.tex .hljs-command{font-weight:700}.asciidoc .hljs-emphasis,.markdown .hljs-emphasis{font-style:italic}.nginx .hljs-built_in{font-weight:400}.coffeescript .javascript,.javascript .xml,.lasso .markup,.tex .hljs-formula,.xml .css,.xml .hljs-cdata,.xml .javascript,.xml .vbscript{opacity:.5}.MathJax_Hover_Frame{border-radius:.25em;-webkit-border-radius:.25em;-moz-border-radius:.25em;-khtml-border-radius:.25em;box-shadow:0 0 15px #83A;-webkit-box-shadow:0 0 15px #83A;-moz-box-shadow:0 0 15px #83A;-khtml-box-shadow:0 0 15px #83A;border:1px solid #A6D!important;display:inline-block;position:absolute}.MathJax_Hover_Arrow{position:absolute;width:15px;height:11px;cursor:pointer}#MathJax_About{position:fixed;left:50%;width:auto;text-align:center;border:3px outset;padding:1em 2em;background-color:#DDD;color:#000;cursor:default;font-family:message-box;font-size:120%;font-style:normal;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;-khtml-border-radius:15px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_Menu{position:absolute;background-color:#fff;color:#000;width:auto;padding:5px 0;border:1px solid #CCC;margin:0;cursor:default;font:menu;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;-khtml-border-radius:5px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_MenuItem{padding:1px 2em;background:0 0}.MathJax_MenuArrow{position:absolute;right:.5em;color:#666}.MathJax_MenuActive .MathJax_MenuArrow{color:#fff}.MathJax_MenuArrow.RTL{left:.5em;right:auto}.MathJax_MenuCheck{position:absolute;left:.7em}.MathJax_MenuCheck.RTL{right:.7em;left:auto}.MathJax_MenuRadioCheck{position:absolute;left:.7em}.MathJax_MenuRadioCheck.RTL{right:.7em;left:auto}.MathJax_MenuLabel{padding:1px 2em 3px 1.33em;font-style:italic}.MathJax_MenuRule{border-top:1px solid #DDD;margin:4px 3px}.MathJax_MenuDisabled{color:GrayText}.MathJax_MenuActive{background-color:#606872;color:#fff}.MathJax_Menu_Close{position:absolute;width:31px;height:31px;top:-15px;left:-15px}#MathJax_Zoom{position:absolute;background-color:#F0F0F0;overflow:auto;display:block;z-index:301;padding:.5em;border:1px solid #000;margin:0;font-weight:400;font-style:normal;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;box-shadow:5px 5px 15px #AAA;-webkit-box-shadow:5px 5px 15px #AAA;-moz-box-shadow:5px 5px 15px #AAA;-khtml-box-shadow:5px 5px 15px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_ZoomOverlay{position:absolute;left:0;top:0;z-index:300;display:inline-block;width:100%;height:100%;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_ZoomFrame{position:relative;display:inline-block;height:0;width:0}#MathJax_ZoomEventTrap{position:absolute;left:0;top:0;z-index:302;display:inline-block;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}.MathJax_Preview{color:#888}#MathJax_Message{position:fixed;left:1px;bottom:2px;background-color:#E6E6E6;border:1px solid #959595;margin:0;padding:2px 8px;z-index:102;color:#000;font-size:80%;width:auto;white-space:nowrap}#MathJax_MSIE_Frame{position:absolute;top:0;left:0;width:0;z-index:101;border:0;margin:0;padding:0}.MathJax_Error{color:#C00;font-style:italic}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown github">
<h1 id="coding-interactive-charts"><a name="coding-interactive-charts" href="#coding-interactive-charts"></a>Coding interactive charts</h1><h3 id="the-data-we-will-use"><a name="the-data-we-will-use" href="#the-data-we-will-use"></a>The data we will use</h3><p>Download the data for this session from <a href="data/week12.zip">here</a>, unzip the folder and place it on your desktop. It contains the following folders and files:</p><ul>
<li><code>d3</code><ul>
<li><code>data</code> Folder with the files <code>brain_data.csv</code> and <code>brain_data2.csv</code>.</li><li><code>src</code> Folder with the <code>d3.min.js</code> source code.</li><li><code>shapes.html</code> Web page in which we will draw shapes using D3.</li></ul>
</li></ul><h3 id="introducing-d3"><a name="introducing-d3" href="#introducing-d3"></a>Introducing D3</h3><p>First we will explore how to code interactive, data-driven charts from scratch, using the <a href="http://d3js.org/">D3</a> JavaScript library.</p><p>There are several JavaScript libraries dedicated to making simple charts in standard formats: <a href="http://www.highcharts.com/">Highcharts</a>, <a href="http://raphaeljs.com/">Raphaël</a>, and <a href="http://dygraphs.com/">dygraphs</a> are good examples.</p><p>While we will only explore D3’s basic charting capabilities, it is a more flexible tool, and is behind many of the most impressive data visualizations in today’s digital media.</p><p>D3’s name derives from “Data-Driven Documents,” and it provides the means to bind data to elements of web pages and then manipulate those elements in a multitude of ways, based on attributes of the data (see the <a href="https://github.com/mbostock/d3/wiki/Gallery">D3 examples gallery</a> to get a flavor of the possibilities).</p><p>When building graphics with D3, those elements include scalable vector graphic (SVG) objects. SVG-based D3 graphics will display in modern browsers that support SVG rendering (see <a href="http://caniuse.com/#feat=svg">here</a> for a full breakdown), but not in Internet Explorer 8 or earlier. This was once a major restriction — however nowadays these browsers account for a only a tiny proportion of global usage.</p><h4 id="get-prepared:-data,-files-and-a-local-webserver"><a name="get-prepared:-data,-files-and-a-local-webserver" href="#get-prepared:-data,-files-and-a-local-webserver"></a>Get prepared: data, files and a local webserver</h4><p>Put the folder with this week’s data onto your desktop. Navigate to the D3 subfolder, and see that it, in turn, contains subfolders called <code>data</code> and <code>src</code>. The latter contains the code to run D3, in the file <code>d3.min.js</code>. This file was downloaded from <a href="https://github.com/mbostock/d3/releases/download/v3.5.6/d3.zip">here</a>. To use D3, your webpage must load this code. Alternatively, you can link directly to the latest release of D3, by inserting this code into the head of your web page:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>&amp;lt;script src=&quot;http://d3js.org/d3.v3.min.js&quot; charset=&quot;utf-8&quot;&amp;gt;&amp;lt;/script&amp;gt;
</code></pre>">&lt;script src="http://d3js.org/d3.v3.min.js" charset="utf-8"&gt;&lt;/script&gt;
</code></pre><p>D3 visualizations may not display in your browser when the page is opened locally, due to security restrictions, but we can easily set up a local webserver. To do that, open a Terminal window (<code>Applications&gt;Utilities&gt;Terminal</code>) and navigate to your downloaded folder by typing <code>cd Desktop/week12/d3</code> and hitting <code>return</code>. Then type <code>python -m SimpleHTTPServer 8000</code> and again hit return.</p><p>Now open your browser, and go to the url: <code>http://127.0.0.1:8000/</code>. You should see the following:</p><p><img src="img/class12_1.jpg" alt=""></p><p>Click the <code>shapes.html</code> link and you will see an empty web page.</p><h4 id="first-steps:-draw-simple-svg-shapes-with-d3"><a name="first-steps:-draw-simple-svg-shapes-with-d3" href="#first-steps:-draw-simple-svg-shapes-with-d3"></a>First steps: draw simple SVG shapes with D3</h4><p>To learn the basics of D3, we will first use the library to draw some simple SVG shapes on the <code>shapes.html</code> page. Open that file in your text editor (I recommend <a href="http://www.sublimetext.com/2">Sublime Text</a>), and you should see the following HTML code:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;

&amp;lt;head&amp;gt;

  &amp;lt;meta charset=utf-8 /&amp;gt;
  &amp;lt;title&amp;gt;Shapes&amp;lt;/title&amp;gt;
  &amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&amp;gt;

  &amp;lt;script src=&quot;http://d3js.org/d3.v3.min.js&quot; charset=&quot;utf-8&quot;&amp;gt;&amp;lt;/script&amp;gt;

&amp;lt;!-- 
  &amp;lt;script src=&quot;src/d3.min.js&quot; charset=&quot;utf-8&quot;&amp;gt;&amp;lt;/script&amp;gt;
 --&amp;gt;

&amp;lt;/head&amp;gt;

&amp;lt;body&amp;gt;


&amp;lt;/body&amp;gt;
</code></pre>">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;

  &lt;meta charset=utf-8 /&gt;
  &lt;title&gt;Shapes&lt;/title&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" /&gt;

  &lt;script src="http://d3js.org/d3.v3.min.js" charset="utf-8"&gt;&lt;/script&gt;

&lt;!-- 
  &lt;script src="src/d3.min.js" charset="utf-8"&gt;&lt;/script&gt;
 --&gt;

&lt;/head&gt;

&lt;body&gt;


&lt;/body&gt;
</code></pre><p>Notice that the head of the webpage links to the latest release of D3. It also includes a commented-out link to the local copy. You should use one or other of these links, commenting out the other.</p><p>We are going to use D3 to draw specific shapes into divs on this page, so we will first create those divs, by entering this code into the body of the web page, between the <code>&lt;body&gt;</code> and <code>&lt;/body&gt;</code> tags:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>    &amp;lt;div id=&quot;circleDiv&quot;&amp;gt;
    &amp;lt;/div&amp;gt;

    &amp;lt;div id=&quot;rectangleDiv&quot;&amp;gt;
    &amp;lt;/div&amp;gt;

    &amp;lt;div id=&quot;lineDiv&quot;&amp;gt;
    &amp;lt;/div&amp;gt;
</code></pre>">    &lt;div id="circleDiv"&gt;
    &lt;/div&gt;

    &lt;div id="rectangleDiv"&gt;
    &lt;/div&gt;

    &lt;div id="lineDiv"&gt;
    &lt;/div&gt;
</code></pre><p>Now, immediately above the closing <code>&lt;/body&gt;</code> tag, enter the following:</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>    &amp;lt;script&amp;gt;

        d3.select(&quot;#circleDiv&quot;)
            .append(&quot;svg&quot;)
            .attr(&quot;width&quot;, 500)
            .attr(&quot;height&quot;, 500)
            .append(&quot;circle&quot;)
            .attr(&quot;cx&quot;, 250)
            .attr(&quot;cy&quot;, 350)
            .attr(&quot;r&quot;, 120)
            .style(&quot;fill&quot;, &quot;blue&quot;)
            .style(&quot;stroke&quot;, &quot;red&quot;)
            .style(&quot;stroke-width&quot;, 20)
            .style(&quot;fill-opacity&quot;, 0.5)
            .style(&quot;stroke-opacity&quot;, 0.3);

    &amp;lt;/script&amp;gt;
</code></pre>">    &lt;script&gt;

        d3.select(<span class="hljs-string">"#circleDiv"</span>)
            .append(<span class="hljs-string">"svg"</span>)
            .attr(<span class="hljs-string">"width"</span>, <span class="hljs-number">500</span>)
            .attr(<span class="hljs-string">"height"</span>, <span class="hljs-number">500</span>)
            .append(<span class="hljs-string">"circle"</span>)
            .attr(<span class="hljs-string">"cx"</span>, <span class="hljs-number">250</span>)
            .attr(<span class="hljs-string">"cy"</span>, <span class="hljs-number">350</span>)
            .attr(<span class="hljs-string">"r"</span>, <span class="hljs-number">120</span>)
            .style(<span class="hljs-string">"fill"</span>, <span class="hljs-string">"blue"</span>)
            .style(<span class="hljs-string">"stroke"</span>, <span class="hljs-string">"red"</span>)
            .style(<span class="hljs-string">"stroke-width"</span>, <span class="hljs-number">20</span>)
            .style(<span class="hljs-string">"fill-opacity"</span>, <span class="hljs-number">0.5</span>)
            .style(<span class="hljs-string">"stroke-opacity"</span>, <span class="hljs-number">0.3</span>);

    <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</span></code></pre><p>Save <code>shapes.html</code>, then refresh your browser, and this is what you should see:</p><p><img src="img/class12_2.jpg" alt=""></p><p>Let’s break this code down to understand what is going on. The first line, <code>d3.select("#circleDiv")</code> selects the element that D3 is going to work on, in this case the div with the id <code>circleDiv</code>. D3 uses CSS to make selections, so you can select elements in various ways, including by their tags (e.g. <code>div</code> or <code>p</code>), their ids, or their classes. As when styling using CSS, ids are preceded by <code>#</code>, while classes are preceded by a period. So if we had given the div a class of <code>circleDiv</code>, rather than using a unique id, the selection would be written: <code>d3.select(".circleDiv")</code>. See <a href="https://github.com/mbostock/d3/wiki/Selections">here</a> for more on D3 selections.</p><p>The subsequent code instructs D3 what to do with the selected element. It first appends an SVG element, which has two attributes, “width” and “height,” both 500 pixels. This is always the first step when using D3 to manipulate SVG objects, which will be drawn within this element.</p><p>A circle is then appended to this SVG element, which is given a series of attributes and styles: <code>cx</code> and <code>cy</code> define the position of the center of the circle, measured in pixels from the left and top of the SVG element, respectively; <code>r</code> is the radius of the circle, in pixels; <code>fill</code> and <code>stroke</code> control the color of the circle and its outline respectively. When styling SVG, colors can be assigned using the <a href="http://www.w3schools.com/html/html_colornames.asp">HTML names listed here</a>, or by using HEX or RGB codes.</p><p>Try experimenting with altering the attributes and styling of the circle, saving the <code>shapes.html</code> file and refreshing your browser to review the results.</p><p>Now add the following code before the closing <code>&lt;/script&gt;</code> tag:</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>        d3.select(&quot;#rectangleDiv&quot;)
            .append(&quot;svg&quot;)
            .attr(&quot;width&quot;, 500)
            .attr(&quot;height&quot;, 500)
            .append(&quot;rect&quot;)
            .attr(&quot;x&quot;, 160)
            .attr(&quot;y&quot;, 300)
            .attr(&quot;width&quot;, 200)
            .attr(&quot;height&quot;, 120)
            .style(&quot;fill&quot;, &quot;yellow&quot;)
            .style(&quot;stroke&quot;, &quot;green&quot;)
            .style(&quot;stroke-width&quot;, 20)
            .style(&quot;fill-opacity&quot;, 0.5)
            .style(&quot;stroke-opacity&quot;, 0.5);

       d3.select(&quot;#lineDiv&quot;)
            .append(&quot;svg&quot;)
            .attr(&quot;width&quot;, 500)
            .attr(&quot;height&quot;, 500)
            .append(&quot;line&quot;)
            .attr(&quot;x1&quot;, 160)
            .attr(&quot;y1&quot;, 300)
            .attr(&quot;x2&quot;, 360)
            .attr(&quot;y2&quot;, 450)
            .style(&quot;stroke&quot;, &quot;black&quot;)
            .style(&quot;stroke-width&quot;, 2)
            .style(&quot;stroke-opacity&quot;, 0.5);
</code></pre>">        d3.select(<span class="hljs-string">"#rectangleDiv"</span>)
            .append(<span class="hljs-string">"svg"</span>)
            .attr(<span class="hljs-string">"width"</span>, <span class="hljs-number">500</span>)
            .attr(<span class="hljs-string">"height"</span>, <span class="hljs-number">500</span>)
            .append(<span class="hljs-string">"rect"</span>)
            .attr(<span class="hljs-string">"x"</span>, <span class="hljs-number">160</span>)
            .attr(<span class="hljs-string">"y"</span>, <span class="hljs-number">300</span>)
            .attr(<span class="hljs-string">"width"</span>, <span class="hljs-number">200</span>)
            .attr(<span class="hljs-string">"height"</span>, <span class="hljs-number">120</span>)
            .style(<span class="hljs-string">"fill"</span>, <span class="hljs-string">"yellow"</span>)
            .style(<span class="hljs-string">"stroke"</span>, <span class="hljs-string">"green"</span>)
            .style(<span class="hljs-string">"stroke-width"</span>, <span class="hljs-number">20</span>)
            .style(<span class="hljs-string">"fill-opacity"</span>, <span class="hljs-number">0.5</span>)
            .style(<span class="hljs-string">"stroke-opacity"</span>, <span class="hljs-number">0.5</span>);

       d3.select(<span class="hljs-string">"#lineDiv"</span>)
            .append(<span class="hljs-string">"svg"</span>)
            .attr(<span class="hljs-string">"width"</span>, <span class="hljs-number">500</span>)
            .attr(<span class="hljs-string">"height"</span>, <span class="hljs-number">500</span>)
            .append(<span class="hljs-string">"line"</span>)
            .attr(<span class="hljs-string">"x1"</span>, <span class="hljs-number">160</span>)
            .attr(<span class="hljs-string">"y1"</span>, <span class="hljs-number">300</span>)
            .attr(<span class="hljs-string">"x2"</span>, <span class="hljs-number">360</span>)
            .attr(<span class="hljs-string">"y2"</span>, <span class="hljs-number">450</span>)
            .style(<span class="hljs-string">"stroke"</span>, <span class="hljs-string">"black"</span>)
            .style(<span class="hljs-string">"stroke-width"</span>, <span class="hljs-number">2</span>)
            .style(<span class="hljs-string">"stroke-opacity"</span>, <span class="hljs-number">0.5</span>);
</code></pre><p>Save the <code>shapes.html</code> file, refresh your browser, and the following two shapes should now appear beneath the original circle:</p><p><img src="img/class12_3.jpg" alt=""></p><p>Note that for SVG rectangles, the attributes <code>x</code> and <code>y</code> refer to the position of the top left hand corner, and are measured from left and top of the SVG element in pixels, as before. Lines are given both starting (<code>x1</code>, <code>y1</code>) and ending (<code>x2</code>, <code>y2</code>) coordinates, measured in the same way. For more on SVG attributes and styling, see <a href="http://alignedleft.com/tutorials/d3/an-svg-primer">this tutorial</a> from Scott Murray, author of an excellent introduction to visualizing data with D3, included in the further reading links below.</p><p>Experiment with altering the attributes and styling of the rectangle and line, as you did for the circle, then save and close the <code>shapes.html</code> file.</p><h4 id="make-a-simple-bar-chart"><a name="make-a-simple-bar-chart" href="#make-a-simple-bar-chart"></a>Make a simple bar chart</h4><p>Now we are going to create a simple bar chart based on some data loaded from an external file. Open a new text document, then paste into it the code below:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;

&amp;lt;head&amp;gt;

    &amp;lt;meta charset=utf-8 /&amp;gt;
    &amp;lt;title&amp;gt;Bar chart&amp;lt;/title&amp;gt;
    &amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&amp;gt;

    &amp;lt;script src=&quot;http://d3js.org/d3.v3.min.js&quot; charset=&quot;utf-8&quot;&amp;gt;&amp;lt;/script&amp;gt;

    &amp;lt;!-- &amp;lt;script src=&quot;src/d3.min.js&quot; charset=&quot;utf-8&quot;&amp;gt;&amp;lt;/script&amp;gt; --&amp;gt;

    &amp;lt;style&amp;gt;


    &amp;lt;/style&amp;gt;

&amp;lt;/head&amp;gt;

&amp;lt;body&amp;gt;

    &amp;lt;div class=&quot;container&quot;&amp;gt;

        &amp;lt;svg class=&quot;chart&quot;&amp;gt;&amp;lt;/svg&amp;gt;

    &amp;lt;/div&amp;gt;

     &amp;lt;script&amp;gt;

     &amp;lt;/script&amp;gt;

&amp;lt;/body&amp;gt;

&amp;lt;/html&amp;gt;
</code></pre>">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;

    &lt;meta charset=utf-8 /&gt;
    &lt;title&gt;Bar chart&lt;/title&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" /&gt;

    &lt;script src="http://d3js.org/d3.v3.min.js" charset="utf-8"&gt;&lt;/script&gt;

    &lt;!-- &lt;script src="src/d3.min.js" charset="utf-8"&gt;&lt;/script&gt; --&gt;

    &lt;style&gt;


    &lt;/style&gt;

&lt;/head&gt;

&lt;body&gt;

    &lt;div class="container"&gt;

        &lt;svg class="chart"&gt;&lt;/svg&gt;

    &lt;/div&gt;

     &lt;script&gt;

     &lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;
</code></pre><p>Save this page in the <code>d3</code> subfolder as <code>index.html</code>. Notice that the head of this page loads D3, while the body contains a div with the id <code>container</code>, which in turn contains an empty SVG element with the class <code>chart</code>. This is where we are going to draw the bar chart. There is also an empty script, which is where we will write our D3 code.</p><p>The page head also contains <code>&lt;style&gt; &lt;/style&gt;</code> tags, between which we will later add CSS styling to the page.</p><p>The chart we will make is based on <a href="http://mosaicscience.com/extra/does-brain-size-matter">this interactive graphic</a>, showing how various animals compare on different measures of their brains.</p><p><img src="img/class12_4.jpg" alt=""></p><p>(Source: <a href="http://mosaicscience.com/extra/does-brain-size-matter">Mosaic</a>)</p><p>In the first instance, we will draw a static version of the chart showing the animals’ brain sizes, in grams.</p><p>Before we start, let’s look at the data we will load, which is in the file <code>brain_data.csv</code> in the <code>data</code> subfolder. This is what it looks like, opened in a spreadsheet:</p><p><img src="img/class12_5.jpg" alt=""></p><p>There are three variables, <code>species</code>, <code>measure</code>, which in this simple version of the data has only one category, and the <code>value</code> for that measure.</p><p>Now copy the following text between the <code>&lt;script&gt; &lt;/script&gt;</code> tags for the page:</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>     // set width, height, and margins for chart
     var w = 700;
     var h = 400;

    var margin = {top: 20, right: 40, bottom: 30, left: 100},
        width = w - margin.left - margin.right,
        height = h - margin.top - margin.bottom;

    // create chart object with those dimensions
    var chart = d3.select(&quot;.chart&quot;)
        .attr(&quot;width&quot;, width + margin.left + margin.right)
        .attr(&quot;height&quot;, height + margin.top + margin.bottom)
        .append(&quot;g&quot;)
        .attr(&quot;transform&quot;, &quot;translate(&quot; + margin.left + &quot;,&quot; + margin.top + &quot;)&quot;);

    // set scales for X and Y axes
    var x = d3.scale.linear()
        .range([0, width]);

    var y = d3.scale.ordinal()
        .rangeRoundBands([height, 0], 0.3);

    // load the data from CSV file    
    d3.csv(&quot;data/brain_data.csv&quot;, type, function(error, data) {
        x.domain([0, d3.max(data, function(d) { return (d.value); })]);
        y.domain(data.map(function(d) { return d.species; }));

    // draw the bars    
    chart.selectAll(&quot;.bar&quot;)
            .data(data)
            .enter().append(&quot;rect&quot;)
            .attr(&quot;height&quot;, y.rangeBand())
            .attr(&quot;y&quot;, function(d) { return y(d.species); })
            .attr(&quot;width&quot;, function(d) { return x(d.value); })
            .attr(&quot;class&quot;, &quot;bar&quot;);    
    });

    // make sure value variable is treated as a number
    function type(d) {
        d.value = +d.value;
        return d;
    }
</code></pre>">     <span class="hljs-comment">// set width, height, and margins for chart</span>
     <span class="hljs-keyword">var</span> w = <span class="hljs-number">700</span>;
     <span class="hljs-keyword">var</span> h = <span class="hljs-number">400</span>;

    <span class="hljs-keyword">var</span> margin = {top: <span class="hljs-number">20</span>, right: <span class="hljs-number">40</span>, bottom: <span class="hljs-number">30</span>, left: <span class="hljs-number">100</span>},
        width = w - margin.left - margin.right,
        height = h - margin.top - margin.bottom;

    <span class="hljs-comment">// create chart object with those dimensions</span>
    <span class="hljs-keyword">var</span> chart = d3.select(<span class="hljs-string">".chart"</span>)
        .attr(<span class="hljs-string">"width"</span>, width + margin.left + margin.right)
        .attr(<span class="hljs-string">"height"</span>, height + margin.top + margin.bottom)
        .append(<span class="hljs-string">"g"</span>)
        .attr(<span class="hljs-string">"transform"</span>, <span class="hljs-string">"translate("</span> + margin.left + <span class="hljs-string">","</span> + margin.top + <span class="hljs-string">")"</span>);

    <span class="hljs-comment">// set scales for X and Y axes</span>
    <span class="hljs-keyword">var</span> x = d3.scale.linear()
        .range([<span class="hljs-number">0</span>, width]);

    <span class="hljs-keyword">var</span> y = d3.scale.ordinal()
        .rangeRoundBands([height, <span class="hljs-number">0</span>], <span class="hljs-number">0.3</span>);

    <span class="hljs-comment">// load the data from CSV file    </span>
    d3.csv(<span class="hljs-string">"data/brain_data.csv"</span>, type, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error, data)</span> </span>{
        x.domain([<span class="hljs-number">0</span>, d3.max(data, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> (d.value); })]);
        y.domain(data.map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> d.species; }));

    <span class="hljs-comment">// draw the bars    </span>
    chart.selectAll(<span class="hljs-string">".bar"</span>)
            .data(data)
            .enter().append(<span class="hljs-string">"rect"</span>)
            .attr(<span class="hljs-string">"height"</span>, y.rangeBand())
            .attr(<span class="hljs-string">"y"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> y(d.species); })
            .attr(<span class="hljs-string">"width"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> x(d.value); })
            .attr(<span class="hljs-string">"class"</span>, <span class="hljs-string">"bar"</span>);    
    });

    <span class="hljs-comment">// make sure value variable is treated as a number</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">type</span><span class="hljs-params">(d)</span> </span>{
        d.value = +d.value;
        <span class="hljs-keyword">return</span> d;
    }
</code></pre><p>Save <code>index.html</code> and open it in your browser. If necessary use the local webserver, navigating to <code>http://127.0.0.1:8000/</code>. You should see the following bar chart, minus axes, labelling, and styling:</p><p><img src="img/class12_6.jpg" alt=""></p><p>We needed to write all of the code above to create this very basic chart, so now let’s break it down piece by piece, to understand how it works.</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>     // set width, height, and margins for chart
     var w = 700;
     var h = 400;

    var margin = {top: 20, right: 40, bottom: 30, left: 100},
        width = w - margin.left - margin.right,
        height = h - margin.top - margin.bottom;
</code></pre>">     <span class="hljs-comment">// set width, height, and margins for chart</span>
     <span class="hljs-keyword">var</span> w = <span class="hljs-number">700</span>;
     <span class="hljs-keyword">var</span> h = <span class="hljs-number">400</span>;

    <span class="hljs-keyword">var</span> margin = {top: <span class="hljs-number">20</span>, right: <span class="hljs-number">40</span>, bottom: <span class="hljs-number">30</span>, left: <span class="hljs-number">100</span>},
        width = w - margin.left - margin.right,
        height = h - margin.top - margin.bottom;
</code></pre><p>This code sets the dimensions for the chart area, defining its height, width, and margins, measured in pixels. (The wide left margin is to accommodate the species names, when we later draw the chart axes.)</p><p>So far, this is pure JavaScript, not specific to D3.</p><p>The next chunk of code creates an object called <code>chart</code> in the SVG element of the same name, using <code>d3.select</code>. It then gives this object dimensions defined by the first chunk of code.</p><p>You may be wondering what <code>g</code> refers to. It is a “grouping” element, used to group together multiple SVG elements, see <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/g">here</a>.</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>    // create chart object with those dimensions
    var chart = d3.select(&quot;.chart&quot;)
        .attr(&quot;width&quot;, width + margin.left + margin.right)
        .attr(&quot;height&quot;, height + margin.top + margin.bottom)
        .append(&quot;g&quot;)
        .attr(&quot;transform&quot;, &quot;translate(&quot; + margin.left + &quot;,&quot; + margin.top + &quot;)&quot;);
</code></pre>">    <span class="hljs-comment">// create chart object with those dimensions</span>
    <span class="hljs-keyword">var</span> chart = d3.select(<span class="hljs-string">".chart"</span>)
        .attr(<span class="hljs-string">"width"</span>, width + margin.left + margin.right)
        .attr(<span class="hljs-string">"height"</span>, height + margin.top + margin.bottom)
        .append(<span class="hljs-string">"g"</span>)
        .attr(<span class="hljs-string">"transform"</span>, <span class="hljs-string">"translate("</span> + margin.left + <span class="hljs-string">","</span> + margin.top + <span class="hljs-string">")"</span>);
</code></pre><p>The next chunk of code sets the scale for the X and Y axes of our chart.</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>    // set scales for X and Y axes
    var x = d3.scale.linear()
        .range([0, width]);

    var y = d3.scale.ordinal()
        .rangeRoundBands([height, 0], 0.3);
</code></pre>">    <span class="hljs-comment">// set scales for X and Y axes</span>
    <span class="hljs-keyword">var</span> x = d3.scale.linear()
        .range([<span class="hljs-number">0</span>, width]);

    <span class="hljs-keyword">var</span> y = d3.scale.ordinal()
        .rangeRoundBands([height, <span class="hljs-number">0</span>], <span class="hljs-number">0.3</span>);
</code></pre><p>Scales are central to how D3 works. Here we are using a <code>linear</code> scale for the X axis, which will display the <code>value</code> data, which is a continuous variable. We are giving that a <code>range</code> that runs from zero to the <code>width</code> we created earlier.</p><p>The different animal <code>species</code> will be displayed on the Y axis. <code>species</code> is a categorical variable, and for that we need an <code>ordinal</code> scale.</p><p><code>rangeRoundBands</code> is used with ordinal scales to assign portions of the scale to each categorical variable. See what happens if you replace <code>[height, 0]</code> with <code>[0, height]</code>. The bars should draw in the opposite order, as the scale is reversed.</p><p>The next number, here <code>0.3</code>, sets the padding or space between the bars. This number can vary between zero (for no padding) and 1 (the padding fills the entire space allowed for each bar, removing them from view). Experiment with changing this number and see what happens.</p><p>For more on how D3 scales work, follow the links from <a href="https://github.com/mbostock/d3/wiki/Scales">here</a>.</p><p>This section of code loads the data:</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>    d3.csv(&quot;data/brain_data.csv&quot;, type, function(error, data) {
        x.domain([0, d3.max(data, function(d) { return d.value; })]);
        y.domain(data.map(function(d) { return d.species; }));

   });
</code></pre>">    d3.csv(<span class="hljs-string">"data/brain_data.csv"</span>, type, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error, data)</span> </span>{
        x.domain([<span class="hljs-number">0</span>, d3.max(data, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> d.value; })]);
        y.domain(data.map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> d.species; }));

   });
</code></pre><p><code>d3.csv</code>loads data from a CSV file. You can also load JSON data using <code>d3.json</code>. For more on loading data from files in common formats, see <a href="http://learnjsdata.com/read_data.html">here</a>.</p><p>In addition to having a <code>range</code>, D3 scales have a <code>domain</code>, drawn from the range of values in the data being used, which is mapped onto the <code>range</code>. Here the <code>species</code> data is mapped onto the Y axis, and the <code>value</code> data onto the X axis. For the X axis, the values are set to run from zero to <code>d3.max</code>, or the largest value in the data.</p><p>Values in the data are held in an object called <code>d</code>. They are accessed using JavaScript <a href="http://www.w3schools.com/js/js_functions.asp">functions</a> of this format:</p><pre class="javascript hljs"><code class="JavaScript" data-origin="<pre><code class=&quot;JavaScript&quot;>function(d) { return d.something; })
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> d.something; })
</code></pre><p>Notice that these functions are wrapped in another function that creates an object called <code>data</code>, which we will next bind to elements on the page.</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>function(error, data) {
    *some code goes here*
})
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error, data)</span> </span>{
    *some code goes here*
})
</code></pre><p>The following section of code actually draws the bars. It is wrapped within the function that loads the data, so should be inserted before the final <code>});</code> from that code:</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>    // draw the bars    
    chart.selectAll(&quot;.bar&quot;)
            .data(data)
            .enter()
            .append(&quot;rect&quot;)
            .attr(&quot;height&quot;, y.rangeBand())
            .attr(&quot;y&quot;, function(d) { return y(d.species); })
            .attr(&quot;width&quot;, function(d) { return x(d.value); })
            .attr(&quot;class&quot;, &quot;bar&quot;);
</code></pre>">    <span class="hljs-comment">// draw the bars    </span>
    chart.selectAll(<span class="hljs-string">".bar"</span>)
            .data(data)
            .enter()
            .append(<span class="hljs-string">"rect"</span>)
            .attr(<span class="hljs-string">"height"</span>, y.rangeBand())
            .attr(<span class="hljs-string">"y"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> y(d.species); })
            .attr(<span class="hljs-string">"width"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> x(d.value); })
            .attr(<span class="hljs-string">"class"</span>, <span class="hljs-string">"bar"</span>);
</code></pre><p>This code is where the D3 magic of binding data to elements drawn on the page takes place.</p><p>Here, within the SVG <code>chart</code> element, we are selecting all elements with the class <code>bar</code> using <code>selectAll(".bar")</code> That seems odd because we haven’t yet created any elements with the class <code>bar</code>. But they are created, according to values in the data, from the subsequent code.</p><p>First, <code>.data(data)</code> binds these still-to-be-created elements to the data we just loaded; <code>.enter()</code> means that this happens for all of the rectangles that are about to enter the page when created by <code>.append("rect")</code>.</p><p>As D3’s inventor Mike Bostock explains <a href="http://bost.ocks.org/mike/circles/">here</a>, the <code>selectAll</code>, <code>data</code>, <code>enter</code>, <code>append</code> sequence is a common pattern in D3 code.</p><p>(While we will not do this, that link also explains the use of <code>exit</code> and <code>remove</code> for elements that are leaving the page.)</p><p>The rest of the code gives attributes to the rectangles. First, their height is set by <code>rangeBand</code>, which simply gives them all the same height, working with the <code>rangeRoundBands</code> code we used earlier. Their position on the Y axis is defined by the <code>species</code> data, and the width of the bars is set according to the <code>value</code> data.</p><p>Finally, the rectangles are all given the class of <code>bar</code>, which applies <code>selectAll</code> to each of them and draws the chart.</p><p>Because the rectangles all have the same class, we can now style them with some simple CSS. Add this code between the <code>&lt;style&gt; &lt;/style&gt;</code> tags:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>        /*style the bars with fill color and opacity*/
        .bar {
           fill: #888888;
           opacity: 0.7;
        }

        /*change opacity on hover*/
        .bar:hover {
            opacity: 1;
        }
</code></pre>">        <span class="hljs-comment">/*style the bars with fill color and opacity*/</span>
        <span class="hljs-class">.bar</span> <span class="hljs-rules">{
           <span class="hljs-rule"><span class="hljs-attribute">fill</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#888888</span></span></span>;
           <span class="hljs-rule"><span class="hljs-attribute">opacity</span>:<span class="hljs-value"> <span class="hljs-number">0.7</span></span></span>;
        <span class="hljs-rule">}</span></span>

        <span class="hljs-comment">/*change opacity on hover*/</span>
        <span class="hljs-class">.bar</span><span class="hljs-pseudo">:hover</span> <span class="hljs-rules">{
            <span class="hljs-rule"><span class="hljs-attribute">opacity</span>:<span class="hljs-value"> <span class="hljs-number">1</span></span></span>;
        <span class="hljs-rule">}</span></span>
</code></pre><p>This gives the bars a gray color and 70% opacity, which changes to 100% when they are hovered over.</p><h4 id="add-axes"><a name="add-axes" href="#add-axes"></a>Add axes</h4><p>This chart has represented the data using the visual encoding of length on an aligned scale. But without axes and labelling, we don’t know what we are looking at.</p><p>D3 has built-in axis objects, so these don’t have to be drawn from scratch. To create axes for the chart, paste the following code beneath the section of code setting the scales for the chart’s X and Y axes:</p><pre class="javascript hljs"><code class="JavaScript" data-origin="<pre><code class=&quot;JavaScript&quot;>    // create axes
    var xAxis = d3.svg.axis()
        .scale(x)
        .orient(&quot;top&quot;)
        .ticks(4);

    var yAxis = d3.svg.axis()
        .scale(y)
        .orient(&quot;left&quot;);
</code></pre>">    <span class="hljs-comment">// create axes</span>
    <span class="hljs-keyword">var</span> xAxis = d3.svg.axis()
        .scale(x)
        .orient(<span class="hljs-string">"top"</span>)
        .ticks(<span class="hljs-number">4</span>);

    <span class="hljs-keyword">var</span> yAxis = d3.svg.axis()
        .scale(y)
        .orient(<span class="hljs-string">"left"</span>);
</code></pre><p>Having created the axis objects, now we need to add them to the chart. To to this, add the following code inside the function that loads the data, immediately beneath the section of code that drew the bars:</p><pre class="javascript hljs"><code class="JavaScript" data-origin="<pre><code class=&quot;JavaScript&quot;>    // add axes 
    chart.append(&quot;g&quot;)
        .attr(&quot;class&quot;, &quot;x axis&quot;)
        .call(xAxis);

    chart.append(&quot;g&quot;)
        .attr(&quot;class&quot;, &quot;y axis&quot;)
        .call(yAxis);
</code></pre>">    <span class="hljs-comment">// add axes </span>
    chart.append(<span class="hljs-string">"g"</span>)
        .attr(<span class="hljs-string">"class"</span>, <span class="hljs-string">"x axis"</span>)
        .call(xAxis);

    chart.append(<span class="hljs-string">"g"</span>)
        .attr(<span class="hljs-string">"class"</span>, <span class="hljs-string">"y axis"</span>)
        .call(yAxis);
</code></pre><p>Notice how the code that created the axes uses the <code>x</code> and <code>y</code> scales we made earlier; <code>orient</code> positions the axes, while <code>ticks</code> can be used to suggest a number of tick marks. This is a suggestion, rather than a literal instruction. If you experiment with different numbers, you will find that D3 uses the nearest number of ticks that divides up the data in a “sensible” way.</p><p>The code that added the axes to the chart appends them to the <code>g</code> element we discussed earlier, which groups together all of the elements that the chart is made up from.</p><p>The chart should now look like this:</p><p><img src="img/class12_7.jpg" alt=""></p><p>While we have axes, they are exceptionally ugly ones. The text of one of the labels also doesn’t fit within the margin to the left of the chart. We can fix all of this with some simple CSS, by adding the following code between the <code>&lt;style&gt; &lt;/style&gt;</code> tags:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>        /*style axes*/
        .axis path,
        .axis line {
           fill: none;
           stroke: #ccc;
           shape-rendering: crispEdges;
        }

        /*set font style and size for axes*/
        .x.axis text {
           font: 10px sans-serif;
        }
</code></pre>">        <span class="hljs-comment">/*style axes*/</span>
        <span class="hljs-class">.axis</span> <span class="hljs-tag">path</span>,
        <span class="hljs-class">.axis</span> <span class="hljs-tag">line</span> <span class="hljs-rules">{
           <span class="hljs-rule"><span class="hljs-attribute">fill</span>:<span class="hljs-value"> none</span></span>;
           <span class="hljs-rule"><span class="hljs-attribute">stroke</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#ccc</span></span></span>;
           <span class="hljs-rule"><span class="hljs-attribute">shape-rendering</span>:<span class="hljs-value"> crispEdges</span></span>;
        <span class="hljs-rule">}</span></span>

        <span class="hljs-comment">/*set font style and size for axes*/</span>
        <span class="hljs-class">.x</span><span class="hljs-class">.axis</span> <span class="hljs-tag">text</span> <span class="hljs-rules">{
           <span class="hljs-rule"><span class="hljs-attribute">font</span>:<span class="hljs-value"> <span class="hljs-number">10px</span> sans-serif</span></span>;
        <span class="hljs-rule">}</span></span>
</code></pre><p>This should be the result:</p><p><img src="img/class12_8.jpg" alt=""></p><p>Thinking about the goal of avoiding chart junk, the Y axis and tick marks are not really necessary, so remove them by adding the following CSS code between the <code>&lt;style&gt; &lt;/style&gt;</code> tags:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>        /*remove y axis line and tick marks*/
        .y.axis path,
        .y.axis line {
           display: none;
        }
</code></pre>">        <span class="hljs-comment">/*remove y axis line and tick marks*/</span>
        <span class="hljs-class">.y</span><span class="hljs-class">.axis</span> <span class="hljs-tag">path</span>,
        <span class="hljs-class">.y</span><span class="hljs-class">.axis</span> <span class="hljs-tag">line</span> <span class="hljs-rules">{
           <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> none</span></span>;
        <span class="hljs-rule">}</span></span>
</code></pre><p>The chart should now look like this:</p><p><img src="img/class12_9.jpg" alt=""></p><p>See <a href="http://alignedleft.com/tutorials/d3/axes">Scott Murray’s tutorial</a> for more on D3 axes.</p><h4 id="load-the-full-data,-and-switch-between-measures"><a name="load-the-full-data,-and-switch-between-measures" href="#load-the-full-data,-and-switch-between-measures"></a>Load the full data, and switch between measures</h4><p>Now we will make the chart fully interactive, by loading the full dataset, and setting up a control to switch between different measures in the data. The full data is the file <code>brain_data2.csv</code> in the <code>data</code> subfolder. This is what it looks like, opened in a spreadsheet:</p><p><img src="img/class12_10.jpg" alt=""></p><p>First change the name of the file loaded in the script to <code>brain_data2.csv</code>, then comment out the section of the code that loads the bars, and beneath it add the following code:</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>    // draw the bars using brain_data2.csv
        chart.selectAll(&quot;.bar&quot;)
            .data(data.filter(function (d) { return d.measure==&quot;Brain size (g)&quot;; })) //filter to initially display data for brain size
            .enter().append(&quot;rect&quot;)
            .attr(&quot;class&quot;, &quot;bar&quot;)
            .attr(&quot;y&quot;, function(d) { return y(d.species); })
            .attr(&quot;width&quot;, function(d) { return x(d.value); })
            .attr(&quot;height&quot;, y.rangeBand());
</code></pre>">    <span class="hljs-comment">// draw the bars using brain_data2.csv</span>
        chart.selectAll(<span class="hljs-string">".bar"</span>)
            .data(data.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> d.measure==<span class="hljs-string">"Brain size (g)"</span>; })) <span class="hljs-comment">//filter to initially display data for brain size</span>
            .enter().append(<span class="hljs-string">"rect"</span>)
            .attr(<span class="hljs-string">"class"</span>, <span class="hljs-string">"bar"</span>)
            .attr(<span class="hljs-string">"y"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> y(d.species); })
            .attr(<span class="hljs-string">"width"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> x(d.value); })
            .attr(<span class="hljs-string">"height"</span>, y.rangeBand());
</code></pre><p>All that has changed is the line of code that binds the data to the bars:</p><pre class="javascript hljs"><code class="JavaScript" data-origin="<pre><code class=&quot;JavaScript&quot;>            .data(data.filter(function (d) { return d.measure==&quot;Brain size (g)&quot;; })) //filter to initially display data for brain size
</code></pre>">            .data(data.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> d.measure==<span class="hljs-string">"Brain size (g)"</span>; })) <span class="hljs-comment">//filter to initially display data for brain size</span>
</code></pre><p>It now includes a function to filter the data, so that only one measure is shown. As this is the same measure displayed previously, the chart will appear as before.</p><p>Now add the following code to the html, immediately below <code>&lt;div class="container"&gt;</code>:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>        &amp;lt;div class=&quot;control&quot;&amp;gt;
         &amp;lt;p&amp;gt;&amp;lt;strong&amp;gt;Measure:&amp;lt;/strong&amp;gt;    
            &amp;lt;select id=&quot;measures&quot;&amp;gt;
                &amp;lt;option value=&quot;Brain size (g)&quot;&amp;gt;Brain size (g)&amp;lt;/option&amp;gt;
                &amp;lt;option value=&quot;Relative brain size (% of body mass)&quot;&amp;gt;Relative brain size (% body mass)&amp;lt;/option&amp;gt;
                &amp;lt;option value=&quot;Encephalisation Quotient&quot;&amp;gt;Encephalisation Quotient&amp;lt;/option&amp;gt;
                &amp;lt;option value=&quot;Brain neurons (billions)&quot;&amp;gt;Brain neurons (billions)&amp;lt;/option&amp;gt;
                &amp;lt;option value=&quot;Cerebral cortex neurons (billions)&quot;&amp;gt;Cerebral cortex neurons (billions)&amp;lt;/option&amp;gt;
            &amp;lt;/select&amp;gt; 
         &amp;lt;/p&amp;gt;
        &amp;lt;/div&amp;gt;
</code></pre>">        &lt;div class="control"&gt;
         &lt;p&gt;&lt;strong&gt;Measure:&lt;/strong&gt;    
            &lt;select id="measures"&gt;
                &lt;option value="Brain size (g)"&gt;Brain size (g)&lt;/option&gt;
                &lt;option value="Relative brain size (% of body mass)"&gt;Relative brain size (% body mass)&lt;/option&gt;
                &lt;option value="Encephalisation Quotient"&gt;Encephalisation Quotient&lt;/option&gt;
                &lt;option value="Brain neurons (billions)"&gt;Brain neurons (billions)&lt;/option&gt;
                &lt;option value="Cerebral cortex neurons (billions)"&gt;Cerebral cortex neurons (billions)&lt;/option&gt;
            &lt;/select&gt; 
         &lt;/p&gt;
        &lt;/div&gt;
</code></pre><p>This adds a dropdown menu control to the container div, which for the time being will not control the graphic.</p><p>The chart should now look like this:</p><p><img src="img/class12_11.jpg" alt=""></p><p>Add the following CSS code between the <code>&lt;style&gt; &lt;/style&gt;</code> tags to position the control level with the Y axis and adjust its appearance:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>        /*style the dropdown menu control*/
        .control {
           font: 12px sans-serif;
           margin-left: 100px;
           width: 400px;
        }
</code></pre>">        <span class="hljs-comment">/*style the dropdown menu control*/</span>
        <span class="hljs-class">.control</span> <span class="hljs-rules">{
           <span class="hljs-rule"><span class="hljs-attribute">font</span>:<span class="hljs-value"> <span class="hljs-number">12px</span> sans-serif</span></span>;
           <span class="hljs-rule"><span class="hljs-attribute">margin-left</span>:<span class="hljs-value"> <span class="hljs-number">100px</span></span></span>;
           <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">400px</span></span></span>;
        <span class="hljs-rule">}</span></span>
</code></pre><p>The chart will now look like this:</p><p><img src="img/class12_12.jpg" alt=""></p><p>Now add this code within the function that loads the data, immediately above the final <code>});</code>.</p><pre class="javascript hljs"><code class="JavaScript" data-origin="<pre><code class=&quot;JavaScript&quot;>        //transition on dropdown select
        d3.select(&quot;#measures&quot;).on(&quot;change&quot;, function() {
            var logger = this.options[this.selectedIndex].value;

            x.domain([0, d3.max(data.filter(function (d) { return (d.measure==logger); }), function(d) { return d.value; })]);

            chart.selectAll(&quot;rect&quot;)
                .data(data.filter(function (d) { return (d.measure==logger); })) //filter data
                .transition()
                .duration(1000)
                .attr(&quot;y&quot;, function(d) { return y(d.species); })
                .attr(&quot;width&quot;, function(d) { return x(d.value); })
                .attr(&quot;height&quot;, y.rangeBand());

            chart.select(&quot;.x.axis&quot;)
                .transition()
                .duration(1000)
                .call(xAxis);
</code></pre>">        <span class="hljs-comment">//transition on dropdown select</span>
        d3.select(<span class="hljs-string">"#measures"</span>).on(<span class="hljs-string">"change"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> logger = <span class="hljs-keyword">this</span>.options[<span class="hljs-keyword">this</span>.selectedIndex].value;

            x.domain([<span class="hljs-number">0</span>, d3.max(data.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> (d.measure==logger); }), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> d.value; })]);

            chart.selectAll(<span class="hljs-string">"rect"</span>)
                .data(data.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> (d.measure==logger); })) <span class="hljs-comment">//filter data</span>
                .transition()
                .duration(<span class="hljs-number">1000</span>)
                .attr(<span class="hljs-string">"y"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> y(d.species); })
                .attr(<span class="hljs-string">"width"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> x(d.value); })
                .attr(<span class="hljs-string">"height"</span>, y.rangeBand());

            chart.select(<span class="hljs-string">".x.axis"</span>)
                .transition()
                .duration(<span class="hljs-number">1000</span>)
                .call(xAxis);
</code></pre><p>Having done so, take some time to explore the functionality of your now interactive graphic.</p><p>This code looks for a change in the element with the id <code>measures</code>, which is our select control. When it detects a change, it declares a variable called <code>logger</code> that corresponds to the  selected item. These are the different measures of the animals’ brains.</p><p>The next chunk of code uses this measure to filter the data, and alters the <code>domain</code> for the x axis so it reads from the corresponding data in the <code>value</code> column:</p><pre class="javascript hljs"><code class="JavaScript" data-origin="<pre><code class=&quot;JavaScript&quot;>        x.domain([0, d3.max(data.filter(function (d) { return (d.measure==logger); }), function(d) { return d.value; })]);
</code></pre>">        x.domain([<span class="hljs-number">0</span>, d3.max(data.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> (d.measure==logger); }), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> d.value; })]);
</code></pre><p>This part of the code redraws the bars with the new data:</p><pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>        chart.selectAll(&quot;rect&quot;)
                .data(data.filter(function (d) { return (d.measure==logger); })) //filter data
                .transition()
                .duration(1000)
                .attr(&quot;y&quot;, function(d) { return y(d.species); })
                .attr(&quot;width&quot;, function(d) { return x(d.value); })
                .attr(&quot;height&quot;, y.rangeBand());
</code></pre>">        chart.selectAll(<span class="hljs-string">"rect"</span>)
                .data(data.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> (d.measure==logger); })) <span class="hljs-comment">//filter data</span>
                .transition()
                .duration(<span class="hljs-number">1000</span>)
                .attr(<span class="hljs-string">"y"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> y(d.species); })
                .attr(<span class="hljs-string">"width"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> x(d.value); })
                .attr(<span class="hljs-string">"height"</span>, y.rangeBand());
</code></pre><p>And this section redraws the X axis so it reflects the new values in the filtered data:</p><pre class="javascript hljs"><code class="JavaScript" data-origin="<pre><code class=&quot;JavaScript&quot;>        chart.select(&quot;.x.axis&quot;)
            .transition()
            .duration(1000)
            .call(xAxis);
</code></pre>">        chart.select(<span class="hljs-string">".x.axis"</span>)
            .transition()
            .duration(<span class="hljs-number">1000</span>)
            .call(xAxis);
</code></pre><p>Note that both these sections contain the following two lines of code:</p><pre class="javascript hljs"><code class="JavaScript" data-origin="<pre><code class=&quot;JavaScript&quot;>            .transition()
            .duration(1000)
</code></pre>">            .transition()
            .duration(<span class="hljs-number">1000</span>)
</code></pre><p>This is reponsible for the smooth transitions between the different states of the chart. The duration is set in milliseconds, so the value of <code>1000</code> means that each transition takes one second to complete. Experiment with different duration values, and see what happens if you comment out these lines of code.</p><p>Note that this code does not need to alter the Y axis, as it does not change with each transition.</p><h3 id="use-a-custom-color-palette"><a name="use-a-custom-color-palette" href="#use-a-custom-color-palette"></a>Use a custom color palette</h3><p>Gray bars are a little boring, so now we will give each animal’s bar a different color.</p><p>First, paste this code immediately below the section that sets the scales for the X and Y axes:</p><pre class="javascript hljs"><code class="JavaScript" data-origin="<pre><code class=&quot;JavaScript&quot;>    // set color palettes

    var colors = d3.scale.category10();

    // var colors = d3.scale.ordinal()
    //   .range([&quot;#f0027f&quot;, &quot;#386cb0&quot;, &quot;#ffff99&quot; , &quot;#fdc086&quot;, &quot;#beaed4&quot;, &quot;#7fc97f&quot;]);
</code></pre>">    <span class="hljs-comment">// set color palettes</span>

    <span class="hljs-keyword">var</span> colors = d3.scale.category10();

    <span class="hljs-comment">// var colors = d3.scale.ordinal()</span>
    <span class="hljs-comment">//   .range(["#f0027f", "#386cb0", "#ffff99" , "#fdc086", "#beaed4", "#7fc97f"]);</span>
</code></pre><p>This shows two ways of setting up a custom color palette for categorical data. The first uses one of D3’s built-in <a href="https://github.com/mbostock/d3/wiki/Ordinal-Scales">categorical/ordinal color palettes</a>. The second, which is commented out, sets the colors for each category individually using their HEX values.</p><p>Having set the color palette, we can now apply it by inserting this code into the section of code that initially draws the bars, after <code>.append("rect")</code>:</p><pre class="javascript hljs"><code class="JavaScript" data-origin="<pre><code class=&quot;JavaScript&quot;>            .style(&quot;fill&quot;, function(d) { return colors(d.species); }) //using custom colors
</code></pre>">            .style(<span class="hljs-string">"fill"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> colors(d.species); }) <span class="hljs-comment">//using custom colors</span>
</code></pre><p>The chart should now look like this:</p><p><img src="img/class12_13.jpg" alt=""></p><p>Now swap the commenting for the code that created the color palettes to see the second version in action.</p><p>See <a href="https://github.com/mbostock/d3/wiki/Colors">here</a> for more on using colors in D3.</p><h4 id="make-the-chart-responsive"><a name="make-the-chart-responsive" href="#make-the-chart-responsive"></a>Make the chart responsive</h4><p>Currently, our chart stays the same size as the window or screen size change, and its 700px width means that it will extend off the side of smaller screens. So now we need to make the chart “responsive,” so that it adjusts to the space available.</p><p>First, at the top of the script, comment out <code>var w = 700;</code> and replace it with the following:</p><pre class="javascript hljs"><code class="JavaScript" data-origin="<pre><code class=&quot;JavaScript&quot;>     //responsive
    var w = parseInt(d3.select(&quot;.container&quot;).style(&quot;width&quot;), 10);
</code></pre>">     <span class="hljs-comment">//responsive</span>
    <span class="hljs-keyword">var</span> w = <span class="hljs-built_in">parseInt</span>(d3.select(<span class="hljs-string">".container"</span>).style(<span class="hljs-string">"width"</span>), <span class="hljs-number">10</span>);
</code></pre><p>This code reads the width of the div with the class <code>container</code>, which we are using to hold the chart, and sets the variable <code>w</code>, used to define the width of the chart, accordingly. (<code>parseInt())</code> simply ensures that the value is returned as a whole number, or integer, see <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/parseInt">here</a>.</p><p>Now insert the following section of code right at the end of the script, just before the closing <code>&lt;/script&gt;</code> tag.</p><pre class="javascript hljs"><code class="JavaScript" data-origin="<pre><code class=&quot;JavaScript&quot;>    //resize chart on window resize
    d3.select(window).on(&quot;resize&quot;, resize);

    function resize() {
        // update width
        w = parseInt(d3.select(&quot;.container&quot;).style(&quot;width&quot;), 10);
        width = w - margin.left - margin.right;

        // resize the chart
        x.range([0, width]);

        d3.select(chart.node().parentNode)
            .style(&quot;width&quot;, (width + margin.left + margin.right) + &quot;px&quot;);

        chart.selectAll(&quot;rect&quot;)
            .attr(&quot;width&quot;, function(d) { return x(d.value); });

        chart.select(&quot;g&quot;).call(xAxis.orient(&quot;top&quot;));

    }
</code></pre>">    <span class="hljs-comment">//resize chart on window resize</span>
    d3.select(<span class="hljs-built_in">window</span>).on(<span class="hljs-string">"resize"</span>, resize);

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resize</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// update width</span>
        w = <span class="hljs-built_in">parseInt</span>(d3.select(<span class="hljs-string">".container"</span>).style(<span class="hljs-string">"width"</span>), <span class="hljs-number">10</span>);
        width = w - margin.left - margin.right;

        <span class="hljs-comment">// resize the chart</span>
        x.range([<span class="hljs-number">0</span>, width]);

        d3.select(chart.node().parentNode)
            .style(<span class="hljs-string">"width"</span>, (width + margin.left + margin.right) + <span class="hljs-string">"px"</span>);

        chart.selectAll(<span class="hljs-string">"rect"</span>)
            .attr(<span class="hljs-string">"width"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> x(d.value); });

        chart.select(<span class="hljs-string">"g"</span>).call(xAxis.orient(<span class="hljs-string">"top"</span>));

    }
</code></pre><p>This code looks for changes in the size of the browser window, and when it detects one applies the function <code>resize()</code>. If you study the code in this function, you will see that it updates the width of the chart and then redraws the elements of the chart that need to change to fit the new width.</p><p>Experiment with resizing your browser window to see how the chart now behaves.</p><p>This responsive chart code is adapted from the example <a href="http://eyeseast.github.io/visible-data/2013/08/28/responsive-charts-with-d3/">here</a>, by journalist-coder Chris Amico. He also has a demonstration of a <a href="http://eyeseast.github.io/visible-data/2013/08/26/responsive-d3/">responsive D3 map</a>.</p><h4 id="reusable-charts:-modifying-d3-templates"><a name="reusable-charts:-modifying-d3-templates" href="#reusable-charts:-modifying-d3-templates"></a>Reusable charts: modifying D3 templates</h4><p>As we’ve seen, making even a simple chart in D3 involves a fairly large amount of code. For this reason, if you are going to be making charts with D3 regularly, it makes sense to keep on hand a number of templates that can construct common chart types into which you can plug new data, and then modify as required.</p><p>Mike Bostock’s <a href="http://bl.ocks.org/mbostock">bl.ocks.org page</a> is a great place to find code examples. Also look at the collected D3 tutorials in the further reading, below.</p><p>My D3 class from <a href="http://www.peteraldhous.com/ucb/2014/dataviz/week13.html">last year</a> explains some basics on making scatter plots and line charts.</p><p>Berkeley J-School lecturer Jeremy Rue has also provided some chart samples,  in his D3 lessons, see <a href="http://jrue.github.io/coding/2014/lesson05/">here</a>, <a href="http://jrue.github.io/coding/2014/lesson06/">here</a>, and <a href="http://jrue.github.io/coding/2014/lesson07/">here</a>.</p><p>I did not cover creating tooltips in this class, but if you want to add those to a D3 chart, using the extension <a href="https://github.com/Caged/d3-tip">d3.tip</a> is the simplest option. Again, Jeremy <a href="http://jrue.github.io/coding/2014/lesson14/">has some notes</a> on this.</p><h3 id="further-reading"><a name="further-reading" href="#further-reading"></a>Further reading</h3><p>Scott Murray. <a href="http://www.amazon.com/Interactive-Data-Visualization-Scott-Murray/dp/1449339735/"><em>Interactive Data Visualization for the Web</em></a><br>Some of the tutorials in this book are also <a href="http://alignedleft.com/tutorials">available for free</a> on Murray’s website.</p><p><a href="https://github.com/mbostock/d3/wiki/Tutorials">Collected D3 tutorials</a></p><p><a href="https://github.com/mbostock/d3/wiki">D3 wiki</a></p>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>
