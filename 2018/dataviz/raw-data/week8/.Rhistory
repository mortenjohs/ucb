scale_size_area(max_size = 10, guide = FALSE) +
xlab("% population in poverty, compared to % for entire state") +
ylab("Toxic releases (million lbs)") +
geom_vline(xintercept = 1, linetype = "dotted") +
theme_minimal()
library(rvest)
url <- "http://www.isrctn.com/search?pageSize=2500&sort=&page=1&q=&filters=condition%3Acancer&searchType=advanced-search"
html <- read_html(url)
html <- read_html(url) %>%
html_node(".ResultsList_item_title")
html
titles <- read_html(url) %>%
html_nodes(".ResultsList_item_title")
titles
titles <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text()
titles
titles <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text() %>%
data.frame()
View(titles)
titles <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text(substr(1,14))
titles <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text() %>%
data_frame()
titles <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text() %>%
data.frame()
ids <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text() %>%
data.frame(colnames="id")
View(ids)
library(rvest)
library(tidyr)
library(dplyr)
ids <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text() %>%
data.frame(names="id")
View(ids)
ids <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text() %>%
data.frame()
names(ids) <- "id"
ids <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text() %>%
data.frame()
names(ids) <- "id"
View(ids)
ids <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text() %>%
data.frame() %>%
separate(., into = c("id","descr", sep = " : "))
View(ids)
ids <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text() %>%
data.frame() %>%
separate(into = c("id","descr", sep = " : "))
ids <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text() %>%
data.frame() %>%
separate(col = .,into = c("id","descr", sep = " : "))
View(ids)
ids <- ids %>%
separate(col = id,into = c("id","descr", sep = " : "))
ids <- ids %>%
separate(col = id, into = c("id","descr", sep = " \\: "))
ids <- ids %>%
separate(col = id, into = c("id","descr", sep = ":"))
ids <- ids %>%
separate(col = id, into = c("id","descr", sep = "\\:"))
library(tidyr)
ids <- ids %>%
separate(col = id, into = c("id","descr", sep = "\\:"))
url <- "http://www.isrctn.com/search?pageSize=2500&sort=&page=1&q=&filters=condition%3Acancer&searchType=advanced-search"
titles <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text() %>%
data.frame()
names(titles) < "title"
View(titles)
names(titles) < "title"
View(titles)
names(titles) <- "title"
View(titles)
titles <- titles %>%
separate(col = title, into = c("id","descr", sep = ":"))
titles <- titles %>%
mutate(id = substring(title,1,14))
View(titles)
titles <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text() %>%
data.frame()
names(titles) <- "title"
View(titles)
titles <- titles %>%
separate(title, c("id","descr"), ":")
View(titles)
url <- "http://www.isrctn.com/search?pageSize=2500&sort=&page=1&q=&filters=condition%3Acancer&searchType=advanced-search"
titles <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text() %>%
data.frame()
names(titles) <- "title"
titles <- titles %>%
separate(title, c("id","descr"), " :")
View(titles)
titles <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text() %>%
data.frame()
names(titles) <- "title"
titles <- titles %>%
separate(title, c("id","descr"), " : ")
View(titles)
base_url <- "http://www.isrctn.com/"
for (i in titles$id) {
print(i)
}
View(titles)
View(titles)
titles <- titles %>%
separate(title, c("id","descr"), " : ") %>%
mutate(id = trimws(id),
descr = trimws(descr))
titles <- read_html(url) %>%
html_nodes(".ResultsList_item_title") %>%
html_text() %>%
data.frame()
names(titles) <- "title"
titles <- titles %>%
separate(title, c("id","descr"), " : ") %>%
mutate(id = trimws(id),
descr = trimws(descr))
View(titles)
View(titles)
for (i in titles$id) {
print(i)
}
for (i in titles$id) {
url <- paste0(base_url,1)
print(url)
}
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
}
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- read_html(url) %>%
html_table()
}
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- html_nodes(dd)
}
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- html_nodes("dd")
}
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- html_nodes("<dd>")
}
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- read_html %>%
html_nodes("dd")
}
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- read_html %>%
html_nodes("dd,p")
}
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- read_html(url) %>%
html_nodes("dd,p")
}
data
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- read_html(url) %>%
html_nodes("dd")
}
data
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- read_html(url) %>%
html_nodes("p")[30]
}
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- read_html(url) %>%
html_nodes("p")
}
data
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- read_html(url) %>%
html_nodes("dd")
}
data
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- read_html(url) %>%
html_nodes("dd")[5:7]
}
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- read_html(url) %>%
html_nodes("dd")
overall_status <- data[6]
recruit_status <- data[7]
}
overall_status
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- read_html(url) %>%
html_nodes("dd")
overall_status <- data[6] %>%
html_text()
recruit_status <- data[7]
}
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- read_html(url) %>%
html_nodes("dd")
overall_status <- data[6] %>%
html_text() %>&
trimws()
recruit_status <- data[7]
}
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- read_html(url) %>%
html_nodes("dd")
overall_status <- data[6] %>%
html_text() %>%
trimws()
recruit_status <- data[7]
}
trial_data <- data.frame()
View(trial_data)
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
data <- read_html(url) %>%
html_nodes("dd")
overall_status <- data[6] %>%
html_text() %>%
trimws()
recruit_status <- data[7] %>&
html_text() %>%
trimws()
data <- data.frame(overall_status,recruit_status)
}
base_url <- "http://www.isrctn.com/"
trial_data <- data.frame()
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
tmp <- read_html(url) %>%
html_nodes("dd")
overall_status <- tmp[6] %>%
html_text() %>%
trimws()
recruit_status <- tmp[7] %>%
html_text() %>%
trimws()
data <- data.frame(overall_status,recruit_status)
bind_rows(trial_data,tmp)
}
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
tmp <- read_html(url) %>%
html_nodes("dd")
overall_status <- tmp[6] %>%
html_text() %>%
trimws()
recruit_status <- tmp[7] %>%
html_text() %>%
trimws()
tmp <- data.frame(overall_status,recruit_status)
bind_rows(trial_data,tmp)
}
View(trial_data)
trial_data <- data.frame()
names(trial_data) <- c("overall_staus","recruit_status")
trial_data <- data.frame()
names(trial_data) <- c("overall_staus","recruit_status")
trial_data <- data_frame()
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
tmp <- read_html(url) %>%
html_nodes("dd")
overall_status <- tmp[6] %>%
html_text() %>%
trimws()
recruit_status <- tmp[7] %>%
html_text() %>%
trimws()
tmp <- data.frame(overall_status,recruit_status)
bind_rows(trial_data,tmp)
}
trial_data <- data.frame()
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
tmp <- read_html(url) %>%
html_nodes("dd")
overall_status <- tmp[6] %>%
html_text() %>%
trimws()
recruit_status <- tmp[7] %>%
html_text() %>%
trimws()
tmp <- data.frame(overall_status,recruit_status)
trial_data <- bind_rows(trial_data,tmp)
}
View(trial_data)
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
tmp <- read_html(url) %>%
html_nodes("dd")
overall_status <- tmp[6] %>%
html_text() %>%
trimws()
recruit_status <- tmp[7] %>%
html_text() %>%
trimws()
tmp <- data.frame(i,overall_status,recruit_status)
trial_data <- bind_rows(trial_data,tmp)
}
View(trial_data)
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
tmp <- read_html(url) %>%
html_nodes("dd","p")
overall_status <- tmp[6] %>%
html_text() %>%
trimws()
recruit_status <- tmp[7] %>%
html_text() %>%
trimws()
tmp2 <- data.frame(i,overall_status,recruit_status)
trial_data <- bind_rows(trial_data,tmp2)
}
for (i in titles$id) {
url <- paste0(base_url,i)
print(url)
tmp <- read_html(url) %>%
html_nodes("dd,p")
overall_status <- tmp[6] %>%
html_text() %>%
trimws()
recruit_status <- tmp[7] %>%
html_text() %>%
trimws()
tmp2 <- data.frame(i,overall_status,recruit_status)
trial_data <- bind_rows(trial_data,tmp2)
}
View(trial_data)
tmp
tmp[67]
tmp[68]
tmp[34]
tmp[35]
tmp[33]
tmp[36]
trial_data <- data.frame()
for (id in titles$id) {
url <- paste0(base_url,id)
print(url)
tmp <- read_html(url) %>%
html_nodes("dd,p")
overall_status <- tmp[6] %>%
html_text() %>%
trimws()
recruit_status <- tmp[7] %>%
html_text() %>%
trimws()
recruit_start <- tml[34] %>%
html_text() %>%
trimws()
recruit_end <- tml[35] %>%
html_text() %>%
trimws()
tmp2 <- data.frame(id,overall_status,recruit_status,recruit_start,recruit_end)
trial_data <- bind_rows(trial_data,tmp2)
}
for (id in titles$id) {
url <- paste0(base_url,id)
print(url)
tmp <- read_html(url) %>%
html_nodes("dd,p")
overall_status <- tmp[6] %>%
html_text() %>%
trimws()
recruit_status <- tmp[7] %>%
html_text() %>%
trimws()
recruit_start <- tmp[34] %>%
html_text() %>%
trimws()
recruit_end <- tmp[35] %>%
html_text() %>%
trimws()
tmp2 <- data.frame(id,overall_status,recruit_status,recruit_start,recruit_end)
trial_data <- bind_rows(trial_data,tmp2)
}
View(trial_data)
trial_data <- data.frame()
for (id in titles$id) {
url <- paste0(base_url,id)
print(url)
tmp <- read_html(url) %>%
html_nodes("dd")
overall_status <- tmp[6] %>%
html_text() %>%
trimws()
recruit_status <- tmp[7] %>%
html_text() %>%
trimws()
tmp2 <- data.frame(id,overall_status,recruit_status,recruit_start,recruit_end)
trial_data <- bind_rows(trial_data,tmp2)
}
View(trial_data)
trial_data <- data.frame()
for (id in titles$id) {
url <- paste0(base_url,id)
print(url)
tmp <- read_html(url) %>%
html_nodes("dd")
overall_status <- tmp[6] %>%
html_text() %>%
trimws()
recruit_status <- tmp[7] %>%
html_text() %>%
trimws()
tmp2 <- data.frame(id,overall_status,recruit_status)
trial_data <- bind_rows(trial_data,tmp2)
}
View(trial_data)
library(WDI)
library(dplyr)
library(readr)
library(stringr)
indic_list <- c("NY.GDP.PCAP.PP.CD", "SP.DYN.LE00.IN", "SP.POP.TOTL", "SP.DYN.CBRT.IN","SH.DYN.NMRT")
# import indicators into single data frame and rename fields
indicators <- WDI(indicator=indic_list, country="all", start=1990, end=2015, extra=T, cache=NULL) %>%
rename(gdp_percap=NY.GDP.PCAP.PP.CD, life_expect=SP.DYN.LE00.IN, population=SP.POP.TOTL, birth_rate=SP.DYN.CBRT.IN, neonat_mortal_rate=SH.DYN.NMRT) %>%
filter(income != "Aggregates") %>%
select(1,9,2:8,10,14)
# for week 6
indicators <- indicators %>%
select(-life_expect)
co2 <- WDI(indicator="EN.ATM.CO2E.PC", country="all", start=1990, end=2014, extra=T, cache=NULL) %>%
filter(income != "Aggregates") %>%
select(1:5)
indicators <- WDI(indicator=indic_list, country="all", start=1990, end=2015, extra=T, cache=NULL) %>%
rename(gdp_percap=NY.GDP.PCAP.PP.CD, life_expect=SP.DYN.LE00.IN, population=SP.POP.TOTL, birth_rate=SP.DYN.CBRT.IN, neonat_mortal_rate=SH.DYN.NMRT) %>%
filter(income != "Aggregates") %>%
select(1,9,2:8,10,14)
indicators$region <- gsub("all income levels","", indicators$region)
indicators$region <- gsub("\\(|\\)","", indicators$region)
indicators$region <- str_trim(indicators$region)
indicators$income <- gsub(": nonOECD","", indicators$income)
indicators$income <- gsub(": OECD","", indicators$income)
setwd("~/Dropbox/ucb/2017/dataviz/raw-data/week3+6")
write.csv(indicators,"nations,csv", na="", row.names = F)
write.csv(indicators,"nations.csv", na="", row.names = F)
setwd("~/Dropbox/ucb/2017/dataviz/raw-data/week8")
# load data
immun <- read_csv("kindergarten.csv")
write.csv(immun, "kindergarten.csv", na="", row.names=F)
# load data
food_stamps <- read_csv("food_stamps.csv")
write.csv(food_stamps,"food_stamps.csv",na="",row.names = F)
