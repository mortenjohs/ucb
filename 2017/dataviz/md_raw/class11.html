<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>class11.html</title>
  <meta name="generator" content="Haroopad 0.13.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF);background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:5px -27px no-repeat #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:#FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:#EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:#75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:1px solid #1A3C6C;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin:0;max-width:none;min-height:0;outline:#112644 0;overflow-x:visible;overflow-y:visible;padding:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}.mermaid .label{color:#333}.node circle,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.edgePath .path{stroke:green;stroke-width:1.5px}.cluster rect{fill:#cdffb2;rx:40;stroke:#6eaa49;stroke-width:1px}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{stroke-width:1.5;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#333}.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:'trebuchet ms',verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:lightgrey;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:lightgrey;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}text{font-family:'trebuchet ms',verdana,arial;font-size:14px}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x;border:0;height:3px;padding:0}hr.underscore{border-top-style:dashed!important}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:url(../img/ajax.gif) center center no-repeat #fff}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}input.task-list-item{margin-left:-1.62em}.markdown{font-family:"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-wrap:break-word}.markdown pre{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;overflow:auto;padding:.5em}.markdown pre code{border:0;display:block}.markdown pre>code{font-family:Consolas,Inconsolata,Courier,monospace;font-weight:700;white-space:pre;margin:0}.markdown code{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown mark{color:#000;background-color:#fcf8e3}.markdown table{padding:0;border-collapse:collapse;border-spacing:0;margin-bottom:16px}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}.github{padding:20px;font-family:"Helvetica Neue",Helvetica,"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Segoe UI",AppleSDGothicNeo-Medium,'Malgun Gothic',Arial,freesans,sans-serif;font-size:15px;background:#fff;line-height:1.6;-webkit-font-smoothing:antialiased}.github a{color:#3269a0}.github a:hover{color:#4183c4}.github h2{border-bottom:1px solid #e6e6e6;line-height:1.6}.github h6{color:#777}.github hr{border:1px solid #e6e6e6}.github pre>code{font-size:.9em;font-family:Consolas,Inconsolata,Courier,monospace}.github blockquote>code,.github h1>code,.github h2>code,.github h3>code,.github h4>code,.github h5>code,.github h6>code,.github li>code,.github p>code,.github td>code{background-color:rgba(0,0,0,.07);font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:85%;padding:.2em .5em;border:0}.github blockquote{border-left:4px solid #e6e6e6;padding:0 15px;font-style:italic}.github table{background-color:#fafafa}.github table tr td,.github table tr th{border:1px solid #e6e6e6}.github table tr:nth-child(2n){background-color:#f2f2f2}.hljs{display:block;overflow-x:auto;padding:.5em;background:#fdf6e3;color:#657b83;-webkit-text-size-adjust:none}.diff .hljs-header,.hljs-comment,.hljs-doctype,.hljs-javadoc,.hljs-pi,.lisp .hljs-string{color:#93a1a1}.css .hljs-tag,.hljs-addition,.hljs-keyword,.hljs-request,.hljs-status,.hljs-winutils,.method,.nginx .hljs-title{color:#859900}.hljs-command,.hljs-dartdoc,.hljs-hexcolor,.hljs-link_url,.hljs-number,.hljs-phpdoc,.hljs-regexp,.hljs-rules .hljs-value,.hljs-string,.hljs-tag .hljs-value,.tex .hljs-formula{color:#2aa198}.css .hljs-function,.hljs-built_in,.hljs-chunk,.hljs-decorator,.hljs-id,.hljs-identifier,.hljs-localvars,.hljs-title,.vhdl .hljs-literal{color:#268bd2}.hljs-attribute,.hljs-class .hljs-title,.hljs-constant,.hljs-link_reference,.hljs-parent,.hljs-type,.hljs-variable,.lisp .hljs-body,.smalltalk .hljs-number{color:#b58900}.css .hljs-pseudo,.diff .hljs-change,.hljs-attr_selector,.hljs-cdata,.hljs-header,.hljs-pragma,.hljs-preprocessor,.hljs-preprocessor .hljs-keyword,.hljs-shebang,.hljs-special,.hljs-subst,.hljs-symbol,.hljs-symbol .hljs-string{color:#cb4b16}.hljs-deletion,.hljs-important{color:#dc322f}.hljs-link_label{color:#6c71c4}.tex .hljs-formula{background:#eee8d5}.MathJax_Hover_Frame{border-radius:.25em;-webkit-border-radius:.25em;-moz-border-radius:.25em;-khtml-border-radius:.25em;box-shadow:0 0 15px #83A;-webkit-box-shadow:0 0 15px #83A;-moz-box-shadow:0 0 15px #83A;-khtml-box-shadow:0 0 15px #83A;border:1px solid #A6D!important;display:inline-block;position:absolute}.MathJax_Hover_Arrow{position:absolute;width:15px;height:11px;cursor:pointer}#MathJax_About{position:fixed;left:50%;width:auto;text-align:center;border:3px outset;padding:1em 2em;background-color:#DDD;color:#000;cursor:default;font-family:message-box;font-size:120%;font-style:normal;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;-khtml-border-radius:15px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_Menu{position:absolute;background-color:#fff;color:#000;width:auto;padding:5px 0;border:1px solid #CCC;margin:0;cursor:default;font:menu;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:5px;-webkit-border-radius:5px;-moz-border-radius:5px;-khtml-border-radius:5px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_MenuItem{padding:1px 2em;background:0 0}.MathJax_MenuArrow{position:absolute;right:.5em;color:#666}.MathJax_MenuActive .MathJax_MenuArrow{color:#fff}.MathJax_MenuArrow.RTL{left:.5em;right:auto}.MathJax_MenuCheck{position:absolute;left:.7em}.MathJax_MenuCheck.RTL{right:.7em;left:auto}.MathJax_MenuRadioCheck{position:absolute;left:.7em}.MathJax_MenuRadioCheck.RTL{right:.7em;left:auto}.MathJax_MenuLabel{padding:1px 2em 3px 1.33em;font-style:italic}.MathJax_MenuRule{border-top:1px solid #DDD;margin:4px 3px}.MathJax_MenuDisabled{color:GrayText}.MathJax_MenuActive{background-color:#606872;color:#fff}.MathJax_Menu_Close{position:absolute;width:31px;height:31px;top:-15px;left:-15px}#MathJax_Zoom{position:absolute;background-color:#F0F0F0;overflow:auto;display:block;z-index:301;padding:.5em;border:1px solid #000;margin:0;font-weight:400;font-style:normal;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;box-shadow:5px 5px 15px #AAA;-webkit-box-shadow:5px 5px 15px #AAA;-moz-box-shadow:5px 5px 15px #AAA;-khtml-box-shadow:5px 5px 15px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_ZoomOverlay{position:absolute;left:0;top:0;z-index:300;display:inline-block;width:100%;height:100%;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_ZoomFrame{position:relative;display:inline-block;height:0;width:0}#MathJax_ZoomEventTrap{position:absolute;left:0;top:0;z-index:302;display:inline-block;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}.MathJax_Preview{color:#888}#MathJax_Message{position:fixed;left:1px;bottom:2px;background-color:#E6E6E6;border:1px solid #959595;margin:0;padding:2px 8px;z-index:102;color:#000;font-size:80%;width:auto;white-space:nowrap}#MathJax_MSIE_Frame{position:absolute;top:0;left:0;width:0;z-index:101;border:0;margin:0;padding:0}.MathJax_Error{color:#C00;font-style:italic}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown github">
<h1 id="making-interactive-maps-and-processing-geodata-with-sql"><a name="making-interactive-maps-and-processing-geodata-with-sql" href="#making-interactive-maps-and-processing-geodata-with-sql"></a>Making interactive maps and processing geodata with SQL</h1><h3 id="introducing-carto"><a name="introducing-carto" href="#introducing-carto"></a>Introducing Carto</h3><p><a href="https://carto.com/"><strong>Carto</strong></a> is a cloud-based mapping application that makes it easy to produce interactive, online maps. These maps can include <a href="https://carto.com/docs/faqs/torque/">animations of data over time</a>.</p><p>It is also a geospatial database, allowing you to perform GIS analyses and process geodata using <a href="http://en.wikipedia.org/wiki/SQL">Structured Query Language</a>. If you are comfortable working with databases, you may find Carto a good alternative to the point-and-click interface of QGIS for these tasks.</p><h3 id="the-data-we-will-use-today"><a name="the-data-we-will-use-today" href="#the-data-we-will-use-today"></a>The data we will use today</h3><p>Download the data from this session from <a href="data/class11.zip">here</a>, unzip the folder and place it on your desktop. It contains the following folders and files:</p><ul>
<li><code>seismic.zip</code> Zipped shapefile with data on the risk of a damaging earthquake in 2017 for the continental United States, from the <a href="https://earthquake.usgs.gov/hazards/induced/">U.S. Geological Survey</a>.</li><li><code>seismic_raw.zip</code> As above, but not clipped to the coast and borders of the United States.</li><li><code>ne_50m_admin_0_countries_lakes.zip</code> Zipped <a href="http://www.naturalearthdata.com/downloads/50m-cultural-vectors/50m-admin-0-countries-2/">Natural Earth shapefile</a> with boundary data for the world’s nations.</li><li><code>sf_test_addresses.zip</code> Zipped shapefile of addresses we geocoded in week 9, with their coordinates derived from Bing Maps.</li><li><code>quakes.csv</code> This file isn’t in the folder. As for week 10, we will use the U.S. Geological Survey’s <a href="https://earthquake.usgs.gov/earthquakes/search/">Earthquakes Archives</a> API where we will search for all earthquakes since 1960 with a <a href="http://www.geo.mtu.edu/UPSeis/magnitude.html">magnitude</a> of 6 or greater that occured witin 6,000 kilometers of the geographic center of the contiguous United States. Type this url into the address bar of your browser:<pre class="javascript hljs"><code class="Javascript" data-origin="<pre><code class=&quot;Javascript&quot;>https://earthquake.usgs.gov/fdsnws/event/1/query?starttime=1960-01-01T00:00:00&amp;amp;latitude=39.828175&amp;amp;longitude=-98.5795&amp;amp;maxradiuskm=6000&amp;amp;minmagnitude=6&amp;amp;format=csv&amp;amp;orderby=time
</code></pre>">https:<span class="hljs-comment">//earthquake.usgs.gov/fdsnws/event/1/query?starttime=1960-01-01T00:00:00&amp;latitude=39.828175&amp;longitude=-98.5795&amp;maxradiuskm=6000&amp;minmagnitude=6&amp;format=csv&amp;orderby=time</span>
</code></pre>
A file called <code>query.csv</code> should download. Rename it <code>quakes.csv</code> and add to the <code>class11</code> folder.</li><li><code>test.html</code> A web page for embedding the Carto map we will make.</li></ul><h3 id="map-seismic-risk-and-earthquakes"><a name="map-seismic-risk-and-earthquakes" href="#map-seismic-risk-and-earthquakes"></a>Map seismic risk and earthquakes</h3><h4 id="import-data-to-carto"><a name="import-data-to-carto" href="#import-data-to-carto"></a>Import data to Carto</h4><p>Login to your Carto account, open the drop-down menu under <code>Maps</code> at top left and switch to <code>Your datasets</code>:</p><p><img src="img/class11_1.jpg" alt=""></p><p>If you have not imported any data into Carto previously you will be in the <code>DATA LIBRARY</code> tab, which contains useful datasets that you can import into your own account.</p><p>The top menu has a link to <code>DOCUMENTATION</code>, which has links to Carto’s technical manuals.</p><p>Now click the <code>NEW DATASET</code> button at top right.</p><p>You should now see the following screen:</p><p><img src="img/class11_2.jpg" alt=""></p><p>With the <code>Data file</code> tab selected, click the <code>Browse</code> button, navigate to the zipped <code>seismic.zip</code> shapefile and click <code>Open</code>. Then click the <code>CONNECT DATASET</code> button at bottom right.</p><p>Carto can import geodata in a variety of formats, including CSV, <a href="https://developers.google.com/kml/?hl=en">KML</a>, <a href="http://geojson.org/">GeoJSON</a> and zipped <a href="https://en.wikipedia.org/wiki/Shapefile">shapefiles</a>.</p><p>Once the data has imported, you will see the uploaded data table:</p><p><img src="img/class11_3.jpg" alt=""></p><p>Notice that, in addition to the <code>valuerange</code> field from the original data, each row has been given a <code>cartodb_id</code>, which is a unique identifier for each. The table also has a field called <code>the_geom</code>. This field is central to how Carto works, defining the geometry of any map you make. These geometries can be points, lines or polygons (areas) — which is what we have here.</p><p>You can rename fields by double-clicking on their names:</p><p><img src="img/class11_4.jpg" alt=""></p><p>You can sort or order the table by the data in each field by clicking on the blue dots and then using the arrows:</p><p><img src="img/class11_5.jpg" alt=""></p><p>And you can change the data type for each field (for example from numbers to strings of text), using the same menu.</p><p>Click <code>PREVIEW</code> at bottom right to see the basic, unstyled map:</p><p><img src="img/class11_6.jpg" alt=""></p><p>Now click <code>BACK</code> to close that map and click on the circle at top left to return to your datasets:</p><p><img src="img/class11_7.jpg" alt=""></p><p>Now click the <code>NEW DATASET</code> button again and import the file <code>quakes.csv</code>, which should look like this:</p><p><img src="img/class11_8.jpg" alt=""></p><p>Notice that <code>the_geom</code> for points is given by their longitude and latitude co-ordinates.</p><p>Click <code>PREVIEW</code> to see the locations of all of the quakes:</p><p><img src="img/class11_9.jpg" alt=""></p><h4 id="create-a-map-combining-both-datasets"><a name="create-a-map-combining-both-datasets" href="#create-a-map-combining-both-datasets"></a>Create a map combining both datasets</h4><p>Exit the <code>quakes</code> map and reopen the <code>seismic</code> dataset by clicking on its name in your <code>DATASETS</code>. Then click the <code>CREATE MAP</code> button at bottom right.</p><p>If this is your first time using Carto, you will be asked if you want to <code>TAKE A TOUR</code>. Instead click <code>EDIT YOUR MAP</code> to see this view:</p><p><img src="img/class11_10.jpg" alt=""></p><p>Now add the <code>quakes</code> to the map, by clicking on the <code>ADD</code> button. Select the <code>quakes</code> layer so that it is highlighted in blue, then click the <code>ADD LAYER</code> button at bottom right:</p><p><img src="img/class11_11.jpg" alt=""></p><p>You should now see both layers on the same map:</p><p><img src="img/class11_12.jpg" alt=""></p><h4 id="select-a-basemap"><a name="select-a-basemap" href="#select-a-basemap"></a>Select a basemap</h4><p>Now choose a basemap for your visualization, by clicking the <code>Basemap</code> layer in the left panel. The default is a basemap from Carto called <code>Voyager</code>, with the <code>Labels</code> displayed over the data layers.</p><p>Take a few minutes to explore the built-in basemap options using the <code>Source</code> and <code>Style</code> options. You are not limited to these basemaps, however.</p><p>To import another tiled basemap from elsewhere on the web, click this icon under <code>Source</code>:</p><p><img src="img/class11_13.jpg" alt=""></p><p>Now click the blue plus sign under <code>Style</code> to call up the following dialog box:</p><p><img src="img/class11_14.jpg" alt=""></p><p>The <code>XYZ</code> tab allows you to call in publicly available basemaps using URLs in the following format:</p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>https://a.tiles.mapbox.com/v3/mapbox.blue-marble-topo-bathy-jan/{z}/{x}/{y}.png
</code></pre>">https://a.tiles.mapbox.com/v3/mapbox.blue-marble-topo-bathy-jan/{z}/{x}/{y}.png
</code></pre><p>This is the url for a “Blue Marble” satellite basemap, provided by MapBox (see the other basemaps from MapBox <a href="http://a.tiles.mapbox.com/v3/mapbox/maps.html">here</a>). The <a href="https://leaflet-extras.github.io/leaflet-providers/preview//">Leaflet Providers preview</a> is a good place to look for available basemaps from other providers. It previews the maps and also exposes their <code>XYZ</code> URLs:</p><p><img src="img/class11_15.jpg" alt=""></p><p>You can also replace the basemap with a white or colored background by clicking on the paint-pot icon under <code>Source</code>:</p><p><img src="img/class11_16.jpg" alt=""></p><p>Now switch the basemap to Carto’s <code>Positron</code>, which is a good default:</p><p><img src="img/class11_17.jpg" alt=""></p><h4 id="create-a-new-column-in-the-quakes-data-to-scale-the-points-accurately-by-the-size-of-the-quakes"><a name="create-a-new-column-in-the-quakes-data-to-scale-the-points-accurately-by-the-size-of-the-quakes" href="#create-a-new-column-in-the-quakes-data-to-scale-the-points-accurately-by-the-size-of-the-quakes"></a>Create a new column in the quakes data to scale the points accurately by the size of the quakes</h4><p>We want to accurately and continuously vary the area of the circles representing the quakes according to their size.</p><p>To achieve that, we need to create a new column in the data using the formula <code>scale = sqrt(10^mag)</code>; that is, raise 10 to the power of the earthquake magititude, in the <code>mag</code> columns, then tak its square root.</p><p>We discussed in week 10 that the size of a quake, in terms of the amount of shaking on a seismograph, is 10 to the power of its magnitude.</p><p>Here, we need to take the square root of these values, because web-based applications like Carto set the size of circles by their width, or twice their radius. From week 2, you should remember that we need to scale by the square root of the radius to size circles so that their area is proportional to values in the data.</p><p>Open the <code>quakes</code> layer by clicking on it in the left-hand panel, then click the blue <code>quakes</code> link at the top to open the dataset in a new browser tab:</p><p><img src="img/class11_18.jpg" alt=""></p><p>Click <code>ADD COLUMN</code>, rename it as <code>scale</code> and then change its type from <code>string</code> to <code>number</code>:</p><p><img src="img/class11_19.jpg" alt=""></p><p>Slide the <code>METADATA/SQL</code> toggle control at bottom left to <code>SQL</code> to see the following view:</p><p><img src="img/class11_20.jpg" alt=""></p><p>Enter the following query in place of the default <code>SELECT * FROM quakes</code>:</p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>UPDATE quakes SET scale = sqrt(10^mag)
</code></pre>"><span class="hljs-operator"><span class="hljs-keyword">UPDATE</span> quakes <span class="hljs-keyword">SET</span> scale = <span class="hljs-keyword">sqrt</span>(<span class="hljs-number">10</span>^mag)
</span></code></pre><p>Now click <code>APPLY</code>.</p><p><code>UPDATE</code> queries change the data in the table, in this case updating the <code>quakes</code> table to set the values for <code>scale</code>.</p><p>The <code>scale</code> column should have now been populated with values:</p><p><img src="img/class11_21.jpg" alt=""></p><p>Having confirmed that the new column has been created, close the browser tab showing the dataset.</p><h4 id="style-the-maps-using-the-point-and-click-interface"><a name="style-the-maps-using-the-point-and-click-interface" href="#style-the-maps-using-the-point-and-click-interface"></a>Style the maps using the point-and-click interface</h4><p>Back in your map, return to the layers view<br>by clicking the blue back arrow at top left in the <code>quakes</code> layer. Then temporarily hide the <code>quakes</code> layer by clicking on its eye icon:</p><p><img src="img/class11_22.jpg" alt=""></p><p>Now click on the <code>seismic</code> layer to bring up this view:</p><p><img src="img/class11_23.jpg" alt=""></p><p>At this point, rename the layer <code>Risk of damaging quake in 2017</code>.</p><p>In the <code>STYLE</code> tab, click on the color bar for <code>COLOR</code>. Then select <code>BY VALUE</code> and select the <code>valuerange</code> field to color the map by the values for earthquake risk:</p><p><img src="img/class11_24.jpg" alt=""></p><p>See <a href="http://paldhous.github.io/kdmc-workshops/2017/intro-dataviz/carto.html">here</a> for an example of how this works for a continuous variable that has not already been binned into categories.</p><p>At this point, we could set the colors for each of the bins individually by clicking on them.</p><p>However, we are going to refine the styling of the maps using CSS code.</p><p>Now return to the layers view for the map by clicking the blue back arrow, and restore the visibility of the <code>quakes</code> layer.</p><p>Open the <code>quakes</code> layer, and in the <code>STYLE</code> tab, click on the color bar for <code>COLOR</code>. Select <code>SOLID</code> and set the color <code>value</code> to <code>#ffffff</code> for white, and the opacity/alpha, or <code>A</code>, to <code>0.5</code>.</p><p><img src="img/class11_25.jpg" alt=""></p><p>Now set the <code>STROKE</code> color to <code>#0000000</code>, for black, and the size to <code>0.2</code>:</p><p><img src="img/class11_26.jpg" alt=""></p><p>(For points, the different <code>Aggregation</code> options allow you to create other map types from a points layer, including hexagonal binned maps and animations. We will explore these options in class, as time allows.)</p><h4 id="style-the-map-using-cartocss"><a name="style-the-map-using-cartocss" href="#style-the-map-using-cartocss"></a>Style the map using CartoCSS</h4><p>To exert finer control over the map styling, we can use CartoCSS, which styles maps in much the same way that conventional CSS styles web pages. See <a href="https://carto.com/docs/carto-engine/cartocss/">here</a> for a CartoCSS reference.</p><p>Still in the <code>quakes</code> slide the <code>VALUES/CARTOCSS</code> toggle control at bottom to <code>CARTOCSS</code></p><p>You should see the following code:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>#layer {
  marker-width: 7;
  marker-fill: #ffffff;
  marker-fill-opacity: 0.5;
  marker-allow-overlap: true;
  marker-line-width: 0.2;
  marker-line-color: #000000;
  marker-line-opacity: 1;
}
</code></pre>"><span class="hljs-id">#layer</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">marker-width</span>:<span class="hljs-value"> <span class="hljs-number">7</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-fill</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#ffffff</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-fill-opacity</span>:<span class="hljs-value"> <span class="hljs-number">0.5</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-allow-overlap</span>:<span class="hljs-value"> true</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-line-width</span>:<span class="hljs-value"> <span class="hljs-number">0.2</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-line-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#000000</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-line-opacity</span>:<span class="hljs-value"> <span class="hljs-number">1</span></span></span>;
<span class="hljs-rule">}</span></span>
</code></pre><p>Edit to the following, and click <code>APPLY</code>:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>#layer {
  marker-width: [scale]/300;
  marker-fill: #ffffff;
  marker-fill-opacity: 0.5;
  marker-allow-overlap: true;
  marker-line-width: 0.2;
  marker-line-color: #000000;
  marker-line-opacity: 1;
}
</code></pre>"><span class="hljs-id">#layer</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">marker-width</span>:<span class="hljs-value"> [scale]/<span class="hljs-number">300</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-fill</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#ffffff</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-fill-opacity</span>:<span class="hljs-value"> <span class="hljs-number">0.5</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-allow-overlap</span>:<span class="hljs-value"> true</span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-line-width</span>:<span class="hljs-value"> <span class="hljs-number">0.2</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-line-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#000000</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">marker-line-opacity</span>:<span class="hljs-value"> <span class="hljs-number">1</span></span></span>;
<span class="hljs-rule">}</span></span>
</code></pre><p>Setting the <code>marker-width</code> to <code>[scale]</code>, with the name of the field in square brackets, accurately scales the area of the circles according the capacity of the facilities. It is often necessary, when scaling circles in this way, to use multiplication (<code>marker-width: [scale]*N;</code>) or division (<code>marker-width: [scale]/N;</code>) to increase or decrease the size of all the circles. Experiment with a value for <code>N</code> that works for your map. Here we have used a value of <code>300</code>.</p><p>The map should now look like this:</p><p><img src="img/class11_27.jpg" alt=""></p><p>Now switch to the <code>Risk of damaging quake in 2017</code> layer, select <code>STYLE</code> and again switch to the <code>CARTOCSS</code> view, where you will find the following code:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>#layer {
  polygon-fill: ramp([valuerange], (#5F4690, #1D6996, #38A6A5, #0F8554, #73AF48), (&quot;1 - 2&quot;, &quot;2 - 5&quot;, &quot;5 - 10&quot;, &quot;&amp;lt; 1&quot;, &quot;10 - 12&quot;), &quot;=&quot;);
}
#layer::outline {
  line-width: 1;
  line-color: #FFFFFF;
  line-opacity: 0.5;
}
</code></pre>"><span class="hljs-id">#layer</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">polygon-fill</span>:<span class="hljs-value"> <span class="hljs-function">ramp</span>([valuerange], (<span class="hljs-hexcolor">#5F4690</span>, <span class="hljs-hexcolor">#1D6996</span>, <span class="hljs-hexcolor">#38A6A5</span>, <span class="hljs-hexcolor">#0F8554</span>, <span class="hljs-hexcolor">#73AF48</span>), (<span class="hljs-string">"1 - 2"</span>, <span class="hljs-string">"2 - 5"</span>, <span class="hljs-string">"5 - 10"</span>, <span class="hljs-string">"&lt; 1"</span>, <span class="hljs-string">"10 - 12"</span>), <span class="hljs-string">"="</span>)</span></span>;
<span class="hljs-rule">}</span></span>
<span class="hljs-id">#layer</span><span class="hljs-pseudo">::outline</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">line-width</span>:<span class="hljs-value"> <span class="hljs-number">1</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">line-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#FFFFFF</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">line-opacity</span>:<span class="hljs-value"> <span class="hljs-number">0.5</span></span></span>;
<span class="hljs-rule">}</span></span>
</code></pre><p>Edit this to the following:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>#layer {
  polygon-fill: ramp([valuerange], (#fee5d9,#fcae91,#fb6a4a,#de2d26,#a50f15), (&quot;&amp;lt; 1&quot;, &quot;1 - 2&quot;, &quot;2 - 5&quot;, &quot;5 - 10&quot;, &quot;10 - 12&quot;), &quot;=&quot;);
}
#layer::outline {
  line-width: 0;
  line-color: #FFFFFF;
  line-opacity: 0.5;
}
</code></pre>"><span class="hljs-id">#layer</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">polygon-fill</span>:<span class="hljs-value"> <span class="hljs-function">ramp</span>([valuerange], (<span class="hljs-hexcolor">#fee5d9</span>,<span class="hljs-hexcolor">#fcae91</span>,<span class="hljs-hexcolor">#fb6a4a</span>,<span class="hljs-hexcolor">#de2d26</span>,<span class="hljs-hexcolor">#a50f15</span>), (<span class="hljs-string">"&lt; 1"</span>, <span class="hljs-string">"1 - 2"</span>, <span class="hljs-string">"2 - 5"</span>, <span class="hljs-string">"5 - 10"</span>, <span class="hljs-string">"10 - 12"</span>), <span class="hljs-string">"="</span>)</span></span>;
<span class="hljs-rule">}</span></span>
<span class="hljs-id">#layer</span><span class="hljs-pseudo">::outline</span> <span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">line-width</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">line-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#FFFFFF</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">line-opacity</span>:<span class="hljs-value"> <span class="hljs-number">0.5</span></span></span>;
<span class="hljs-rule">}</span></span>
</code></pre><p>Here we have edited the legend items so they appear in the correct order, used ColorBrewer <code>Reds</code> HEX values, and set the <code>line-width</code> to <code>0</code> to remove the polygon outlines.</p><p>Click <code>APPLY</code> and the map should look like this:</p><p><img src="img/class11_28.jpg" alt=""></p><h4 id="edit-the-legend"><a name="edit-the-legend" href="#edit-the-legend"></a>Edit the legend</h4><p>Still in the <code>Risk of damaging quake in 2017</code> layer, switch to the <code>LEGEND</code> tab and uncheck the <code>TITLE</code> to remove <code>valuerange</code> from the legend.</p><h4 id="configure-tooltips/pop-ups"><a name="configure-tooltips/pop-ups" href="#configure-tooltips/pop-ups"></a>Configure tooltips/pop-ups</h4><p>Switch to the <code>quakes</code> layer, then click on <code>quakes</code> link at the top to open the dataset in a new browser tab. Find the <code>time</code> variable and change its data type to <code>String</code>:</p><p><img src="img/class11_29.jpg" alt=""></p><p>This is necessary because dates and times don’t show in Carto tooltips unless they are converted to plain text.</p><p>Close this browser tab and select the <code>POP-UP</code> tab in the <code>quakes</code> layer. Select <code>Hover</code> and the <code>LIGHT</code> style, and check <code>time</code> and <code>mag</code>, changing the text for the latter to <code>magnitude</code>.</p><p>When you hover over one of the quakes, the map should now look like this:</p><p><img src="img/class11_30.jpg" alt=""></p><h4 id="configure-the-map-options,-and-publish"><a name="configure-the-map-options,-and-publish" href="#configure-the-map-options,-and-publish"></a>Configure the map options, and publish</h4><p>Return to the main layers panel.</p><p>We are almost ready to publish the visualization, but before doing so, click the <code>Settings</code> icon at left:</p><p><img src="img/class11_31.jpg" alt=""></p><p>Here you have options to include or remove options including the <code>SEARCH BOX</code>, which geocodes locations entered by the user and zooms, the <code>ZOOM CONTROLS</code>, the <code>LAYER SELECTOR</code>, which allows the individual layers to be switched on and off, is enabled, and the <code>TOOLBAR</code>, which includes a link to the map author’s account, and social sharing buttons:</p><p><img src="img/class11_32.jpg" alt=""></p><p>I strongly recommend disabling the <code>SCROLL WHEEL ZOOM</code> which will otherwise cause the map to zoom unintentionally when someone scrolls down a web page in which the map is embedded.</p><p>Having finished working on the map, click the <code>PUBISH</code> button, and again at the next screen:</p><p><img src="img/class11_33.jpg" alt=""></p><p>Copy the code the code from <code>Embed it</code> to obtain an <a href="http://www.w3schools.com/tags/tag_iframe.asp">iframe</a> which will allow you to embed the map on any web page, in the following format:</p><pre class="css hljs"><code class="CSS" data-origin="<pre><code class=&quot;CSS&quot;>&amp;lt;iframe width=&quot;100%&quot; height=&quot;520&quot; frameborder=&quot;0&quot; src=&quot;https://paldhous-new.carto.com/builder/e0a4f4d1-18d5-48bf-a98f-b70ec34dd7ec/embed&quot; allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen&amp;gt;&amp;lt;/iframe&amp;gt;
</code></pre>">&lt;iframe width="100%" height="520" frameborder="0" src="https://paldhous-new.carto.com/builder/e0a4f4d1-18d5-48bf-a98f-b70ec34dd7ec/embed" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen&gt;&lt;/iframe&gt;
</code></pre><p>You can edit the dimensions of the iframe — here set at <code>100%</code> of the width of the div in which it appears — and <code>520</code> pixels high) as required.</p><p>Open the file <code>test.html</code> in your text editor, paste the iframe code between the <code>&lt;body&gt; &lt;/body&gt;</code> tags and save the file. Then open in a web browser to see the completed map:</p><p><img src="img/class11_34.jpg" alt=""></p><h3 id="process-geodata-and-perform-geospatial-analysis-using-sql"><a name="process-geodata-and-perform-geospatial-analysis-using-sql" href="#process-geodata-and-perform-geospatial-analysis-using-sql"></a>Process geodata and perform geospatial analysis using SQL</h3><p>Carto isn’t just a database — it is a “spatially aware” database that you can query to process geotdata, calculate distances or areas, and  perform other geospatial analyses. This is achieved using <a href="https://postgis.net/">PostGIS</a>, an extension to the open-source <a href="https://www.postgresql.org/">PostgreSQL</a> database that drives Carto.</p><h4 id="clip-the-seismic-risk-raw-data-to-the-borders-of-the-united-states"><a name="clip-the-seismic-risk-raw-data-to-the-borders-of-the-united-states" href="#clip-the-seismic-risk-raw-data-to-the-borders-of-the-united-states"></a>Clip the seismic risk raw data to the borders of the United States</h4><p>Now we are going to work with queries that use PostGIS spatial functions, which all have the prefix <code>ST_</code>.</p><p>Navigate back to your datasets and import the zipped shapefile <code>seismic_raw.zip</code>, which should look like this in the <code>PREVIEW</code>:</p><p><img src="img/class11_35.jpg" alt=""></p><p>Now import the <code>ne_50m_admin_0_countries_lakes.zip</code> zipped shapefile.</p><p>Slide the <code>METADATA/SQL</code> toggle control at bottom left to <code>SQL</code>, and <code>APPLY</code> the following query to replicate the clip we ran in week 10 using QGIS:</p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>SELECT seismic_raw.valuerange, ST_Intersection(seismic_raw.the_geom, ne_50m_admin_0_countries_lakes.the_geom) AS the_geom_webmercator
FROM seismic_raw, ne_50m_admin_0_countries_lakes
WHERE ne_50m_admin_0_countries_lakes.iso_a3='USA'
</code></pre>"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> seismic_raw.valuerange, ST_Intersection(seismic_raw.the_geom, ne_50m_admin_0_countries_lakes.the_geom) <span class="hljs-keyword">AS</span> the_geom_webmercator
<span class="hljs-keyword">FROM</span> seismic_raw, ne_50m_admin_0_countries_lakes
<span class="hljs-keyword">WHERE</span> ne_50m_admin_0_countries_lakes.iso_a3=<span class="hljs-string">'USA'</span>
</span></code></pre><p>Let’s break this query down:</p><p>The <code>SELECT</code> clause selects the two data fields from the <code>seismic_risk</code> dataset, and creates a third column called <code>the_geom_webmercator</code> using the PostGIS function <code>ST_Intersection</code>, which is the spatial overlap between the <code>seismic_risk</code> and <code>world_borders</code> maps.</p><p>The <code>FROM</code> clause needs to include both datasets mentioned in the <code>SELECT</code> clause, separated by commas.</p><p>Finally, the <code>WHERE</code> clause filters the results so that the data returned overlaps with the United States only.</p><p>Why does this query use <code>the_geom_webmercator</code> rather than <code>the_geom</code>? This is a quirk of Carto, which stores a projected version of the table’s geometry in a “hidden” field of this name, as explained <a href="https://carto.com/docs/tutorials/projections/">here</a>. Some PostGIS functions will only work on this version of the geometry. If you hit an error using <code>the_geom</code> try <code>the_geom_webmercator</code>.</p><p>The header for the table now shows that SQL has been applied to this dataset:</p><p><img src="img/class11_36.jpg" alt=""></p><p>Click on the three blue dots to the right of the SQL icon and select <code>Create Dataset from query</code>:</p><p><img src="img/class11_37.jpg" alt=""></p><p>Rename the new dataset, which should look like this in the <code>PREVIEW</code>:</p><p><img src="img/class11_38.jpg" alt=""></p><p>Return to the data table view. If you are processing data in Carto for use with other mapping tools, you would now want to export the data. To do this, click on the <code>EXPORT</code> link at top right and choose the desired format:</p><p><img src="img/class11_39.jpg" alt=""></p><h4 id="create-buffers-around-geocoded-san-francisco-addresses"><a name="create-buffers-around-geocoded-san-francisco-addresses" href="#create-buffers-around-geocoded-san-francisco-addresses"></a>Create buffers around geocoded San Francisco addresses</h4><p>Import the zipped shapefile <code>sf_test_addresses.zip</code>. Select <code>Duplicate dataset</code> from the top menu and rename the copy as <code>buffer</code>. It should look like this in the <code>PREVIEW</code>:</p><p><img src="img/class11_40.jpg" alt=""></p><p>Return to the data table view, and slide the <code>METADATA/SQL</code> toggle control to <code>SQL</code>. Now run this query:</p><pre class="sql hljs"><code class="SQL" data-origin="<pre><code class=&quot;SQL&quot;>SELECT ST_Union(ST_Buffer(the_geom::geography, 304.8)::geometry) AS the_geom
FROM buffer
</code></pre>"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> ST_Union(ST_Buffer(the_geom::geography, <span class="hljs-number">304.8</span>)::geometry) <span class="hljs-keyword">AS</span> the_geom
<span class="hljs-keyword">FROM</span> buffer
</span></code></pre><p>This changes the map so that instead of points, we now have circles drawn around each of the points with a radius of 1,000 feet, or 304.8 meters, and dissolves those circles into a single polygon.</p><p>Let’s break this query down to understand how it works.  The PostGIS function <code>ST_Buffer</code> draws a buffer around an object using the value specified in meters. That’s fairly easy to understand, but why does the query contain <code>::geography</code> and <code>::geometry</code>? These are data conversions that are necessary for the buffers to be drawn. Carto stores <code>the_geom</code> in a <code>WGS84</code> datum, for which the units are degrees. The conversion from this <code>geometry</code> to <code>geography</code> is necessary for calculations to be made in meters. Once the buffer has been calculated, the data must be converted back to <code>geometry</code> to update the table in the database.</p><p>The PostGIS function <code>ST_Union</code> dissolves the circles into a single polygon, and <code>AS the_geom</code> names the new geometry column.</p><p>Again, click on the three blue dots to the right of the SQL icon and select <code>Create Dataset from query</code>.</p><p>Rename the resulting dataset as <code>buffered</code>. It should look like this in the <code>PREVIEW</code>:</p><p><img src="img/class11_41.jpg" alt=""></p><h4 id="next-steps-with-postgis"><a name="next-steps-with-postgis" href="#next-steps-with-postgis"></a>Next steps with PostGIS</h4><p>I hope these queries have whetted your appetite to learn more about PostGIS.</p><h3 id="assignment"><a name="assignment" href="#assignment"></a>Assignment</h3><p>File a full project update via your GitHub account, so that I can see your visualizations, data etc. Also write a summary in Markdown, including:</p><ul>
<li>What you have done</li><li>What you intend to do</li><li>Problems, obstacles</li></ul><p>Share this with me by <strong>6pm</strong> on <strong>Wed Nov 8</strong>.</p><h3 id="further-reading/resources"><a name="further-reading/resources" href="#further-reading/resources"></a>Further reading/resources</h3><p><a href="https://carto.com/docs/tutorials/">Carto tutorials</a></p><p><a href="https://carto.com/academy/">The Map Academy</a><br>A series of exercies in Carto, organized by difficulty.</p><p><a href="http://workshops.boundlessgeo.com/postgis-intro/index.html#">Introduction to PostGIS</a><br>Detailed series of tutorials, from Boundless. While this uses the OpenGeo Suite, rather than Carto, the lessons should be transferrable — but note that the OpenGeo Suite uses the field name <code>geom</code> rather than Carto’s <code>the_geom</code>.</p>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>
